<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nanobricks for Humans – Nanobricks Wiki</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2757cfadcc89ddbfb9e61569f8c3689f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Nanobricks Wiki</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./quickstart.html"> 
<span class="menu-text">Quickstart</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tutorial.html"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sdk-guide.html"> 
<span class="menu-text">SDK Guide</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="./production-examples.html">
 <span class="dropdown-text">Production Examples</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./comparison.html">
 <span class="dropdown-text">Framework Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./architecture-diagrams.html">
 <span class="dropdown-text">Architecture Diagrams</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./roadmap.html">
 <span class="dropdown-text">Roadmap</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./human.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="./human.html">Nanobricks for Humans</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nanobricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quickstart Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nanobricks Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Building Systems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sdk-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nanobricks SDK Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./production-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Production Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Design Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./configuration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuration &amp; Feature Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Framework Comparison</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./human.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Nanobricks for Humans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Ten Commandments of Nanobricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./architecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Architecture Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./architecture-diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Architecture Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./type-safety.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Type Safety in Nanobricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./naming-conventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naming Conventions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ai-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI Integration Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ai-protocols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI Agent Protocols</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./superpowers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Skills</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Evolution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concept Evolution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./v1/concept.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nanobricks v1.0</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./v2/evolved-concept.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nanobricks v2.0</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./roadmap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementation Roadmap</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome-human" id="toc-welcome-human" class="nav-link active" data-scroll-target="#welcome-human">Welcome, Human! 👋</a></li>
  <li><a href="#current-status-performance-optimizations-complete" id="toc-current-status-performance-optimizations-complete" class="nav-link" data-scroll-target="#current-status-performance-optimizations-complete">Current Status: Performance Optimizations Complete! ⚡</a></li>
  <li><a href="#what-weve-built-so-far" id="toc-what-weve-built-so-far" class="nav-link" data-scroll-target="#what-weve-built-so-far">What We’ve Built So Far</a>
  <ul class="collapse">
  <li><a href="#the-vision" id="toc-the-vision" class="nav-link" data-scroll-target="#the-vision">1. The Vision</a></li>
  <li><a href="#the-ten-commandments" id="toc-the-ten-commandments" class="nav-link" data-scroll-target="#the-ten-commandments">2. The Ten Commandments</a></li>
  <li><a href="#the-architecture" id="toc-the-architecture" class="nav-link" data-scroll-target="#the-architecture">3. The Architecture</a></li>
  </ul></li>
  <li><a href="#coming-next-the-implementation-journey" id="toc-coming-next-the-implementation-journey" class="nav-link" data-scroll-target="#coming-next-the-implementation-journey">Coming Next: The Implementation Journey</a>
  <ul class="collapse">
  <li><a href="#step-1-hello-nanobrick" id="toc-step-1-hello-nanobrick" class="nav-link" data-scroll-target="#step-1-hello-nanobrick">Step 1: Hello, Nanobrick! ✅</a></li>
  <li><a href="#a-note-on-asyncsync-in-jupyter" id="toc-a-note-on-asyncsync-in-jupyter" class="nav-link" data-scroll-target="#a-note-on-asyncsync-in-jupyter">A Note on Async/Sync in Jupyter</a></li>
  <li><a href="#what-makes-a-nanobrick" id="toc-what-makes-a-nanobrick" class="nav-link" data-scroll-target="#what-makes-a-nanobrick">What Makes a Nanobrick?</a></li>
  <li><a href="#step-2-composition-magic" id="toc-step-2-composition-magic" class="nav-link" data-scroll-target="#step-2-composition-magic">Step 2: Composition Magic ✅</a></li>
  <li><a href="#advanced-composition" id="toc-advanced-composition" class="nav-link" data-scroll-target="#advanced-composition">Advanced Composition</a></li>
  <li><a href="#pipeline-class" id="toc-pipeline-class" class="nav-link" data-scroll-target="#pipeline-class">Pipeline Class</a></li>
  <li><a href="#step-3-dependency-injection" id="toc-step-3-dependency-injection" class="nav-link" data-scroll-target="#step-3-dependency-injection">Step 3: Dependency Injection ✅</a></li>
  <li><a href="#dependency-types" id="toc-dependency-types" class="nav-link" data-scroll-target="#dependency-types">Dependency Types</a></li>
  <li><a href="#dependencies-in-pipelines" id="toc-dependencies-in-pipelines" class="nav-link" data-scroll-target="#dependencies-in-pipelines">Dependencies in Pipelines</a></li>
  <li><a href="#step-4-configuration-power" id="toc-step-4-configuration-power" class="nav-link" data-scroll-target="#step-4-configuration-power">Step 4: Configuration Power</a></li>
  <li><a href="#step-5-skills-activate" id="toc-step-5-skills-activate" class="nav-link" data-scroll-target="#step-5-skills-activate">Step 5: Skills Activate!</a></li>
  <li><a href="#step-6-built-in-skills" id="toc-step-6-built-in-skills" class="nav-link" data-scroll-target="#step-6-built-in-skills">Step 6: Built-in Skills</a></li>
  </ul></li>
  <li><a href="#try-it-yourself" id="toc-try-it-yourself" class="nav-link" data-scroll-target="#try-it-yourself">Try It Yourself!</a></li>
  <li><a href="#questions-along-the-way" id="toc-questions-along-the-way" class="nav-link" data-scroll-target="#questions-along-the-way">Questions Along the Way?</a></li>
  <li><a href="#installation-setup" id="toc-installation-setup" class="nav-link" data-scroll-target="#installation-setup">Installation &amp; Setup</a></li>
  <li><a href="#whats-working-now" id="toc-whats-working-now" class="nav-link" data-scroll-target="#whats-working-now">What’s Working Now?</a></li>
  <li><a href="#try-it-now" id="toc-try-it-now" class="nav-link" data-scroll-target="#try-it-now">Try It Now!</a></li>
  <li><a href="#real-examples-from-the-examples-directory" id="toc-real-examples-from-the-examples-directory" class="nav-link" data-scroll-target="#real-examples-from-the-examples-directory">Real Examples from the examples/ Directory</a>
  <ul class="collapse">
  <li><a href="#from-basic_pipeline.py" id="toc-from-basic_pipeline.py" class="nav-link" data-scroll-target="#from-basic_pipeline.py">From basic_pipeline.py</a></li>
  <li><a href="#from-dependency_injection.py---smart-caching" id="toc-from-dependency_injection.py---smart-caching" class="nav-link" data-scroll-target="#from-dependency_injection.py---smart-caching">From dependency_injection.py - Smart Caching</a></li>
  <li><a href="#step-7-deployment-skills" id="toc-step-7-deployment-skills" class="nav-link" data-scroll-target="#step-7-deployment-skills">Step 7: Deployment Skills</a></li>
  <li><a href="#step-8-performance-optimizations" id="toc-step-8-performance-optimizations" class="nav-link" data-scroll-target="#step-8-performance-optimizations">Step 8: Performance Optimizations</a></li>
  </ul></li>
  <li><a href="#built-in-transformers" id="toc-built-in-transformers" class="nav-link" data-scroll-target="#built-in-transformers">Built-in Transformers</a>
  <ul class="collapse">
  <li><a href="#csv-transformers" id="toc-csv-transformers" class="nav-link" data-scroll-target="#csv-transformers">CSV Transformers</a></li>
  <li><a href="#text-normalization" id="toc-text-normalization" class="nav-link" data-scroll-target="#text-normalization">Text Normalization</a></li>
  <li><a href="#smart-type-conversion" id="toc-smart-type-conversion" class="nav-link" data-scroll-target="#smart-type-conversion">Smart Type Conversion</a></li>
  <li><a href="#dynamic-type-conversion" id="toc-dynamic-type-conversion" class="nav-link" data-scroll-target="#dynamic-type-conversion">Dynamic Type Conversion</a></li>
  <li><a href="#dataframe-transformers" id="toc-dataframe-transformers" class="nav-link" data-scroll-target="#dataframe-transformers">DataFrame Transformers</a></li>
  </ul></li>
  <li><a href="#developer-tools" id="toc-developer-tools" class="nav-link" data-scroll-target="#developer-tools">Developer Tools</a>
  <ul class="collapse">
  <li><a href="#project-scaffolding" id="toc-project-scaffolding" class="nav-link" data-scroll-target="#project-scaffolding">Project Scaffolding</a></li>
  <li><a href="#documentation-generation" id="toc-documentation-generation" class="nav-link" data-scroll-target="#documentation-generation">Documentation Generation</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#supported-skills" id="toc-supported-skills" class="nav-link" data-scroll-target="#supported-skills">Supported Skills</a></li>
  <li><a href="#ai-integration" id="toc-ai-integration" class="nav-link" data-scroll-target="#ai-integration">AI Integration</a>
  <ul class="collapse">
  <li><a href="#ai-reasoning-skill" id="toc-ai-reasoning-skill" class="nav-link" data-scroll-target="#ai-reasoning-skill">AI Reasoning Skill</a></li>
  <li><a href="#mcp-server-integration" id="toc-mcp-server-integration" class="nav-link" data-scroll-target="#mcp-server-integration">MCP Server Integration</a></li>
  <li><a href="#agent-communication" id="toc-agent-communication" class="nav-link" data-scroll-target="#agent-communication">Agent Communication</a></li>
  <li><a href="#adaptive-behavior" id="toc-adaptive-behavior" class="nav-link" data-scroll-target="#adaptive-behavior">Adaptive Behavior</a></li>
  <li><a href="#ai-powered-examples" id="toc-ai-powered-examples" class="nav-link" data-scroll-target="#ai-powered-examples">AI-Powered Examples</a></li>
  </ul></li>
  <li><a href="#security-features" id="toc-security-features" class="nav-link" data-scroll-target="#security-features">Security Features</a>
  <ul class="collapse">
  <li><a href="#input-sanitization" id="toc-input-sanitization" class="nav-link" data-scroll-target="#input-sanitization">Input Sanitization</a></li>
  <li><a href="#rate-limiting" id="toc-rate-limiting" class="nav-link" data-scroll-target="#rate-limiting">Rate Limiting</a></li>
  <li><a href="#permission-based-access-control" id="toc-permission-based-access-control" class="nav-link" data-scroll-target="#permission-based-access-control">Permission-Based Access Control</a></li>
  <li><a href="#encryption" id="toc-encryption" class="nav-link" data-scroll-target="#encryption">Encryption</a></li>
  <li><a href="#audit-logging" id="toc-audit-logging" class="nav-link" data-scroll-target="#audit-logging">Audit Logging</a></li>
  <li><a href="#layered-security" id="toc-layered-security" class="nav-link" data-scroll-target="#layered-security">Layered Security</a></li>
  </ul></li>
  <li><a href="#production-features" id="toc-production-features" class="nav-link" data-scroll-target="#production-features">Production Features</a>
  <ul class="collapse">
  <li><a href="#circuit-breakers" id="toc-circuit-breakers" class="nav-link" data-scroll-target="#circuit-breakers">Circuit Breakers</a></li>
  <li><a href="#bulkhead-isolation" id="toc-bulkhead-isolation" class="nav-link" data-scroll-target="#bulkhead-isolation">Bulkhead Isolation</a></li>
  <li><a href="#health-checks" id="toc-health-checks" class="nav-link" data-scroll-target="#health-checks">Health Checks</a></li>
  <li><a href="#graceful-shutdown" id="toc-graceful-shutdown" class="nav-link" data-scroll-target="#graceful-shutdown">Graceful Shutdown</a></li>
  <li><a href="#all-in-one-production-setup" id="toc-all-in-one-production-setup" class="nav-link" data-scroll-target="#all-in-one-production-setup">All-in-One Production Setup</a></li>
  </ul></li>
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization">Performance Optimization</a>
  <ul class="collapse">
  <li><a href="#caching-1" id="toc-caching-1" class="nav-link" data-scroll-target="#caching-1">Caching</a></li>
  <li><a href="#connection-pooling" id="toc-connection-pooling" class="nav-link" data-scroll-target="#connection-pooling">Connection Pooling</a></li>
  <li><a href="#pipeline-fusion-1" id="toc-pipeline-fusion-1" class="nav-link" data-scroll-target="#pipeline-fusion-1">Pipeline Fusion</a></li>
  <li><a href="#performance-profiling" id="toc-performance-profiling" class="nav-link" data-scroll-target="#performance-profiling">Performance Profiling</a></li>
  <li><a href="#benchmarking" id="toc-benchmarking" class="nav-link" data-scroll-target="#benchmarking">Benchmarking</a></li>
  <li><a href="#system-monitoring" id="toc-system-monitoring" class="nav-link" data-scroll-target="#system-monitoring">System Monitoring</a></li>
  <li><a href="#all-in-one-optimization" id="toc-all-in-one-optimization" class="nav-link" data-scroll-target="#all-in-one-optimization">All-in-One Optimization</a></li>
  </ul></li>
  <li><a href="#coming-next" id="toc-coming-next" class="nav-link" data-scroll-target="#coming-next">Coming Next</a></li>
  <li><a href="#package-registry" id="toc-package-registry" class="nav-link" data-scroll-target="#package-registry">Package Registry</a>
  <ul class="collapse">
  <li><a href="#creating-packages" id="toc-creating-packages" class="nav-link" data-scroll-target="#creating-packages">Creating Packages</a></li>
  <li><a href="#publishing-packages" id="toc-publishing-packages" class="nav-link" data-scroll-target="#publishing-packages">Publishing Packages</a></li>
  <li><a href="#searching-packages" id="toc-searching-packages" class="nav-link" data-scroll-target="#searching-packages">Searching Packages</a></li>
  <li><a href="#installing-packages" id="toc-installing-packages" class="nav-link" data-scroll-target="#installing-packages">Installing Packages</a></li>
  <li><a href="#version-management" id="toc-version-management" class="nav-link" data-scroll-target="#version-management">Version Management</a></li>
  <li><a href="#package-metadata" id="toc-package-metadata" class="nav-link" data-scroll-target="#package-metadata">Package Metadata</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./human.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="./human.html">Nanobricks for Humans</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Nanobricks for Humans</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A step-by-step journey through our implementation</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="d6c0e366" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the path to your workspace root if needed</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sys.path.append(os.path.abspath(<span class="st">"/Users/jankothyson/Code/kaosmaps/nano/nano-1/src"</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="welcome-human" class="level2">
<h2 class="anchored" data-anchor-id="welcome-human">Welcome, Human! 👋</h2>
<p>This document is your personal guide through the Nanobricks implementation. As we build each piece, I’ll update this document with working code examples that you can run and experiment with.</p>
</section>
<section id="current-status-performance-optimizations-complete" class="level2">
<h2 class="anchored" data-anchor-id="current-status-performance-optimizations-complete">Current Status: Performance Optimizations Complete! ⚡</h2>
<p>Your nanobricks now fly with intelligent caching, efficient batching, pipeline fusion, and memory pooling! Make expensive operations instant with LRU caching, process items in batches, and reduce overhead with fused pipelines.</p>
</section>
<section id="what-weve-built-so-far" class="level2">
<h2 class="anchored" data-anchor-id="what-weve-built-so-far">What We’ve Built So Far</h2>
<section id="the-vision" class="level3">
<h3 class="anchored" data-anchor-id="the-vision">1. The Vision</h3>
<p>We’re creating “Lego bricks for code” - simple, composable components that can build anything:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is what we're building towards:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> (</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    DataValidator() </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataTransformer() </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataPersistor()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>).invoke(data)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># With skills activated:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>smart_pipeline <span class="op">=</span> (</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    DataValidator()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"logging"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"observability"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataTransformer()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataPersistor()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"api"</span>)  <span class="co"># Now it's a REST API!</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-ten-commandments" class="level3">
<h3 class="anchored" data-anchor-id="the-ten-commandments">2. The Ten Commandments</h3>
<p>Our guiding principles that shape everything:</p>
<ol type="1">
<li><strong>Be Simple</strong> - One component, one purpose</li>
<li><strong>Be Standardized</strong> - Same interface everywhere</li>
<li><strong>Be Composable</strong> - Mix and match freely</li>
<li><strong>Be Self-Sufficient</strong> - Bring your own batteries</li>
<li><strong>Be Scaffoldable</strong> - Work immediately</li>
<li><strong>Be Observable</strong> - See what’s happening</li>
<li><strong>Be Resilient</strong> - Handle failures gracefully</li>
<li><strong>Be Configurable</strong> - Adapt without code changes</li>
<li><strong>Be Evolutionary</strong> - Get better over time</li>
<li><strong>Be Secure</strong> - Safe by default</li>
</ol>
</section>
<section id="the-architecture" class="level3">
<h3 class="anchored" data-anchor-id="the-architecture">3. The Architecture</h3>
<p>We decided on a hybrid approach combining the best of both worlds:</p>
<div id="bc12fcf9" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For type checking (IDE support, mypy)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Protocol, Generic, TypeVar, runtime_checkable</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>T_in <span class="op">=</span> TypeVar(<span class="st">"T_in"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>T_out <span class="op">=</span> TypeVar(<span class="st">"T_out"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>T_deps <span class="op">=</span> TypeVar(<span class="st">"T_deps"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">@runtime_checkable</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NanobrickProtocol(Protocol, Generic[T_in, T_out, T_deps]):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""What every nanobrick looks like to the type system"""</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    version: <span class="bu">str</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out: ...</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> invoke_sync(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out: ...</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># For runtime enforcement (actual base class)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NanobrickBase(ABC, Generic[T_in, T_out, T_deps]):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""What you actually inherit from"""</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""You must implement this"""</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> invoke_sync(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out:</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""We provide this for free!"""</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> asyncio</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> asyncio.run(<span class="va">self</span>.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="coming-next-the-implementation-journey" class="level2">
<h2 class="anchored" data-anchor-id="coming-next-the-implementation-journey">Coming Next: The Implementation Journey</h2>
<section id="step-1-hello-nanobrick" class="level3">
<h3 class="anchored" data-anchor-id="step-1-hello-nanobrick">Step 1: Hello, Nanobrick! ✅</h3>
<p><em>Status: Complete</em></p>
<p>Our first working nanobrick is ready! Here’s how to create one:</p>
<div id="7ad34ff7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import sys</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sys.path.append("/Users/jankothyson/Code/kaosmaps/nano/nano-1/src")</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase, SimpleBrick</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Full control with NanobrickBase</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EchoBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">str</span>, <span class="va">None</span>]):</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""I repeat what you say!"""</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Simpler with SimpleBrick (no deps needed)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UpperBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""I SHOUT WHAT YOU SAY!"""</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.upper()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Use them!</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>echo <span class="op">=</span> EchoBrick()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> UpperBrick()</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Async usage (native Jupyter style)</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> echo.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Echo async (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Upper async (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># In Jupyter/Quarto, we use await directly since we're in an async environment</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> echo.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Echo second call (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"hello"</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Upper second call (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: invoke_sync() and asyncio.run() don't work in Jupyter due to the running event loop</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># In non-Jupyter environments, you would use:</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># result = echo.invoke_sync("Hello, World!")</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># result = asyncio.run(echo.invoke("Hello, World!"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Echo async (await): Hello, World!
Upper async (await): HELLO, WORLD!
Echo second call (await): Hello, World!
Upper second call (await): HELLO</code></pre>
</div>
</div>
</section>
<section id="a-note-on-asyncsync-in-jupyter" class="level3">
<h3 class="anchored" data-anchor-id="a-note-on-asyncsync-in-jupyter">A Note on Async/Sync in Jupyter</h3>
<p>Jupyter notebooks run in an async environment, which affects how we call nanobricks:</p>
<ol type="1">
<li><strong>In Jupyter/Quarto</strong>: Use <code>await</code> directly (the running event loop prevents <code>asyncio.run()</code>)</li>
<li><strong>In regular Python scripts</strong>: Use <code>invoke_sync()</code> or <code>asyncio.run()</code></li>
</ol>
<p>The <code>invoke_sync()</code> method and <code>asyncio.run()</code> are designed for non-async contexts and will raise errors in Jupyter due to the existing event loop. This is why we use <code>await</code> directly in this notebook.</p>
</section>
<section id="what-makes-a-nanobrick" class="level3">
<h3 class="anchored" data-anchor-id="what-makes-a-nanobrick">What Makes a Nanobrick?</h3>
<p>Every nanobrick has: - <strong>A name</strong>: Defaults to the class name - <strong>A version</strong>: Defaults to “0.1.0” - <strong>An async invoke method</strong>: The core processing logic - <strong>Type parameters</strong>: Input type, output type, and optional dependencies</p>
<div id="09cbc04e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the nanobrick properties</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Name: </span><span class="sc">{</span>echo<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Version: </span><span class="sc">{</span>echo<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"String representation: </span><span class="sc">{</span><span class="bu">str</span>(echo)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: EchoBrick
Version: 0.1.0
String representation: EchoBrick v0.1.0</code></pre>
</div>
</div>
</section>
<section id="step-2-composition-magic" class="level3">
<h3 class="anchored" data-anchor-id="step-2-composition-magic">Step 2: Composition Magic ✅</h3>
<p><em>Status: Complete</em></p>
<p>The pipe operator is working! Here’s how to compose nanobricks:</p>
<div id="88d2d2a5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some bricks</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GreetBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">!"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ShoutBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.upper()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose them!</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>greet <span class="op">=</span> GreetBrick()</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>shout <span class="op">=</span> ShoutBrick()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> greet <span class="op">|</span> shout</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the pipeline</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Native Jupyter async style</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"world"</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Another await call (since we're in async environment)</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"python"</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline (second call): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline (await): HELLO, WORLD!
Pipeline (second call): HELLO, PYTHON!</code></pre>
</div>
</div>
</section>
<section id="advanced-composition" class="level3">
<h3 class="anchored" data-anchor-id="advanced-composition">Advanced Composition</h3>
<p>You can chain multiple bricks and even compose different types:</p>
<div id="61430c95" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chain multiple bricks</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>excited <span class="op">=</span> greet <span class="op">|</span> shout <span class="op">|</span> shout  <span class="co"># Double shout!</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> excited.invoke(<span class="st">"alice"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Double shout: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Type transformations</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LengthBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">int</span>]):</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="bu">input</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates a pipeline: str -&gt; str -&gt; int</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>count_greeting <span class="op">=</span> greet <span class="op">|</span> LengthBrick()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> count_greeting.invoke(<span class="st">"bob"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Length of greeting: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss"> (for 'Hello, bob!')"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Error propagation (fail-fast)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidateBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">input</span>.isalpha():</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Only letters allowed"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>safe_greet <span class="op">=</span> ValidateBrick() <span class="op">|</span> greet <span class="op">|</span> shout</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> safe_greet.invoke(<span class="st">"123"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Caught expected error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Double shout: HELLO, ALICE!
Length of greeting: 11 (for 'Hello, bob!')
Caught expected error: Only letters allowed</code></pre>
</div>
</div>
</section>
<section id="pipeline-class" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-class">Pipeline Class</h3>
<p>For longer compositions, use the Pipeline class:</p>
<div id="314737a2" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Pipeline</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First define the missing brick</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AddExclamationBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">!!!!"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline from multiple bricks</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(ValidateBrick(), GreetBrick(), ShoutBrick(), AddExclamationBrick())</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"world"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline result: HELLO, WORLD!!!!!</code></pre>
</div>
</div>
</section>
<section id="step-3-dependency-injection" class="level3">
<h3 class="anchored" data-anchor-id="step-3-dependency-injection">Step 3: Dependency Injection ✅</h3>
<p><em>Status: Complete</em></p>
<p>Your nanobricks can now share resources! Here’s how dependency injection works:</p>
<div id="c625200e" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase, StandardDeps, DependencyContainer</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.dependencies <span class="im">import</span> MockDatabase, MockLogger</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a brick that uses dependencies</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserLoaderBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, user_id: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> deps <span class="kw">or</span> <span class="st">"db"</span> <span class="kw">not</span> <span class="kw">in</span> deps:</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Database dependency required"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use the database from deps</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"db"</span>].query(<span class="ss">f"SELECT * FROM users WHERE id = </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Optional: use logger if available</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"logger"</span>].info(<span class="ss">f"Loaded user </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result[<span class="dv">0</span>]</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dependencies</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>deps <span class="op">=</span> DependencyContainer(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    db<span class="op">=</span>MockDatabase(</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"SELECT * FROM users WHERE id = 123"</span>: [{<span class="st">"id"</span>: <span class="dv">123</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>}]}</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">=</span>MockLogger(),</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>{<span class="st">"tenant"</span>: <span class="st">"AcmeCorp"</span>},</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the brick with dependencies</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> UserLoaderBrick()</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded user: </span><span class="sc">{</span>user<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded user: {'id': 123, 'name': 'Alice'}</code></pre>
</div>
</div>
</section>
<section id="dependency-types" class="level3">
<h3 class="anchored" data-anchor-id="dependency-types">Dependency Types</h3>
<p>We provide some common dependency types:</p>
<div id="4e261f2f" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> StandardDeps</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> TypedDict</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show what StandardDeps looks like</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"StandardDeps is a TypedDict with the following fields:"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- db: Database connection"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- cache: Cache instance"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- logger: Logger instance"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- config: Configuration dict"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of creating your own dependency type</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDeps(TypedDict):</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    api_client: <span class="bu">object</span>  <span class="co"># Would be your APIClient type</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    feature_flags: <span class="bu">dict</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    user_context: <span class="bu">dict</span>  <span class="co"># Would be your UserContext type</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Custom dependency type created successfully!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>StandardDeps is a TypedDict with the following fields:
- db: Database connection
- cache: Cache instance
- logger: Logger instance
- config: Configuration dict

Custom dependency type created successfully!</code></pre>
</div>
</div>
</section>
<section id="dependencies-in-pipelines" class="level3">
<h3 class="anchored" data-anchor-id="dependencies-in-pipelines">Dependencies in Pipelines</h3>
<p>Dependencies flow through entire pipelines automatically:</p>
<div id="5cc4792e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define example bricks for the pipeline</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EnrichBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        enriched <span class="op">=</span> data.copy()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        enriched[<span class="st">"enriched"</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> deps <span class="kw">and</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"logger"</span>].info(<span class="st">"Data enriched"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> enriched</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SaveBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> deps <span class="kw">and</span> <span class="st">"db"</span> <span class="kw">in</span> deps:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Simulate saving to database</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"db"</span>].queries.append(<span class="ss">f"INSERT INTO data VALUES (</span><span class="sc">{</span>data<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a UserValidateBrick that works with dict input</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserValidateBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"name"</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Name is required"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># All bricks in the pipeline receive the same deps</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> UserValidateBrick() <span class="op">|</span> EnrichBrick() <span class="op">|</span> SaveBrick()</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">"id"</span>: <span class="dv">123</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>}</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(data, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline result: {'id': 123, 'name': 'Alice', 'enriched': True}</code></pre>
</div>
</div>
</section>
<section id="step-4-configuration-power" class="level3">
<h3 class="anchored" data-anchor-id="step-4-configuration-power">Step 4: Configuration Power</h3>
<p><em>Status: Complete! ✅</em></p>
<p>Nanobricks now supports powerful TOML-based configuration with environment overrides!</p>
<section id="loading-configuration" class="level4">
<h4 class="anchored" data-anchor-id="loading-configuration">Loading Configuration</h4>
<div id="09f2d3a1" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> load_config, get_default_config</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load default config (searches for nanobrick.toml, pyproject.toml, etc.)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> load_config()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Default config loaded: </span><span class="sc">{</span><span class="bu">type</span>(config)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load with specific environment</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    prod_config <span class="op">=</span> load_config(environment<span class="op">=</span><span class="st">"production"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Production config loaded successfully"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No production environment config found (expected)"</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load with overrides</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>custom_config <span class="op">=</span> load_config(overrides<span class="op">=</span>{<span class="st">"logging"</span>: {<span class="st">"level"</span>: <span class="st">"DEBUG"</span>}})</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Custom override - log level: </span><span class="sc">{</span>custom_config<span class="sc">.</span>get(<span class="st">'logging'</span>, {})<span class="sc">.</span>get(<span class="st">'level'</span>, <span class="st">'INFO'</span>)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get cached default config</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> get_default_config()</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cached config type: </span><span class="sc">{</span><span class="bu">type</span>(config)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Default config loaded: &lt;class 'nanobricks.config.Config'&gt;
Production config loaded successfully
Custom override - log level: DEBUG
Cached config type: &lt;class 'nanobricks.config.Config'&gt;</code></pre>
</div>
</div>
</section>
<section id="configuration-files" class="level4">
<h4 class="anchored" data-anchor-id="configuration-files">Configuration Files</h4>
<p>Create a <code>nanobrick.toml</code> file:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"my-project"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[logging]</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">level</span> <span class="op">=</span> <span class="st">"INFO"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dt">format</span> <span class="op">=</span> <span class="st">"simple"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[database]</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dt">url</span> <span class="op">=</span> <span class="st">"sqlite:///app.db"</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="dt">pool_size</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment-specific overrides</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="kw">[environments.production]</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="kw">[environments.production.database]</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="dt">url</span> <span class="op">=</span> <span class="st">"postgresql://prod-server/app"</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="dt">pool_size</span> <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="kw">[environments.test]</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">[environments.test.database]</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="dt">url</span> <span class="op">=</span> <span class="st">"sqlite:///:memory:"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-config-in-bricks" class="level4">
<h4 class="anchored" data-anchor-id="using-config-in-bricks">Using Config in Bricks</h4>
<div id="a4c1c112" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> get_default_config, Config</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConfigurableBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">str</span>, <span class="va">None</span>]):</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> <span class="st">"configurable"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.version <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> get_default_config()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Access config safely with get() method</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        log_level <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"logging"</span>, {}).get(<span class="st">"level"</span>, <span class="st">"INFO"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Or dictionary style</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"features"</span>, {})</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Processed '</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span>log_level<span class="sc">}</span><span class="ss"> logging"</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the configurable brick</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>configurable <span class="op">=</span> ConfigurableBrick()</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> configurable.invoke(<span class="st">"test data"</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Result: Processed 'test data' with DEBUG logging</code></pre>
</div>
</div>
</section>
<section id="config-object-features" class="level4">
<h4 class="anchored" data-anchor-id="config-object-features">Config Object Features</h4>
<ul>
<li><strong>Dot notation access</strong>: <code>config.database.host</code></li>
<li><strong>Dictionary access</strong>: <code>config["database"]["host"]</code></li>
<li><strong>Safe get with defaults</strong>: <code>config.get("missing", "default")</code></li>
<li><strong>Immutable with freeze</strong>: <code>config.freeze()</code></li>
<li><strong>Environment support</strong>: Automatic env-specific overrides</li>
<li><strong>Discovery chain</strong>: Searches up directory tree for config files</li>
</ul>
</section>
<section id="real-example-from-examplesconfiguration.py" class="level4">
<h4 class="anchored" data-anchor-id="real-example-from-examplesconfiguration.py">Real Example from examples/configuration.py</h4>
<div id="4759a958" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate Config API features</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> Config</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a config object</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> Config(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"app"</span>: {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: <span class="st">"demo"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"version"</span>: <span class="st">"1.0.0"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"settings"</span>: {<span class="st">"debug"</span>: <span class="va">True</span>, <span class="st">"timeout"</span>: <span class="dv">30</span>},</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"features"</span>: [<span class="st">"auth"</span>, <span class="st">"api"</span>, <span class="st">"cache"</span>],</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Dot notation access</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"App name: </span><span class="sc">{</span>config<span class="sc">.</span>app<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Debug mode: </span><span class="sc">{</span>config<span class="sc">.</span>app<span class="sc">.</span>settings<span class="sc">.</span>debug<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionary access</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>config[<span class="st">'features'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe get with default</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing key: </span><span class="sc">{</span>config<span class="sc">.</span>get(<span class="st">'missing'</span>, <span class="st">'default value'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert back to dict</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> config.to_dict()</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"As dict type: </span><span class="sc">{</span><span class="bu">type</span>(data)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>App name: demo
Debug mode: True
Features: ['auth', 'api', 'cache']
Missing key: default value
As dict type: &lt;class 'dict'&gt;</code></pre>
</div>
</div>
</section>
<section id="working-with-environment-specific-configs" class="level4">
<h4 class="anchored" data-anchor-id="working-with-environment-specific-configs">Working with Environment-Specific Configs</h4>
<div id="5329456b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of how environment configs work</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> Config</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a config with environments</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>full_config <span class="op">=</span> Config(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"sqlite:///dev.db"</span>, <span class="st">"pool_size"</span>: <span class="dv">5</span>},</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"environments"</span>: {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"production"</span>: {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"postgresql://prod-server/app"</span>, <span class="st">"pool_size"</span>: <span class="dv">20</span>}</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"test"</span>: {<span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"sqlite:///:memory:"</span>}},</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># In real usage, load_config(environment="production") would apply these overrides</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dev database: </span><span class="sc">{</span>full_config<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Prod database: </span><span class="sc">{</span>full_config<span class="sc">.</span>environments<span class="sc">.</span>production<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test database: </span><span class="sc">{</span>full_config<span class="sc">.</span>environments<span class="sc">.</span>test<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dev database: sqlite:///dev.db
Prod database: postgresql://prod-server/app
Test database: sqlite:///:memory:</code></pre>
</div>
</div>
</section>
</section>
<section id="step-5-skills-activate" class="level3">
<h3 class="anchored" data-anchor-id="step-5-skills-activate">Step 5: Skills Activate!</h3>
<p><em>Status: Complete! ✅</em></p>
<p>The skill framework is now working! Add capabilities on demand without changing your brick’s core logic.</p>
<section id="what-are-skills" class="level4">
<h4 class="anchored" data-anchor-id="what-are-skills">What Are Skills?</h4>
<p>Skills are optional capabilities that nanobricks can activate when needed:</p>
<ul>
<li><strong>Timing</strong>: Measure execution time ✅</li>
<li><strong>Retry</strong>: Automatic retry on failure ✅</li>
<li><strong>Caching</strong>: Cache results for repeated calls ✅</li>
<li><strong>Logging</strong>: Automatic logging of inputs/outputs ✅</li>
<li><strong>API</strong>: Expose as REST endpoints ✅</li>
<li><strong>CLI</strong>: Command-line interface ✅</li>
<li><strong>Observability</strong>: Metrics and tracing (coming soon)</li>
</ul>
</section>
<section id="creating-a-skill" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-skill">Creating a Skill</h4>
<div id="4afb6567" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Skill, EnhancedBrick, register_skill</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"timing"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TimingSkill(Skill):</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adds timing information to brick invocations."""</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> time</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> TimingEnhanced(EnhancedBrick):</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                start <span class="op">=</span> time.time()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                elapsed <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"⏱️  </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_wrapped<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> took </span><span class="sc">{</span>elapsed<span class="sc">:.3f}</span><span class="ss">s"</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> result</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> TimingEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TimingSkill registered!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TimingSkill registered!</code></pre>
</div>
</div>
</section>
<section id="using-skills" class="level4">
<h4 class="anchored" data-anchor-id="using-skills">Using Skills</h4>
<p>There are three ways to add skills to your bricks:</p>
<section id="method-chaining" class="level5">
<h5 class="anchored" data-anchor-id="method-chaining">1. Method Chaining</h5>
<div id="de28dd9e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple brick</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SlowBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)  <span class="co"># Simulate slow work</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Processed: </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add timing skill</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> SlowBrick()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>timed_brick <span class="op">=</span> brick.with_skill(<span class="st">"timing"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use it</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> timed_brick.invoke(<span class="st">"hello"</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>⏱️  SlowBrick took 0.101s
Result: Processed: hello</code></pre>
</div>
</div>
</section>
<section id="function-style" class="level5">
<h5 class="anchored" data-anchor-id="function-style">2. Function Style</h5>
<div id="d9a5ec82" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> with_skill</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add multiple skills</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"cache"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CacheSkill(Skill):</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        cache <span class="op">=</span> {}</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> CacheEnhanced(EnhancedBrick):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>                key <span class="op">=</span> <span class="bu">str</span>(<span class="bu">input</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> key <span class="kw">in</span> cache:</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"💾 Cache hit for: </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> cache[key]</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                cache[key] <span class="op">=</span> result</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"💾 Cached: </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> result</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> CacheEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Chain skills</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>enhanced <span class="op">=</span> with_skill(with_skill(brick, <span class="st">"cache"</span>), <span class="st">"timing"</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - slow</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> enhanced.invoke(<span class="st">"test"</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - fast (cached)</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> enhanced.invoke(<span class="st">"test"</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Same results: </span><span class="sc">{</span>result1 <span class="op">==</span> result2<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>💾 Cached: test
⏱️  SlowBrick+cache took 0.101s
💾 Cache hit for: test
⏱️  SlowBrick+cache took 0.000s
Same results: True</code></pre>
</div>
</div>
</section>
<section id="decorator-style" class="level5">
<h5 class="anchored" data-anchor-id="decorator-style">3. Decorator Style</h5>
<div id="0d70408c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> skill</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"timing"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cache"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SmartBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">int</span>]):</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A brick decorated with skills."""</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.05</span>)  <span class="co"># Simulate work</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="bu">input</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The brick is automatically enhanced</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>smart <span class="op">=</span> SmartBrick()</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Test it</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> text <span class="kw">in</span> [<span class="st">"hello"</span>, <span class="st">"world"</span>, <span class="st">"hello"</span>]:  <span class="co"># "hello" appears twice</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="cf">await</span> smart.invoke(text)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Length of '</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span>length<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>💾 Cached: hello
⏱️  SmartBrick+cache took 0.051s
Length of 'hello': 5
💾 Cached: world
⏱️  SmartBrick+cache took 0.051s
Length of 'world': 5
💾 Cache hit for: hello
⏱️  SmartBrick+cache took 0.000s
Length of 'hello': 5</code></pre>
</div>
</div>
</section>
</section>
<section id="real-example-retry-skill" class="level4">
<h4 class="anchored" data-anchor-id="real-example-retry-skill">Real Example: Retry Skill</h4>
<div id="bbe1e568" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"retry"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RetrySkill(Skill):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adds retry logic to brick invocations."""</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        max_retries <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"max_retries"</span>, <span class="dv">3</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> RetryEnhanced(EnhancedBrick):</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                last_error <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                        last_error <span class="op">=</span> e</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> attempt <span class="op">&lt;</span> max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="ss">f"🔄 Retry </span><span class="sc">{</span>attempt <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_retries<span class="sc">}</span><span class="ss"> after: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> last_error</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RetryEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with an unreliable brick</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UnreliableBrick(SimpleBrick[<span class="bu">int</span>, <span class="bu">int</span>]):</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">int</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fail first two times</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">%</span> <span class="dv">3</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed on attempt </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span> <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add retry logic</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>unreliable <span class="op">=</span> UnreliableBrick()</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>reliable <span class="op">=</span> unreliable.with_skill(<span class="st">"retry"</span>, max_retries<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> reliable.invoke(<span class="dv">21</span>)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Success! Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed after retries: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>🔄 Retry 1/3 after: Failed on attempt 1
🔄 Retry 2/3 after: Failed on attempt 2
Success! Result: 42</code></pre>
</div>
</div>
</section>
</section>
<section id="step-6-built-in-skills" class="level3">
<h3 class="anchored" data-anchor-id="step-6-built-in-skills">Step 6: Built-in Skills</h3>
<p><em>Status: Complete! ✅</em></p>
<p>Nanobricks comes with three powerful built-in skills that cover the most common needs.</p>
<section id="logging-skill" class="level4">
<h4 class="anchored" data-anchor-id="logging-skill">Logging Skill</h4>
<p>Automatically log inputs, outputs, and errors with customizable formatting:</p>
<div id="8d86e420" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Import built-in skills</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nanobricks.skills</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> skill, SimpleBrick</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>, level<span class="op">=</span><span class="st">"INFO"</span>, pretty<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataProcessorBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Processes data with automatic logging."""</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Your processing logic</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"item_count"</span>: <span class="bu">len</span>(<span class="bu">input</span>), <span class="st">"keys"</span>: <span class="bu">list</span>(<span class="bu">input</span>.keys())}</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Use it</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessorBrick()</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>})</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Logs automatically:</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 🔵 Input: {"a": 1, "b": 2}</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 🟢 Output: {"processed": true, "item_count": 2, "keys": ["a", "b"]} (took 0.001s)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Logging options: - <code>level</code>: Log level (DEBUG, INFO, WARNING, ERROR) - <code>log_inputs</code>: Log inputs (default: True) - <code>log_outputs</code>: Log outputs (default: True) - <code>log_errors</code>: Log errors (default: True) - <code>truncate</code>: Max length for values (default: 100) - <code>pretty</code>: Pretty-print JSON (default: False)</p>
</section>
<section id="api-skill" class="level4">
<h4 class="anchored" data-anchor-id="api-skill">API Skill</h4>
<p>Turn any nanobrick into a REST API with FastAPI:</p>
<div id="02da69b5" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, path<span class="op">=</span><span class="st">"/analyze"</span>, port<span class="op">=</span><span class="dv">8080</span>, docs<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TextAnalyzerBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyzes text and returns statistics."""</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> <span class="bu">input</span>.split()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"text"</span>: <span class="bu">input</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"word_count"</span>: <span class="bu">len</span>(words),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_words"</span>: <span class="bu">len</span>(<span class="bu">set</span>(words)),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> TextAnalyzerBrick()</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the API server</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># analyzer.start_server()  # Runs at http://localhost:8080/analyze</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the API:</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># POST http://localhost:8080/analyze</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co"># {"data": "hello world hello"}</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># API docs at http://localhost:8080/docs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>API options: - <code>path</code>: Endpoint path (default: /{brick_name}) - <code>method</code>: HTTP method (default: POST) - <code>host</code>: Host to bind (default: 0.0.0.0) - <code>port</code>: Port to bind (default: 8000) - <code>docs</code>: Enable Swagger docs (default: True)</p>
</section>
<section id="cli-skill" class="level4">
<h4 class="anchored" data-anchor-id="cli-skill">CLI Skill</h4>
<p>Create command-line interfaces with Typer:</p>
<div id="22dbf619" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cli"</span>, command<span class="op">=</span><span class="st">"transform"</span>, input_type<span class="op">=</span><span class="st">"json"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataTransformerBrick(SimpleBrick[<span class="bu">list</span>, <span class="bu">dict</span>]):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Transforms data into summary statistics."""</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">list</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"total_items"</span>: <span class="bu">len</span>(<span class="bu">input</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"first"</span>: <span class="bu">input</span>[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">input</span> <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"last"</span>: <span class="bu">input</span>[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="bu">input</span> <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> DataTransformerBrick()</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Use from command line:</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co"># transform invoke '[1, 2, 3, 4, 5]'</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># transform invoke data.json --from-file</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># transform info</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># transform example</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>CLI options: - <code>command</code>: Command name (default: brick name) - <code>description</code>: Help text - <code>input_type</code>: json, text, or file - <code>output_format</code>: json, text, or pretty</p>
</section>
<section id="combining-built-in-skills" class="level4">
<h4 class="anchored" data-anchor-id="combining-built-in-skills">Combining Built-in Skills</h4>
<p>The real power comes from combining skills:</p>
<div id="6d141afa" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>, level<span class="op">=</span><span class="st">"INFO"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, port<span class="op">=</span><span class="dv">8000</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cli"</span>, command<span class="op">=</span><span class="st">"process"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProcessorBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A brick with multiple interfaces."""</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process data</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {k: v <span class="op">*</span> <span class="dv">2</span> <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">input</span>.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))}</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> ProcessorBrick()</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can:</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Call it directly (with logging)</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"a"</span>: <span class="dv">5</span>, <span class="st">"b"</span>: <span class="dv">10</span>})</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Access via REST API</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># processor.start_server()</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use from command line</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co"># process invoke '{"a": 5, "b": 10}'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="try-it-yourself" class="level2">
<h2 class="anchored" data-anchor-id="try-it-yourself">Try It Yourself!</h2>
<p>Once we start implementing, you’ll be able to run these examples:</p>
<pre class="{shell}"><code>#| eval: true
#| echo: true
#| output: true

# Install the package
pip install -e .

# Run the examples
python examples/basic_pipeline.py
python examples/sync_usage.py
python examples/dependency_injection.py
python examples/configuration.py</code></pre>
</section>
<section id="questions-along-the-way" class="level2">
<h2 class="anchored" data-anchor-id="questions-along-the-way">Questions Along the Way?</h2>
<p>As we build, I’ll add troubleshooting tips and explanations here. This document will grow with our implementation!</p>
</section>
<section id="installation-setup" class="level2">
<h2 class="anchored" data-anchor-id="installation-setup">Installation &amp; Setup</h2>
<p>Now that we have working code, here’s how to get started:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone the repository</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="op">&lt;</span>your-repo-url<span class="op">&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> nano-1</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install in development mode</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> <span class="st">".[dev]"</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the tests</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> tests/unit/test_protocol.py <span class="at">-v</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check types</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="ex">mypy</span> src/nanobricks/ <span class="at">--strict</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="whats-working-now" class="level2">
<h2 class="anchored" data-anchor-id="whats-working-now">What’s Working Now?</h2>
<p>✅ Core protocol with NanobrickProtocol and NanobrickBase<br>
✅ SimpleBrick for easy nanobricks without dependencies<br>
✅ Async and sync invocation<br>
✅ Type safety with generics<br>
✅ Full pipe operator composition (|)<br>
✅ CompositeBrick for two-brick pipelines<br>
✅ Pipeline class for multi-brick chains<br>
✅ Error propagation (fail-fast)<br>
✅ Type transformations in pipelines<br>
✅ Dependency injection with StandardDeps<br>
✅ DependencyContainer for managing deps<br>
✅ Mock implementations for testing<br>
✅ Dependencies flow through pipelines<br>
✅ TOML-based configuration system<br>
✅ Environment-specific config overrides<br>
✅ Config discovery chain<br>
✅ Dot notation config access<br>
✅ Skill framework with enhance() pattern<br>
✅ Registry for skill management<br>
✅ with_skill() method chaining<br>
✅ <span class="citation" data-cites="skill">@skill</span> decorator support<br>
✅ Example skills: timing, retry, cache<br>
✅ <strong>Built-in logging skill with smart formatting</strong><br>
✅ <strong>Built-in API skill with FastAPI</strong><br>
✅ <strong>Built-in CLI skill with Typer</strong><br>
✅ <strong>Built-in Docker skill with Dockerfile generation</strong><br>
✅ <strong>Built-in Kubernetes skill with manifest &amp; Helm chart generation</strong><br>
✅ <strong>Performance optimizations: caching, batching, fusion, pooling</strong><br>
✅ Working examples in <code>examples/</code> directory<br>
✅ 221 tests, 74% coverage<br>
✅ Strict mypy type checking</p>
</section>
<section id="try-it-now" class="level2">
<h2 class="anchored" data-anchor-id="try-it-now">Try It Now!</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the examples</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/basic_pipeline.py</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/sync_usage.py</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/dependency_injection.py</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/configuration.py</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/custom_skills.py</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/builtin_skills.py</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/deployment_example.py  <span class="co"># Docker &amp; Kubernetes deployment</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/performance_example.py  <span class="co"># NEW! Performance optimizations</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> tests/unit/ <span class="at">-v</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="real-examples-from-the-examples-directory" class="level2">
<h2 class="anchored" data-anchor-id="real-examples-from-the-examples-directory">Real Examples from the examples/ Directory</h2>
<p>Here are some highlights from our working examples:</p>
<section id="from-basic_pipeline.py" class="level3">
<h3 class="anchored" data-anchor-id="from-basic_pipeline.py">From basic_pipeline.py</h3>
<div id="2a0917db" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Email processing example from basic_pipeline.py</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidateEmailBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Validates that input looks like an email."""</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"@"</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span> <span class="kw">or</span> <span class="st">"."</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid email format: </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NormalizeEmailBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Normalizes email to lowercase and strips whitespace."""</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.strip().lower()</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExtractDomainBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extracts domain from email address."""</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.split(<span class="st">"@"</span>)[<span class="dv">1</span>]</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pipeline</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>validate <span class="op">=</span> ValidateEmailBrick(name<span class="op">=</span><span class="st">"validate"</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>normalize <span class="op">=</span> NormalizeEmailBrick(name<span class="op">=</span><span class="st">"normalize"</span>)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> ExtractDomainBrick(name<span class="op">=</span><span class="st">"extract"</span>)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>email_pipeline <span class="op">=</span> validate <span class="op">|</span> normalize <span class="op">|</span> extract</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with various inputs</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>test_emails <span class="op">=</span> [<span class="st">"  John.Doe@Example.COM  "</span>, <span class="st">"alice@wonderland.io"</span>, <span class="st">"BOB@CORP.NET"</span>]</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Email Processing Pipeline:"</span>)</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> email <span class="kw">in</span> test_emails:</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>        domain <span class="op">=</span> <span class="cf">await</span> email_pipeline.invoke(email)</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>email<span class="sc">:30}</span><span class="ss"> -&gt; </span><span class="sc">{</span>domain<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>email<span class="sc">:30}</span><span class="ss"> -&gt; ERROR: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Email Processing Pipeline:
    John.Doe@Example.COM         -&gt; example.com
  alice@wonderland.io            -&gt; wonderland.io
  BOB@CORP.NET                   -&gt; corp.net</code></pre>
</div>
</div>
</section>
<section id="from-dependency_injection.py---smart-caching" class="level3">
<h3 class="anchored" data-anchor-id="from-dependency_injection.py---smart-caching">From dependency_injection.py - Smart Caching</h3>
<div id="e4a3a28a" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.dependencies <span class="im">import</span> (</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    StandardDeps,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    MockDatabase,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    MockCache,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    MockLogger,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    DependencyContainer,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Smart loader with caching from dependency_injection.py</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SmartUserLoader(NanobrickBase[<span class="bu">str</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Loads user data with intelligent caching."""</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, user_id: <span class="bu">str</span>, <span class="op">*</span>, deps: Optional[StandardDeps] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> deps:</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Dependencies required"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check cache first</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        cache_key <span class="op">=</span> <span class="ss">f"user:</span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"cache"</span> <span class="kw">in</span> deps:</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>            cached_data <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"cache"</span>].get(cache_key)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cached_data:</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                    deps[<span class="st">"logger"</span>].debug(<span class="ss">f"Cache hit for </span><span class="sc">{</span>cache_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> cached_data</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load from database</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"db"</span> <span class="kw">not</span> <span class="kw">in</span> deps:</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Database required"</span>)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"db"</span>].query(</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SELECT * FROM users WHERE id = ?"</span>, {<span class="st">"id"</span>: user_id}</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> results:</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"User </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss"> not found"</span>)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>        user_data <span class="op">=</span> results[<span class="dv">0</span>]</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store in cache for next time</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"cache"</span> <span class="kw">in</span> deps:</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> deps[<span class="st">"cache"</span>].<span class="bu">set</span>(cache_key, user_data, ttl<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                deps[<span class="st">"logger"</span>].debug(<span class="ss">f"Cached data for </span><span class="sc">{</span>cache_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> user_data</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up dependencies</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>mock_db <span class="op">=</span> MockDatabase(</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SELECT * FROM users WHERE id = ?"</span>: [</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"id"</span>: <span class="st">"123"</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>, <span class="st">"email"</span>: <span class="st">"alice@example.com"</span>}</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>deps <span class="op">=</span> DependencyContainer(db<span class="op">=</span>mock_db, cache<span class="op">=</span>MockCache(), logger<span class="op">=</span>MockLogger())</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> SmartUserLoader()</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - hits database</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"First call (DB):"</span>)</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>user1 <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User: </span><span class="sc">{</span>user1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  DB queries: </span><span class="sc">{</span><span class="bu">len</span>(mock_db.queries)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - hits cache</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>mock_db.queries.clear()</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Second call (Cache):"</span>)</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>user2 <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User: </span><span class="sc">{</span>user2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  DB queries: </span><span class="sc">{</span><span class="bu">len</span>(mock_db.queries)<span class="sc">}</span><span class="ss"> (cache hit!)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>First call (DB):
  User: {'id': '123', 'name': 'Alice', 'email': 'alice@example.com'}
  DB queries: 1

Second call (Cache):
  User: {'id': '123', 'name': 'Alice', 'email': 'alice@example.com'}
  DB queries: 0 (cache hit!)</code></pre>
</div>
</div>
</section>
<section id="step-7-deployment-skills" class="level3">
<h3 class="anchored" data-anchor-id="step-7-deployment-skills">Step 7: Deployment Skills</h3>
<p><em>Status: Complete! ✅</em></p>
<p>Deploy your nanobricks anywhere with automatic containerization and orchestration!</p>
<section id="docker-skill" class="level4">
<h4 class="anchored" data-anchor-id="docker-skill">Docker Skill</h4>
<p>Automatically containerize your nanobricks with zero configuration:</p>
<div id="b05c7669" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, DockerConfig</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a simple brick for the example</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDataProcessor(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Process data with validation."""</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name<span class="op">=</span><span class="st">"mydataprocessor"</span>, version<span class="op">=</span><span class="st">"1.0.0"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process the data</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"count"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple containerization</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>docker_skill <span class="op">=</span> SkillDocker()</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyDataProcessor()</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>enhanced <span class="op">=</span> docker_skill.enhance(brick)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Dockerfile</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>dockerfile <span class="op">=</span> docker_skill.generate_dockerfile(brick)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated Dockerfile:"</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dockerfile)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># FROM python:3.11-slim</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># WORKDIR /app</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># COPY requirements.txt .</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN pip install -r requirements.txt</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="co"># COPY . .</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPOSE 8000</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="co"># CMD ["python", "-m", "nanobricks.run", "mydataprocessor"]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generated Dockerfile:
FROM python:3.11-slim

WORKDIR /app

# Copy application code
COPY . .

CMD ["python", "-m", "nanobricks", "run", "mydataprocessor"]</code></pre>
</div>
</div>
<p>With custom configuration:</p>
<div id="8ae0f6f6" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Continue from previous cell - redefine for this cell</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, DockerConfig</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDataProcessor(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Process data with validation."""</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name<span class="op">=</span><span class="st">"mydataprocessor"</span>, version<span class="op">=</span><span class="st">"1.0.0"</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"count"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyDataProcessor()</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Advanced Docker configuration</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>docker_config <span class="op">=</span> DockerConfig(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    base_image<span class="op">=</span><span class="st">"python:3.11-alpine"</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    expose_ports<span class="op">=</span>[<span class="dv">8080</span>],</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    environment<span class="op">=</span>{<span class="st">"API_KEY"</span>: <span class="st">"$</span><span class="sc">{API_KEY}</span><span class="st">"</span>, <span class="st">"ENV"</span>: <span class="st">"production"</span>},</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"app"</span>: <span class="st">"nanobricks"</span>, <span class="st">"version"</span>: <span class="st">"1.0.0"</span>},</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    healthcheck<span class="op">=</span>{</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"test"</span>: [<span class="st">"CMD"</span>, <span class="st">"curl"</span>, <span class="st">"-f"</span>, <span class="st">"http://localhost:8080/health"</span>],</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"interval"</span>: <span class="st">"30s"</span>,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeout"</span>: <span class="st">"3s"</span>,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"retries"</span>: <span class="dv">3</span>,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    system_packages<span class="op">=</span>[<span class="st">"curl"</span>],  <span class="co"># For healthcheck</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>docker_skill <span class="op">=</span> SkillDocker(docker_config)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate docker-compose.yml</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: generate_compose expects a dict of services</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>compose <span class="op">=</span> docker_skill.generate_compose(</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    services<span class="op">=</span>{<span class="st">"myapp"</span>: brick},</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    networks<span class="op">=</span>[<span class="st">"app-network"</span>],</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Docker Compose configuration generated!"</span>)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Compose file includes services, networks, and configuration."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Docker Compose configuration generated!
Compose file includes services, networks, and configuration.</code></pre>
</div>
</div>
</section>
<section id="kubernetes-skill" class="level4">
<h4 class="anchored" data-anchor-id="kubernetes-skill">Kubernetes Skill</h4>
<p>Deploy to Kubernetes with automatic manifest generation:</p>
<div id="6f0ffe20" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillKubernetes, KubernetesConfig</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Kubernetes deployment</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>k8s_config <span class="op">=</span> KubernetesConfig(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    namespace<span class="op">=</span><span class="st">"production"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    replicas<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    resources<span class="op">=</span>{</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"requests"</span>: {<span class="st">"cpu"</span>: <span class="st">"100m"</span>, <span class="st">"memory"</span>: <span class="st">"128Mi"</span>},</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limits"</span>: {<span class="st">"cpu"</span>: <span class="st">"500m"</span>, <span class="st">"memory"</span>: <span class="st">"512Mi"</span>},</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"app"</span>: <span class="st">"nanobricks"</span>, <span class="st">"tier"</span>: <span class="st">"backend"</span>},</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>k8s_skill <span class="op">=</span> SkillKubernetes(k8s_config)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># brick = MyAPIBrick()</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all Kubernetes manifests</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co"># manifests = k8s_skill.generate_manifests(brick, "myapp:v1.0.0")</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Includes:</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co"># - Deployment with health checks and resource limits</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co"># - Service for load balancing</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co"># - HorizontalPodAutoscaler for auto-scaling</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="co"># - ConfigMap for configuration</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generate Helm charts for production deployments:</p>
<div id="831762a7" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate complete Helm chart</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>helm_chart <span class="op">=</span> k8s_skill.generate_helm_chart(brick, <span class="st">"myapp:v1.0.0"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates:</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Chart.yaml with metadata</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - values.yaml with configurable parameters</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - Templates for all Kubernetes resources</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Support for multiple environments</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Helm chart structure:"</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename, content <span class="kw">in</span> helm_chart.items():</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Helm chart structure:
  Chart.yaml
  values.yaml
  templates/deployment.yaml
  templates/service.yaml</code></pre>
</div>
</div>
</section>
<section id="complete-deployment-pipeline" class="level4">
<h4 class="anchored" data-anchor-id="complete-deployment-pipeline">Complete Deployment Pipeline</h4>
<p>Combine Docker and Kubernetes for full deployment automation:</p>
<div id="48860c22" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick, skill</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, SkillKubernetes</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, port<span class="op">=</span><span class="dv">8080</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductionBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A production-ready nanobrick."""</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Your business logic here</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"items"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create deployment pipeline</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> ProductionBrick()</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Containerize</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>docker <span class="op">=</span> SkillDocker()</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>dockerfile <span class="op">=</span> docker.generate_dockerfile(brick)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>compose <span class="op">=</span> docker.generate_docker_compose(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Deploy to Kubernetes</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>k8s <span class="op">=</span> SkillKubernetes(</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    KubernetesConfig(</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        namespace<span class="op">=</span><span class="st">"production"</span>,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        replicas<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>        autoscaling<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>        min_replicas<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>        max_replicas<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>        target_cpu_utilization<span class="op">=</span><span class="dv">70</span>,</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>manifests <span class="op">=</span> k8s.generate_manifests(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>helm_chart <span class="op">=</span> k8s.generate_helm_chart(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Deployment pipeline ready!"</span>)</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Dockerfile: </span><span class="sc">{</span><span class="bu">len</span>(dockerfile)<span class="sc">}</span><span class="ss"> lines"</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Kubernetes manifests: </span><span class="sc">{</span><span class="bu">len</span>(manifests)<span class="sc">}</span><span class="ss"> resources"</span>)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Helm chart: </span><span class="sc">{</span><span class="bu">len</span>(helm_chart)<span class="sc">}</span><span class="ss"> files"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-8-performance-optimizations" class="level3">
<h3 class="anchored" data-anchor-id="step-8-performance-optimizations">Step 8: Performance Optimizations</h3>
<p><em>Status: Complete! ✅</em></p>
<p>Make your nanobricks blazing fast with built-in performance optimizations!</p>
<section id="caching" class="level4">
<h4 class="anchored" data-anchor-id="caching">Caching</h4>
<p>Add intelligent caching to expensive operations:</p>
<div id="bd04ca48" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an expensive brick</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DatabaseLookupBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, key: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate expensive database query</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.5</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"key"</span>: key, <span class="st">"data"</span>: <span class="ss">f"Data for </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>db_brick <span class="op">=</span> DatabaseLookupBrick()</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>cached_db <span class="op">=</span> with_cache(db_brick, max_size<span class="op">=</span><span class="dv">100</span>, ttl<span class="op">=</span><span class="dv">300</span>)  <span class="co"># 5 min TTL</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - slow (cache miss)</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> cached_db.invoke(<span class="st">"user123"</span>)  <span class="co"># Takes 0.5s</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - fast (cache hit)</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> cached_db.invoke(<span class="st">"user123"</span>)  <span class="co"># Instant!</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cache stats</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cached_db.cache_info())</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="co"># {'size': 1, 'max_size': 100, 'ttl': 300, ...}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'size': 1, 'error_size': 0, 'max_size': 100, 'ttl': 300, 'hits': 0, 'misses': 0}</code></pre>
</div>
</div>
</section>
<section id="batching" class="level4">
<h4 class="anchored" data-anchor-id="batching">Batching</h4>
<p>Process multiple items efficiently:</p>
<div id="14add8ed" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_batching</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a brick that benefits from batching</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> APICallBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, item: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate API call</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"id"</span>: item, <span class="st">"processed"</span>: <span class="va">True</span>}</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add batching</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>api_brick <span class="op">=</span> APICallBrick()</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>batched_api <span class="op">=</span> with_batching(api_brick, batch_size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Process multiple items efficiently</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="ss">f"item_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> batched_api.invoke(items)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Processes in batches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{'id': 'item_0', 'processed': True}, {'id': 'item_1', 'processed': True}, {'id': 'item_2', 'processed': True}, {'id': 'item_3', 'processed': True}, {'id': 'item_4', 'processed': True}, {'id': 'item_5', 'processed': True}, {'id': 'item_6', 'processed': True}, {'id': 'item_7', 'processed': True}, {'id': 'item_8', 'processed': True}, {'id': 'item_9', 'processed': True}, {'id': 'item_10', 'processed': True}, {'id': 'item_11', 'processed': True}, {'id': 'item_12', 'processed': True}, {'id': 'item_13', 'processed': True}, {'id': 'item_14', 'processed': True}, {'id': 'item_15', 'processed': True}, {'id': 'item_16', 'processed': True}, {'id': 'item_17', 'processed': True}, {'id': 'item_18', 'processed': True}, {'id': 'item_19', 'processed': True}]</code></pre>
</div>
</div>
</section>
<section id="pipeline-fusion" class="level4">
<h4 class="anchored" data-anchor-id="pipeline-fusion">Pipeline Fusion</h4>
<p>Optimize long pipelines by fusing operations:</p>
<div id="689b22a0" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Pipeline</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> fuse_pipeline</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>step1 <span class="op">=</span> TransformBrick()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>step2 <span class="op">=</span> ValidateBrick()</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>step3 <span class="op">=</span> EnrichBrick()</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>step4 <span class="op">=</span> SaveBrick()</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular pipeline</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(step1, step2, step3, step4)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fused pipeline - reduces async overhead</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> fuse_pipeline(pipeline)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Both work the same, but fused is faster</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> fused.invoke(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="memory-pooling" class="level4">
<h4 class="anchored" data-anchor-id="memory-pooling">Memory Pooling</h4>
<p>Reuse objects to reduce allocation overhead:</p>
<div id="2ed27b68" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> MemoryPool</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pool of reusable processors</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataProcessor:</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">buffer</span> <span class="op">=</span> <span class="bu">bytearray</span>(<span class="dv">1024</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results <span class="op">=</span> []</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset(<span class="va">self</span>):</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results.clear()</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process(<span class="va">self</span>, data):</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process using pre-allocated buffer</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results.append(<span class="bu">len</span>(data))</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.results</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pool</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>pool <span class="op">=</span> MemoryPool(DataProcessor, size<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pooled objects</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> pool.acquire()</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> processor.process(<span class="st">"hello"</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>pool.release(processor)  <span class="co"># Returns to pool for reuse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[5]</code></pre>
</div>
</div>
</section>
<section id="combined-optimizations" class="level4">
<h4 class="anchored" data-anchor-id="combined-optimizations">Combined Optimizations</h4>
<p>Stack optimizations for maximum performance:</p>
<div id="b98bebf1" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache, fuse_pipeline</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complex pipeline</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> DataValidator()</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>enricher <span class="op">=</span> DataEnricher()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> DataTransformer()</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching to expensive operations</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>cached_enricher <span class="op">=</span> with_cache(enricher, max_size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fuse pipeline</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> validator <span class="op">|</span> cached_enricher <span class="op">|</span> transformer</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> fuse_pipeline([validator, cached_enricher, transformer])</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ultra-fast processing with caching and fusion</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> large_dataset:</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> fused.invoke(item)  <span class="co"># Cached + fused!</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    results.append(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="built-in-transformers" class="level2">
<h2 class="anchored" data-anchor-id="built-in-transformers">Built-in Transformers</h2>
<section id="csv-transformers" class="level3">
<h3 class="anchored" data-anchor-id="csv-transformers">CSV Transformers</h3>
<p>Work with CSV data seamlessly:</p>
<div id="943833e7" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> CSVParser, CSVSerializer</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse CSV text</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>parser <span class="op">=</span> CSVParser(delimiter<span class="op">=</span><span class="st">","</span>, strip_values<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="cf">await</span> parser.invoke(<span class="st">"""name,age,city</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="st">Alice,30,New York</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="st">Bob,25,London"""</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: [{"name": "Alice", "age": "30", "city": "New York"}, ...]</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Serialize back to CSV</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>serializer <span class="op">=</span> CSVSerializer(columns<span class="op">=</span>[<span class="st">"name"</span>, <span class="st">"city"</span>])  <span class="co"># Select columns</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>csv_text <span class="op">=</span> <span class="cf">await</span> serializer.invoke(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="text-normalization" class="level3">
<h3 class="anchored" data-anchor-id="text-normalization">Text Normalization</h3>
<p>Clean and normalize text data:</p>
<div id="87ba7c8f" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> TextNormalizer</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure normalization</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>normalizer <span class="op">=</span> TextNormalizer(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    lowercase<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    remove_punctuation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    expand_contractions<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    remove_urls<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    custom_replacements<span class="op">=</span>{</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CEO"</span>: <span class="st">"Chief Executive Officer"</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AI"</span>: <span class="st">"Artificial Intelligence"</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"The CEO said: Don't miss our AI update at https://example.com!"</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>clean <span class="op">=</span> <span class="cf">await</span> normalizer.invoke(text)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: "the chief executive officer said do not miss our artificial intelligence update"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="smart-type-conversion" class="level3">
<h3 class="anchored" data-anchor-id="smart-type-conversion">Smart Type Conversion</h3>
<p>Convert between types intelligently:</p>
<div id="21415615" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> SmartTypeConverter, BulkTypeConverter</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Single value conversion</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>to_date <span class="op">=</span> SmartTypeConverter(target_type<span class="op">=</span>date, date_format<span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> to_date.invoke(<span class="st">"2024-01-15"</span>)  <span class="co"># Returns date object</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Bulk conversion with error handling</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>to_int <span class="op">=</span> BulkTypeConverter(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    target_type<span class="op">=</span><span class="bu">int</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    skip_errors<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    error_value<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    report_errors<span class="op">=</span><span class="va">True</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">"42"</span>, <span class="st">"100"</span>, <span class="st">"invalid"</span>, <span class="st">"75"</span>]</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> to_int.invoke(values)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: {"results": [42, 100, 0, 75], "error_count": 1, ...}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dynamic-type-conversion" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-type-conversion">Dynamic Type Conversion</h3>
<p>Convert dictionaries with type hints:</p>
<div id="b94e37f7" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> DynamicTypeConverter</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure type mappings</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>converter <span class="op">=</span> DynamicTypeConverter(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    type_map<span class="op">=</span>{<span class="st">"age"</span>: <span class="bu">int</span>, <span class="st">"active"</span>: <span class="bu">bool</span>},</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    infer_types<span class="op">=</span><span class="va">True</span>  <span class="co"># Auto-detect numbers and booleans</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>: <span class="st">"Alice"</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>: <span class="st">"30"</span>,        <span class="co"># Will convert to int</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"salary"</span>: <span class="st">"50000.50"</span>,  <span class="co"># Will infer as float</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"active"</span>: <span class="st">"yes"</span>     <span class="co"># Will convert to bool</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> converter.invoke(data)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: {"name": "Alice", "age": 30, "salary": 50000.5, "active": True}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataframe-transformers" class="level3">
<h3 class="anchored" data-anchor-id="dataframe-transformers">DataFrame Transformers</h3>
<p>Work with pandas DataFrames for powerful data analysis:</p>
<div id="1faa8e3c" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> (</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    DataFrameFilter,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    DataFrameGroupBy,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    DataFrameMerge,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    DataFrameReshape</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>sales_data <span class="op">=</span> [</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"price"</span>: <span class="fl">999.99</span>, <span class="st">"quantity"</span>: <span class="dv">5</span>, <span class="st">"region"</span>: <span class="st">"North"</span>},</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Mouse"</span>, <span class="st">"price"</span>: <span class="fl">29.99</span>, <span class="st">"quantity"</span>: <span class="dv">15</span>, <span class="st">"region"</span>: <span class="st">"South"</span>},</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"price"</span>: <span class="fl">999.99</span>, <span class="st">"quantity"</span>: <span class="dv">3</span>, <span class="st">"region"</span>: <span class="st">"South"</span>},</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter high-value sales</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> DataFrameFilter(</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"price"</span>,</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    op<span class="op">=</span><span class="st">"&gt;"</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>expensive_items <span class="op">=</span> <span class="cf">await</span> <span class="bu">filter</span>.invoke(sales_data)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and aggregate</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>groupby <span class="op">=</span> DataFrameGroupBy(</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"product"</span>,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    agg<span class="op">=</span>{</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"quantity"</span>: <span class="st">"sum"</span>,</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"price"</span>: [<span class="st">"mean"</span>, <span class="st">"count"</span>]</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>product_summary <span class="op">=</span> <span class="cf">await</span> groupby.invoke(sales_data)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot data</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>pivot <span class="op">=</span> DataFrameReshape(</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>    reshape_type<span class="op">=</span><span class="st">"pivot"</span>,</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"product"</span>,</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"region"</span>,</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">"quantity"</span>,</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">"sum"</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>pivot_table <span class="op">=</span> <span class="cf">await</span> pivot.invoke(sales_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="advanced-dataframe-operations" class="level4">
<h4 class="anchored" data-anchor-id="advanced-dataframe-operations">Advanced DataFrame Operations</h4>
<div id="e138fff8" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complex filtering with queries</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>complex_filter <span class="op">=</span> DataFrameFilter(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span><span class="st">"price &gt; 50 and region == 'North' and quantity &gt;= 5"</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> <span class="cf">await</span> complex_filter.invoke(sales_data)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with additional data</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>product_info <span class="op">=</span> pd.DataFrame([</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"category"</span>: <span class="st">"Electronics"</span>, <span class="st">"cost"</span>: <span class="dv">700</span>},</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Mouse"</span>, <span class="st">"category"</span>: <span class="st">"Electronics"</span>, <span class="st">"cost"</span>: <span class="dv">15</span>}</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>merge <span class="op">=</span> DataFrameMerge(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    other<span class="op">=</span>product_info,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"product"</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>enriched_data <span class="op">=</span> <span class="cf">await</span> merge.invoke(sales_data)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series operations (requires datetime index)</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> DataFrameTimeSeriesOperator</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling average</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>rolling <span class="op">=</span> DataFrameTimeSeriesOperator(</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    operation<span class="op">=</span><span class="st">"rolling"</span>,</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    window<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    func<span class="op">=</span><span class="st">"mean"</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>smoothed_data <span class="op">=</span> <span class="cf">await</span> rolling.invoke(time_series_df)</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to weekly</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>resample <span class="op">=</span> DataFrameTimeSeriesOperator(</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>    operation<span class="op">=</span><span class="st">"resample"</span>,</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>    rule<span class="op">=</span><span class="st">"W"</span>,  <span class="co"># Weekly</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    func<span class="op">=</span><span class="st">"sum"</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>weekly_data <span class="op">=</span> <span class="cf">await</span> resample.invoke(time_series_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="developer-tools" class="level2">
<h2 class="anchored" data-anchor-id="developer-tools">Developer Tools</h2>
<section id="project-scaffolding" class="level3">
<h3 class="anchored" data-anchor-id="project-scaffolding">Project Scaffolding</h3>
<p>Create new nanobrick projects in seconds:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new project</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nanobrick</span> new my-awesome-brick <span class="dt">\</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--description</span> <span class="st">"An awesome data processor"</span> <span class="dt">\</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--author</span> <span class="st">"Your Name"</span> <span class="dt">\</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">--email</span> <span class="st">"you@example.com"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Project structure created:</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="ex">my-awesome-brick/</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> pyproject.toml          <span class="co"># Project metadata &amp; dependencies</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> nanobrick.toml          <span class="co"># Nanobrick configuration</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md               <span class="co"># Documentation</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .gitignore              <span class="co"># Git ignore patterns</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .vscode/</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── settings.json       <span class="co"># VS Code configuration</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src/</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── my_awesome_brick/</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── __init__.py</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── core.py         <span class="co"># Your brick implementation</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests/</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> __init__.py</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> test_my_awesome_brick.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The generated brick is ready to use:</p>
<div id="90dc6232" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> my_awesome_brick <span class="im">import</span> MyAwesomeBrick</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use your new brick</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyAwesomeBrick(prefix<span class="op">=</span><span class="st">"AWESOME"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> brick.invoke(<span class="st">"hello"</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: "AWESOME: hello processed"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="documentation-generation" class="level3">
<h3 class="anchored" data-anchor-id="documentation-generation">Documentation Generation</h3>
<p>Automatically generate documentation from your nanobricks:</p>
<div id="1e069485" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.docs <span class="im">import</span> DocumentationGenerator</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate docs for your bricks</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> DocumentationGenerator(output_dir<span class="op">=</span><span class="st">"docs/api"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Document individual bricks</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> my_bricks <span class="im">import</span> DataProcessor, Validator, Transformer</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>generator.write_docs([DataProcessor, Validator, Transformer])</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates:</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co"># docs/api/</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── index.md              # Overview with links</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── dataprocessor.md      # Full docs for DataProcessor</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── validator.md          # Full docs for Validator</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   └── transformer.md        # Full docs for Transformer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generated documentation includes:</p>
<ul>
<li>Type signatures with input/output/dependencies</li>
<li>Constructor parameters</li>
<li>Method documentation</li>
<li>Usage examples extracted from docstrings</li>
<li>Supported skills</li>
<li>Composition examples</li>
</ul>
<p>Example generated documentation:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># DataProcessor</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="in">`my_bricks.DataProcessor`</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>A brick that processes data with validation and transformation.</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Type Signature</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Input**: <span class="in">`dict`</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Output**: <span class="in">`dict`</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dependencies**: <span class="in">`DatabaseConfig`</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructor</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>DataProcessor(validate<span class="op">=</span><span class="va">True</span>, transform<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Initialize data processor with options…</p>
</section>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> processor <span class="op">=</span> DataProcessor()</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"name"</span>: <span class="st">"Alice"</span>, <span class="st">"age"</span>: <span class="dv">30</span>})</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(result)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>{<span class="st">"name"</span>: <span class="st">"ALICE"</span>, <span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"valid"</span>: <span class="va">True</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="supported-skills" class="level2">
<h2 class="anchored" data-anchor-id="supported-skills">Supported Skills</h2>
<ul>
<li>Skill Framework</li>
<li>Logging</li>
<li>API</li>
<li>Observability</li>
</ul>
<pre><code>
### Developer Experience Tools

#### Pipeline Debugger

Debug your pipelines step-by-step:

::: {#393cbf8b .cell execution_count=44}
``` {.python .cell-code}
from nanobricks.devtools import BrickDebugger

# Create debugger
debugger = BrickDebugger(
    capture_input=True,
    capture_output=True,
    capture_errors=True,
    save_to_file="debug.json"
)

# Wrap bricks with debugging
processor = debugger.wrap_brick(DataProcessor())
validator = debugger.wrap_brick(Validator())

# Create debugged pipeline
pipeline = processor | validator

# Run and see what happens
result = await pipeline.invoke({"name": "Alice", "age": 30})

# Print execution trace
debugger.print_trace()
# Output:
# 📊 Execution Trace:
# ============================================================
# 
# [14:32:15.123] ▶️  DataProcessor
#     Input: {'name': 'Alice', 'age': 30}
# [14:32:15.234] ✅ DataProcessor (111.00ms)
#     Output: {'name': 'ALICE', 'age': 30, 'processed': True}
# 
# [14:32:15.235] ▶️  Validator
#     Input: {'name': 'ALICE', 'age': 30, 'processed': True}
# [14:32:15.267] ✅ Validator (32.00ms)
#     Output: {'name': 'ALICE', 'age': 30, 'processed': True, 'valid': True}</code></pre>
<p>:::</p>
<section id="performance-profiler" class="level4">
<h4 class="anchored" data-anchor-id="performance-profiler">Performance Profiler</h4>
<p>Profile your bricks to find bottlenecks:</p>
<div id="a07e26ad" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.devtools <span class="im">import</span> BrickProfiler, profile_brick</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create profiler</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>profiler <span class="op">=</span> BrickProfiler(measure_memory<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile a pipeline</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>slow_brick <span class="op">=</span> profiler.wrap_brick(SlowProcessor())</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>fast_brick <span class="op">=</span> profiler.wrap_brick(FastValidator())</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> slow_brick <span class="op">|</span> fast_brick</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Run multiple times</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> pipeline.invoke(<span class="ss">f"data_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print performance stats</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>profiler.print_stats()</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ⏱️  Performance Profile:</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================================================================</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Brick                          Calls   Total(ms)    Avg(ms)    Min(ms)    Max(ms)</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------------------</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="co"># SlowProcessor                    100     8543.21      85.43      82.10      95.33</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="co"># FastValidator                    100      234.56       2.35       2.01       3.44</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 💾 Memory Usage:</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------------------</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="co"># SlowProcessor                  Delta:   +12.34 MB</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Find bottlenecks</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>bottlenecks <span class="op">=</span> profiler.get_bottlenecks(threshold_pct<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bottlenecks: </span><span class="sc">{</span>bottlenecks<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># ['SlowProcessor']</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipeline-visualizer" class="level4">
<h4 class="anchored" data-anchor-id="pipeline-visualizer">Pipeline Visualizer</h4>
<p>Visualize your pipeline structure:</p>
<div id="3997ea35" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.devtools <span class="im">import</span> visualize_pipeline</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complex pipeline</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> DataLoader()</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessor()</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> Validator()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>saver <span class="op">=</span> DataSaver()</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> loader <span class="op">|</span> processor <span class="op">|</span> validator <span class="op">|</span> saver</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ASCII visualization</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visualize_pipeline(pipeline))</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Pipeline Flow:</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ==================================================</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co">#      INPUT</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataLoader      │</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="co"># │     DataLoader       │</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a><span class="co"># │    DataProcessor     │</span></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a><span class="co"># │    DataProcessor     │</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a><span class="co"># │      Validator       │</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a><span class="co"># │      Validator       │</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataSaver       │</span></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataSaver       │</span></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a><span class="co">#      OUTPUT</span></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Mermaid diagram</span></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>mermaid <span class="op">=</span> visualize_pipeline(pipeline, style<span class="op">=</span><span class="st">"mermaid"</span>, save_to<span class="op">=</span><span class="st">"pipeline.mmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ai-integration" class="level2">
<h2 class="anchored" data-anchor-id="ai-integration">AI Integration</h2>
<section id="ai-reasoning-skill" class="level3">
<h3 class="anchored" data-anchor-id="ai-reasoning-skill">AI Reasoning Skill</h3>
<p>Enhance your nanobricks with AI-powered intelligence:</p>
<div id="b71f4063" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills <span class="im">import</span> create_ai_skill</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create AI skill with cost controls</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>ai_skill <span class="op">=</span> create_ai_skill(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    max_cost_per_invoke<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># $0.05 limit per call</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    enable_reasoning_trace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    enable_memory<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhance any brick with AI</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> DataValidator()</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>ai_validator <span class="op">=</span> validator.with_skill(ai_skill)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The AI will:</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co"># - Understand complex validation rules from context</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># - Learn from past validations</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - Provide intelligent error recovery</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - Track costs to prevent overruns</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> ai_validator.invoke(complex_data)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Check AI reasoning</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">hasattr</span>(ai_validator, <span class="st">'get_reasoning_trace'</span>):</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    trace <span class="op">=</span> ai_validator.get_reasoning_trace()</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> trace:</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>step<span class="sc">.</span>timestamp<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>step<span class="sc">.</span>thought<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor costs</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AI costs: </span><span class="sc">{</span>ai_skill<span class="sc">.</span>get_cost_report()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mcp-server-integration" class="level3">
<h3 class="anchored" data-anchor-id="mcp-server-integration">MCP Server Integration</h3>
<p>Expose your nanobricks as tools for LLMs via Model Context Protocol:</p>
<div id="2d619af3" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills <span class="im">import</span> create_mcp_server, MCPToolConfig</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure tool exposure</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>summarizer <span class="op">=</span> TextSummarizer()</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> DataAnalyzer()</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create MCP server</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>mcp_server <span class="op">=</span> create_mcp_server(</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    bricks<span class="op">=</span>[summarizer, analyzer],</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    server_name<span class="op">=</span><span class="st">"my-tools"</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    configs<span class="op">=</span>{</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TextSummarizer"</span>: MCPToolConfig(</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"summarize"</span>,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Summarizes text intelligently"</span>,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>            example_inputs<span class="op">=</span>[{<span class="st">"text"</span>: <span class="st">"Long article..."</span>}],</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Run server for LLM access</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> mcp_server.run_server()</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Your LLM can now use these tools!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="agent-communication" class="level3">
<h3 class="anchored" data-anchor-id="agent-communication">Agent Communication</h3>
<p>Build multi-agent systems with nanobricks:</p>
<div id="1312620a" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.agent <span class="im">import</span> create_agent</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create agents from bricks</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> create_agent(DataProcessor(), name<span class="op">=</span><span class="st">"Processor Agent"</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> create_agent(DataValidator(), name<span class="op">=</span><span class="st">"Validator Agent"</span>) </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> create_agent(DataAnalyzer(), name<span class="op">=</span><span class="st">"Analyzer Agent"</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Agents can discover each other</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>discovered <span class="op">=</span> <span class="cf">await</span> processor.discover_agents(capability<span class="op">=</span><span class="st">"validation"</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Send messages between agents</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> processor.send_message(</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    to_agent<span class="op">=</span>validator.<span class="bu">id</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    message_type<span class="op">=</span>MessageType.REQUEST,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    content<span class="op">=</span>{<span class="st">"validate"</span>: data}</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Request processing from another agent</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.request_processing(</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    target_agent<span class="op">=</span>analyzer.<span class="bu">id</span>,</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span><span class="op">=</span>processed_data,</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="fl">30.0</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Broadcast to all agents</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> processor.broadcast(</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    MessageType.ANNOUNCE,</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"status"</span>: <span class="st">"processing complete"</span>}</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adaptive-behavior" class="level3">
<h3 class="anchored" data-anchor-id="adaptive-behavior">Adaptive Behavior</h3>
<p>Create self-tuning nanobricks that learn and adapt:</p>
<div id="4afe5de2" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.adaptive <span class="im">import</span> create_adaptive_brick</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.adaptive.policies <span class="im">import</span> ThresholdPolicy, MLPolicy</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple threshold-based adaptation</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>policy <span class="op">=</span> ThresholdPolicy(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    latency_threshold_ms<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    error_rate_threshold<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessor()</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>adaptive_processor <span class="op">=</span> create_adaptive_brick(processor, policy)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The brick will automatically:</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="co"># - Monitor performance metrics</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># - Detect when thresholds are exceeded</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="co"># - Adjust parameters (batch size, concurrency, etc.)</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - Retry with different strategies on errors</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ML-based adaptation for complex scenarios</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>ml_policy <span class="op">=</span> MLPolicy(model_path<span class="op">=</span><span class="st">"adaptation_model.pkl"</span>)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>smart_processor <span class="op">=</span> create_adaptive_brick(processor, ml_policy)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check adaptation status</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> adaptive_processor.get_metrics_summary()</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Success rate: </span><span class="sc">{</span>metrics[<span class="st">'success_rate'</span>]<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Current adaptations: </span><span class="sc">{</span>metrics[<span class="st">'current_adaptations'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ai-powered-examples" class="level3">
<h3 class="anchored" data-anchor-id="ai-powered-examples">AI-Powered Examples</h3>
<section id="intelligent-validator" class="level4">
<h4 class="anchored" data-anchor-id="intelligent-validator">Intelligent Validator</h4>
<div id="a215802b" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A validator that understands context</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> IntelligentValidator(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    context<span class="op">=</span><span class="st">"user registration with email and phone"</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add AI for smarter validation</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>ai_validator <span class="op">=</span> validator.with_skill(create_ai_skill())</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> ai_validator.invoke({</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>: <span class="st">""</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"email"</span>: <span class="st">"invalid-email"</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"phone"</span>: <span class="st">"555"</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co"># AI provides intelligent feedback:</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="co"># - Errors: ["Invalid email format"]</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - Warnings: ["Name is empty", "Phone too short"]  </span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - Suggestions: ["Use format: name@domain.com", "Include country code"]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversational-pipeline-assistant" class="level4">
<h4 class="anchored" data-anchor-id="conversational-pipeline-assistant">Conversational Pipeline Assistant</h4>
<div id="ff591d34" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a conversational assistant for your pipeline</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>assistant <span class="op">=</span> ConversationalBrick(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    system_prompt<span class="op">=</span><span class="st">"Help users debug data pipelines"</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use in your pipeline for interactive debugging</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> DataLoader() <span class="op">|</span> processor <span class="op">|</span> assistant <span class="op">|</span> validator</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The assistant can:</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - Answer questions about the pipeline</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># - Explain errors in plain language</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - Suggest optimizations</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - Guide users through debugging</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="security-features" class="level2">
<h2 class="anchored" data-anchor-id="security-features">Security Features</h2>
<p>Protect your nanobricks with comprehensive security measures:</p>
<section id="input-sanitization" class="level3">
<h3 class="anchored" data-anchor-id="input-sanitization">Input Sanitization</h3>
<p>Prevent injection attacks with automatic sanitization:</p>
<div id="de162462" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> InputSanitizer</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect against XSS and SQL injection</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>sanitizer <span class="op">=</span> InputSanitizer(</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    UserService(),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    html_escape<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    sql_escape<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    max_length<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    allowed_chars<span class="op">=</span><span class="st">"a-zA-Z0-9 .-_"</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Malicious input gets sanitized</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> sanitizer.invoke(<span class="st">'&lt;script&gt;alert("xss")&lt;/script&gt;'</span>)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: '&amp;lt;script&amp;gt;alert(&amp;quot;xss&amp;quot;)&amp;lt;/script&amp;gt;'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rate-limiting" class="level3">
<h3 class="anchored" data-anchor-id="rate-limiting">Rate Limiting</h3>
<p>Prevent abuse with configurable rate limits:</p>
<div id="ba31f418" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> RateLimiter</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit requests per user</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>limiter <span class="op">=</span> RateLimiter(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    ApiService(),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    max_requests<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    window_seconds<span class="op">=</span><span class="dv">60</span>,</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    burst_size<span class="op">=</span><span class="dv">10</span>,  <span class="co"># Max burst within short period</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    key_func<span class="op">=</span><span class="kw">lambda</span> <span class="bu">input</span>, deps: deps[<span class="st">"user_id"</span>],</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Exceeding limits raises an error</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> limiter.invoke(request, deps<span class="op">=</span>{<span class="st">"user_id"</span>: <span class="st">"alice"</span>})</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Rate limited: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="permission-based-access-control" class="level3">
<h3 class="anchored" data-anchor-id="permission-based-access-control">Permission-Based Access Control</h3>
<p>Fine-grained permissions and role-based access:</p>
<div id="1f63d0c9" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> PermissionGuard, Permission, SecurityContext</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Require specific permissions</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>admin_only <span class="op">=</span> PermissionGuard(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    DeleteService(),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    required_permissions<span class="op">=</span>{Permission.DELETE, Permission.ADMIN},</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    required_roles<span class="op">=</span>{<span class="st">"administrator"</span>},</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create security context</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>context <span class="op">=</span> SecurityContext(</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">=</span><span class="st">"alice"</span>,</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    permissions<span class="op">=</span>{Permission.READ, Permission.WRITE},</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    roles<span class="op">=</span>{<span class="st">"user"</span>},</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Access denied without proper permissions</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> admin_only.invoke(request, deps<span class="op">=</span>{<span class="st">"security_context"</span>: context})</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">PermissionError</span>:</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Access denied"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="encryption" class="level3">
<h3 class="anchored" data-anchor-id="encryption">Encryption</h3>
<p>Protect sensitive data at rest and in transit:</p>
<div id="c4dc2800" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> EncryptionBrick</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Encrypt specific fields</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>encrypted <span class="op">=</span> EncryptionBrick(</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    UserDataStore(),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    fields_to_encrypt<span class="op">=</span>[<span class="st">"password"</span>, <span class="st">"ssn"</span>, <span class="st">"credit_card"</span>],</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    encrypt_output<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensitive fields are automatically encrypted</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> encrypted.invoke({</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"username"</span>: <span class="st">"alice"</span>,</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"password"</span>: <span class="st">"secret123"</span>,  <span class="co"># Will be encrypted</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"email"</span>: <span class="st">"alice@example.com"</span>,  <span class="co"># Not encrypted</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="audit-logging" class="level3">
<h3 class="anchored" data-anchor-id="audit-logging">Audit Logging</h3>
<p>Track all operations for compliance and security:</p>
<div id="6b03caf3" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> AuditLogger</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Log all operations</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>audited <span class="op">=</span> AuditLogger(</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    PaymentService(),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    log_input<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    log_output<span class="op">=</span><span class="va">False</span>,  <span class="co"># Don't log sensitive output</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    hash_sensitive_data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co"># All operations are logged</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> audited.invoke(payment_request)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Query audit log</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>entries <span class="op">=</span> audited.get_audit_log(</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">=</span><span class="st">"alice"</span>,</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    start_time<span class="op">=</span>yesterday,</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    success_only<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="layered-security" class="level3">
<h3 class="anchored" data-anchor-id="layered-security">Layered Security</h3>
<p>Apply multiple security layers at once:</p>
<div id="7c6dc940" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> secure_nanobrick</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply all security features</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>secure_service <span class="op">=</span> secure_nanobrick(</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    CriticalService(),</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    sanitize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    rate_limit<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    permissions<span class="op">=</span>{Permission.EXECUTE},</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    encrypt<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    audit<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="production-features" class="level2">
<h2 class="anchored" data-anchor-id="production-features">Production Features</h2>
<p>Make your nanobricks production-ready with reliability patterns:</p>
<section id="circuit-breakers" class="level3">
<h3 class="anchored" data-anchor-id="circuit-breakers">Circuit Breakers</h3>
<p>Prevent cascading failures with automatic circuit breaking:</p>
<div id="c11b97db" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> CircuitBreaker</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect unreliable services</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>breaker <span class="op">=</span> CircuitBreaker(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    ExternalApiService(),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">5</span>,      <span class="co"># Open after 5 failures</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    success_threshold<span class="op">=</span><span class="dv">2</span>,      <span class="co"># Close after 2 successes</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">60</span>,       <span class="co"># Reset attempt after 60s</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    fallback<span class="op">=</span><span class="kw">lambda</span> x, d: cached_response,  <span class="co"># Fallback when open</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Circuit opens automatically on failures</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> breaker.invoke(request)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Check circuit status</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Circuit state: </span><span class="sc">{</span>breaker<span class="sc">.</span>state<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># CLOSED, OPEN, or HALF_OPEN</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stats: </span><span class="sc">{</span>breaker<span class="sc">.</span>stats<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bulkhead-isolation" class="level3">
<h3 class="anchored" data-anchor-id="bulkhead-isolation">Bulkhead Isolation</h3>
<p>Isolate resources to prevent total system failure:</p>
<div id="c976674c" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> Bulkhead</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit concurrent executions</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>bulkhead <span class="op">=</span> Bulkhead(</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    ResourceIntensiveService(),</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    max_concurrent<span class="op">=</span><span class="dv">5</span>,        <span class="co"># Max 5 concurrent</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    max_queue_size<span class="op">=</span><span class="dv">10</span>,       <span class="co"># Queue up to 10 more</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">30</span>,      <span class="co"># Timeout waiting for slot</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Requests beyond limits are rejected</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>        bulkhead.invoke(req) <span class="cf">for</span> req <span class="kw">in</span> many_requests</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">RuntimeError</span> <span class="im">as</span> e:</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Bulkhead full: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor bulkhead status</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Active: </span><span class="sc">{</span>bulkhead<span class="sc">.</span>active_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stats: </span><span class="sc">{</span>bulkhead<span class="sc">.</span>stats<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-checks" class="level3">
<h3 class="anchored" data-anchor-id="health-checks">Health Checks</h3>
<p>Monitor service health automatically:</p>
<div id="52fef853" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> HealthCheck</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add health monitoring</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>monitored <span class="op">=</span> HealthCheck(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    CriticalService(),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    check_interval_seconds<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Start background health checks</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> monitored.start_health_checks()</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the service normally</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> monitored.invoke(request)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check health status</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>health <span class="op">=</span> <span class="cf">await</span> monitored.check_health()</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Status: </span><span class="sc">{</span>health<span class="sc">.</span>status<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># HEALTHY, DEGRADED, or UNHEALTHY</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Details: </span><span class="sc">{</span>health<span class="sc">.</span>details<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom health check logic</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_check():</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check database, disk space, etc.</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> database_connected <span class="kw">and</span> disk_space_ok:</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> HealthCheckResult(HealthStatus.HEALTHY)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> HealthCheckResult(HealthStatus.UNHEALTHY)</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>custom_monitored <span class="op">=</span> HealthCheck(service, custom_check<span class="op">=</span>custom_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graceful-shutdown" class="level3">
<h3 class="anchored" data-anchor-id="graceful-shutdown">Graceful Shutdown</h3>
<p>Clean shutdown with proper resource cleanup:</p>
<div id="3c39fb71" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> GracefulShutdown</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create shutdown manager</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>shutdown <span class="op">=</span> GracefulShutdown(timeout_seconds<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Register resources to manage</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>shutdown.register_brick(database_service)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>shutdown.register_brick(cache_service)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Register background tasks</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>shutdown.register_task(monitoring_task)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>shutdown.register_task(cleanup_task)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom shutdown handlers</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> save_state():</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> state_store.save()</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"State saved"</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>shutdown.register_handler(save_state)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Install signal handlers (SIGTERM, SIGINT)</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>shutdown.install_signal_handlers()</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait for shutdown signal</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> shutdown.wait_for_shutdown()</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Or trigger manually</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> shutdown.shutdown()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-in-one-production-setup" class="level3">
<h3 class="anchored" data-anchor-id="all-in-one-production-setup">All-in-One Production Setup</h3>
<p>Apply all production features at once:</p>
<div id="d025bba8" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> with_production_features</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make any brick production-ready</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>production_service <span class="op">=</span> with_production_features(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    MyService(),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    circuit_breaker<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    bulkhead<span class="op">=</span><span class="dv">10</span>,           <span class="co"># Max 10 concurrent</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    health_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">5</span>,   <span class="co"># Circuit breaker setting</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">60</span>,    <span class="co"># Circuit reset timeout</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally - all protection is transparent</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> production_service.invoke(request)</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Features work together:</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - Circuit breaker prevents cascading failures</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - Bulkhead limits resource usage</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a><span class="co"># - Health checks monitor service status</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="performance-optimization" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimization">Performance Optimization</h2>
<p>Optimize your nanobricks for maximum performance:</p>
<section id="caching-1" class="level3">
<h3 class="anchored" data-anchor-id="caching-1">Caching</h3>
<p>Cache expensive operations with TTL and LRU eviction:</p>
<div id="2628f85a" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching to any brick</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>fibonacci <span class="op">=</span> FibonacciBrick()</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>cached_fib <span class="op">=</span> with_cache(</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    fibonacci,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    max_size<span class="op">=</span><span class="dv">1000</span>,      <span class="co"># Max cache entries</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    ttl<span class="op">=</span><span class="dv">300</span>,            <span class="co"># 5 minute TTL</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># First call computes</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> cached_fib.invoke(<span class="dv">20</span>)  <span class="co"># Takes time</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call is instant</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> cached_fib.invoke(<span class="dv">20</span>)  <span class="co"># From cache!</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cache statistics</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> cached_fib.cache_info()</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache hits: </span><span class="sc">{</span>stats[<span class="st">'hits'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache size: </span><span class="sc">{</span>stats[<span class="st">'size'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear cache if needed</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>cached_fib.clear_cache()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connection-pooling" class="level3">
<h3 class="anchored" data-anchor-id="connection-pooling">Connection Pooling</h3>
<p>Efficiently manage external resources:</p>
<div id="d0274b68" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> ConnectionPool</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create connection pool</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> create_db_connection():</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate expensive connection</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"id"</span>: random.randint(<span class="dv">1000</span>, <span class="dv">9999</span>), <span class="st">"connected"</span>: <span class="va">True</span>}</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>pool <span class="op">=</span> ConnectionPool(</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    create_db_connection,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    min_size<span class="op">=</span><span class="dv">2</span>,         <span class="co"># Keep 2 connections ready</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    max_size<span class="op">=</span><span class="dv">10</span>,        <span class="co"># Max 10 connections</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    acquire_timeout<span class="op">=</span><span class="fl">5.0</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Use connections efficiently</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> pool.acquire() <span class="im">as</span> conn:</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Connection is automatically returned to pool</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> db_brick.invoke(query, deps<span class="op">=</span>{<span class="st">"connection"</span>: conn})</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor pool health</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> pool.get_stats()</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Active connections: </span><span class="sc">{</span>stats[<span class="st">'in_use'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Available: </span><span class="sc">{</span>stats[<span class="st">'available'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> pool.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipeline-fusion-1" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-fusion-1">Pipeline Fusion</h3>
<p>Optimize pipeline execution by fusing operations:</p>
<div id="7a8f5427" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> FusedPipeline</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular pipeline</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> TransformBrick(<span class="bu">str</span>.upper)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>strip <span class="op">=</span> TransformBrick(<span class="bu">str</span>.strip)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>reverse <span class="op">=</span> TransformBrick(<span class="kw">lambda</span> x: x[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create fused pipeline for better performance</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> FusedPipeline([upper, strip, reverse])</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Benchmark comparison</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular execution</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"  hello  "</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> strip.invoke(result)</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> reverse.invoke(result)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>regular_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Fused execution - reduces async overhead</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> fused.invoke(<span class="st">"  hello  "</span>)</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>fused_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Speedup: </span><span class="sc">{</span>regular_time <span class="op">/</span> fused_time<span class="sc">:.2f}</span><span class="ss">x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="performance-profiling" class="level3">
<h3 class="anchored" data-anchor-id="performance-profiling">Performance Profiling</h3>
<p>Profile your bricks to identify bottlenecks:</p>
<div id="f713bdfe" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> ProfilerBrick</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap any brick with profiling</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>profiled <span class="op">=</span> ProfilerBrick(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    SlowService(),</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    enable_trace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    log_slow_calls<span class="op">=</span><span class="fl">100.0</span>,  <span class="co"># Log calls &gt; 100ms</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> profiled.invoke(request)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get performance metrics</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> profiled.get_metrics()</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average time: </span><span class="sc">{</span>metrics<span class="sc">.</span>avg_time_ms<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min/Max: </span><span class="sc">{</span>metrics<span class="sc">.</span>min_time_ms<span class="sc">:.2f}</span><span class="ss">ms / </span><span class="sc">{</span>metrics<span class="sc">.</span>max_time_ms<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total calls: </span><span class="sc">{</span>metrics<span class="sc">.</span>total_calls<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Get detailed traces</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>traces <span class="op">=</span> profiled.get_traces()</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trace <span class="kw">in</span> traces:</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>trace[<span class="st">'brick'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>trace[<span class="st">'duration_ms'</span>]<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmarking" class="level3">
<h3 class="anchored" data-anchor-id="benchmarking">Benchmarking</h3>
<p>Accurately benchmark your nanobricks:</p>
<div id="28b908a6" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> Benchmark</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create benchmark</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>bench <span class="op">=</span> Benchmark(<span class="st">"data_processing"</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure performance</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> bench.measure(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span>: processor.invoke(test_data),</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    iterations<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    warmup<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Operations/sec: </span><span class="sc">{</span>result<span class="sc">.</span>ops_per_sec<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average latency: </span><span class="sc">{</span>result<span class="sc">.</span>avg_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min/Max: </span><span class="sc">{</span>result<span class="sc">.</span>min_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms / </span><span class="sc">{</span>result<span class="sc">.</span>max_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare optimizations</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>original_result <span class="op">=</span> <span class="cf">await</span> bench.measure(original_processor.invoke)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>optimized_result <span class="op">=</span> <span class="cf">await</span> bench.measure(optimized_processor.invoke)</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> bench.compare(optimized_result)</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Speedup: </span><span class="sc">{</span>comparison[<span class="st">'speedup'</span>]<span class="sc">:.2f}</span><span class="ss">x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="system-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="system-monitoring">System Monitoring</h3>
<p>Monitor system resources:</p>
<div id="a7de46c2" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> get_system_metrics</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get current system state</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> get_system_metrics()</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"CPU Usage: </span><span class="sc">{</span>metrics[<span class="st">'cpu'</span>][<span class="st">'percent'</span>]<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Memory: </span><span class="sc">{</span>metrics[<span class="st">'memory'</span>][<span class="st">'percent'</span>]<span class="sc">:.1f}</span><span class="ss">% used"</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Disk I/O: </span><span class="sc">{</span>metrics[<span class="st">'disk_io'</span>]<span class="sc">.</span>get(<span class="st">'read_bytes'</span>, <span class="dv">0</span>) <span class="op">/</span> <span class="fl">1e9</span><span class="sc">:.2f}</span><span class="ss"> GB read"</span>)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Network: </span><span class="sc">{</span>metrics[<span class="st">'network_io'</span>]<span class="sc">.</span>get(<span class="st">'bytes_sent'</span>, <span class="dv">0</span>) <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.2f}</span><span class="ss"> MB sent"</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use for adaptive behavior</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> metrics[<span class="st">'cpu'</span>][<span class="st">'percent'</span>] <span class="op">&gt;</span> <span class="dv">80</span>:</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Switch to low-resource mode</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>    processor.set_batch_size(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-in-one-optimization" class="level3">
<h3 class="anchored" data-anchor-id="all-in-one-optimization">All-in-One Optimization</h3>
<p>Apply multiple optimizations at once:</p>
<div id="b501dda6" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_performance_optimizations</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply all optimizations</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>optimized <span class="op">=</span> with_performance_optimizations(</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    DataProcessor(),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    cache<span class="op">=</span><span class="va">True</span>,           <span class="co"># Enable caching</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    cache_size<span class="op">=</span><span class="dv">1000</span>,      <span class="co"># Cache size</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    cache_ttl<span class="op">=</span><span class="dv">300</span>,        <span class="co"># 5 minute TTL</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    profile<span class="op">=</span><span class="va">True</span>,         <span class="co"># Enable profiling</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    profile_trace<span class="op">=</span><span class="va">True</span>,   <span class="co"># Store traces</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    log_slow_calls<span class="op">=</span><span class="fl">50.0</span>,  <span class="co"># Log &gt; 50ms calls</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally - optimizations are transparent</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> optimized.invoke(data)</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check performance</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> optimized.get_metrics()</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache hit rate: </span><span class="sc">{</span>metrics<span class="sc">.</span>cache_hits <span class="op">/</span> metrics<span class="sc">.</span>total_calls<span class="sc">:.1%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="coming-next" class="level2">
<h2 class="anchored" data-anchor-id="coming-next">Coming Next</h2>
<p>✅ Configuration system (TOML) - DONE!<br>
✅ Skill framework - DONE!<br>
✅ First built-in skills (logging, API, CLI) - DONE!<br>
✅ Deployment skills (Docker, Kubernetes) - DONE!<br>
✅ Performance optimizations (caching, batching, fusion) - DONE!<br>
✅ Additional transformers (CSV, text, type conversion) - DONE!<br>
✅ Project scaffolding &amp; documentation generation - DONE!<br>
✅ Developer experience tools (debugger, visualizer, profiler) - DONE!<br>
✅ AI Integration (MCP, agents, adaptive behavior) - DONE!<br>
✅ Security features (sanitization, rate limiting, permissions, encryption) - DONE!<br>
✅ Production features (circuit breakers, bulkheads, health checks) - DONE!<br>
✅ Performance profiling and optimization - DONE!<br>
✅ Package registry and discovery - DONE!</p>
</section>
<section id="package-registry" class="level2">
<h2 class="anchored" data-anchor-id="package-registry">Package Registry</h2>
<p>Share and discover nanobricks with the built-in package registry:</p>
<section id="creating-packages" class="level3">
<h3 class="anchored" data-anchor-id="creating-packages">Creating Packages</h3>
<p>Package your nanobricks for distribution:</p>
<div id="06f8276d" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> create_package_from_brick</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a package from your brick</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> TextProcessor()</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> create_package_from_brick(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    processor,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"text-processor"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Powerful text processing nanobrick"</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    keywords<span class="op">=</span>[<span class="st">"text"</span>, <span class="st">"nlp"</span>, <span class="st">"processing"</span>],</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    homepage<span class="op">=</span><span class="st">"https://github.com/yourname/text-processor"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as archive</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>archive <span class="op">=</span> package.to_archive()</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text-processor-1.0.0.nbp"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    f.write(archive)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Package created: </span><span class="sc">{</span><span class="bu">len</span>(archive) <span class="op">/</span> <span class="dv">1024</span><span class="sc">:.2f}</span><span class="ss"> KB"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="publishing-packages" class="level3">
<h3 class="anchored" data-anchor-id="publishing-packages">Publishing Packages</h3>
<p>Share your nanobricks with the community:</p>
<div id="a4f143d7" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> get_registry</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get registry client</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>registry <span class="op">=</span> get_registry()</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Publish your package</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>success <span class="op">=</span> <span class="cf">await</span> registry.publish(package, api_key<span class="op">=</span><span class="st">"your-api-key"</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> success:</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Published </span><span class="sc">{</span>package<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>package<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="searching-packages" class="level3">
<h3 class="anchored" data-anchor-id="searching-packages">Searching Packages</h3>
<p>Find nanobricks for your needs:</p>
<div id="07fd295b" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Search by keyword</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> registry.search(<span class="st">"validation"</span>, limit<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> results:</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>result<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>result<span class="sc">.</span>version<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Downloads: </span><span class="sc">{</span>result<span class="sc">.</span>downloads<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Search by author</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> registry.search(<span class="st">""</span>, author<span class="op">=</span><span class="st">"Alice Developer"</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get detailed info</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>info <span class="op">=</span> <span class="cf">await</span> registry.info(<span class="st">"data-validator"</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Latest version: </span><span class="sc">{</span>info<span class="sc">.</span>latest_version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total downloads: </span><span class="sc">{</span>info<span class="sc">.</span>total_downloads<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="installing-packages" class="level3">
<h3 class="anchored" data-anchor-id="installing-packages">Installing Packages</h3>
<p>Install nanobricks with version management:</p>
<div id="1374a6b3" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install latest stable version</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(<span class="st">"data-validator"</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install specific version</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(<span class="st">"data-validator"</span>, version_spec<span class="op">=</span><span class="st">"==2.1.0"</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install with version constraints</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data-validator"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    version_spec<span class="op">=</span><span class="st">"^2.0.0"</span>,  <span class="co"># Compatible with 2.x.x</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co"># List installed packages</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>installed <span class="op">=</span> <span class="cf">await</span> registry.list_installed()</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pkg <span class="kw">in</span> installed:</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>pkg<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>pkg<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="version-management" class="level3">
<h3 class="anchored" data-anchor-id="version-management">Version Management</h3>
<p>Semantic versioning with constraints:</p>
<div id="941fdb92" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> Version, VersionRange</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse versions</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> Version.parse(<span class="st">"1.2.3"</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> Version.parse(<span class="st">"2.0.0-beta.1"</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare versions</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v1 <span class="op">&lt;</span> v2)  <span class="co"># True</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Version ranges</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="bu">range</span> <span class="op">=</span> VersionRange.parse(<span class="st">"^1.0.0"</span>)  <span class="co"># Compatible with 1.x.x</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">range</span>.contains(v1))  <span class="co"># True</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve dependencies</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> resolve_dependencies</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>dependencies <span class="op">=</span> {</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-core"</span>: <span class="st">"^1.0.0"</span>,</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-utils"</span>: <span class="st">"&gt;=1.0.0,&lt;2.0.0"</span>,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-types"</span>: <span class="st">"~1.2.0"</span>,  <span class="co"># ~1.2.x</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>available <span class="op">=</span> {</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-core"</span>: [Version.parse(<span class="st">"1.0.0"</span>), Version.parse(<span class="st">"1.5.0"</span>)],</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-utils"</span>: [Version.parse(<span class="st">"1.2.0"</span>), Version.parse(<span class="st">"2.0.0"</span>)],</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-types"</span>: [Version.parse(<span class="st">"1.2.3"</span>), Version.parse(<span class="st">"1.3.0"</span>)],</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>resolved <span class="op">=</span> resolve_dependencies(dependencies, available)</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: core=1.5.0, utils=1.2.0, types=1.2.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="package-metadata" class="level3">
<h3 class="anchored" data-anchor-id="package-metadata">Package Metadata</h3>
<p>Rich metadata for discoverability:</p>
<div id="44fe0c95" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> PackageMetadata</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> PackageMetadata(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"my-nanobrick"</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Does amazing things"</span>,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    email<span class="op">=</span><span class="st">"you@example.com"</span>,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    license<span class="op">=</span><span class="st">"MIT"</span>,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    homepage<span class="op">=</span><span class="st">"https://github.com/you/my-nanobrick"</span>,</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    keywords<span class="op">=</span>[<span class="st">"awesome"</span>, <span class="st">"nanobrick"</span>],</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>{</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nanobricks"</span>: <span class="st">"&gt;=1.0.0"</span>,</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"requests"</span>: <span class="st">"^2.0.0"</span>,</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nanobrick-specific metadata</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    skills<span class="op">=</span>[<span class="st">"api"</span>, <span class="st">"cli"</span>],</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    input_type<span class="op">=</span><span class="st">"dict[str, Any]"</span>,</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    output_type<span class="op">=</span><span class="st">"ProcessedData"</span>,</span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>🔜 Community marketplace and visual builder</p>
<hr>
<p><em>Last Updated: Registry Ready - Share and Discover Amazing Nanobricks!</em></p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb110" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Nanobricks for Humans"</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A step-by-step journey through our implementation"</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the path to your workspace root if needed</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>sys.path.append(os.path.abspath(<span class="st">"/Users/jankothyson/Code/kaosmaps/nano/nano-1/src"</span>))</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## Welcome, Human! 👋</span></span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>This document is your personal guide through the Nanobricks implementation. As we build each piece, I'll update this document with working code examples that you can run and experiment with.</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Current Status: Performance Optimizations Complete! ⚡</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>Your nanobricks now fly with intelligent caching, efficient batching, pipeline fusion, and memory pooling! Make expensive operations instant with LRU caching, process items in batches, and reduce overhead with fused pipelines.</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## What We've Built So Far</span></span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. The Vision</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>We're creating "Lego bricks for code" - simple, composable components that can build anything:</span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a><span class="co"># This is what we're building towards:</span></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> (</span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>    DataValidator() </span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataTransformer() </span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataPersistor()</span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>).invoke(data)</span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a><span class="co"># With skills activated:</span></span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>smart_pipeline <span class="op">=</span> (</span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>    DataValidator()</span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"logging"</span>)</span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"observability"</span>)</span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataTransformer()</span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> DataPersistor()</span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>    .with_skill(<span class="st">"api"</span>)  <span class="co"># Now it's a REST API!</span></span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. The Ten Commandments</span></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a>Our guiding principles that shape everything:</span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Be Simple** - One component, one purpose</span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Be Standardized** - Same interface everywhere</span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Be Composable** - Mix and match freely</span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Be Self-Sufficient** - Bring your own batteries</span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Be Scaffoldable** - Work immediately</span>
<span id="cb110-74"><a href="#cb110-74" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Be Observable** - See what's happening</span>
<span id="cb110-75"><a href="#cb110-75" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Be Resilient** - Handle failures gracefully</span>
<span id="cb110-76"><a href="#cb110-76" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>**Be Configurable** - Adapt without code changes</span>
<span id="cb110-77"><a href="#cb110-77" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>**Be Evolutionary** - Get better over time</span>
<span id="cb110-78"><a href="#cb110-78" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>**Be Secure** - Safe by default</span>
<span id="cb110-79"><a href="#cb110-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-80"><a href="#cb110-80" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. The Architecture</span></span>
<span id="cb110-81"><a href="#cb110-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-82"><a href="#cb110-82" aria-hidden="true" tabindex="-1"></a>We decided on a hybrid approach combining the best of both worlds:</span>
<span id="cb110-83"><a href="#cb110-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-86"><a href="#cb110-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-87"><a href="#cb110-87" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-88"><a href="#cb110-88" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-89"><a href="#cb110-89" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-90"><a href="#cb110-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-91"><a href="#cb110-91" aria-hidden="true" tabindex="-1"></a><span class="co"># For type checking (IDE support, mypy)</span></span>
<span id="cb110-92"><a href="#cb110-92" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Protocol, Generic, TypeVar, runtime_checkable</span>
<span id="cb110-93"><a href="#cb110-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-94"><a href="#cb110-94" aria-hidden="true" tabindex="-1"></a>T_in <span class="op">=</span> TypeVar(<span class="st">"T_in"</span>)</span>
<span id="cb110-95"><a href="#cb110-95" aria-hidden="true" tabindex="-1"></a>T_out <span class="op">=</span> TypeVar(<span class="st">"T_out"</span>)</span>
<span id="cb110-96"><a href="#cb110-96" aria-hidden="true" tabindex="-1"></a>T_deps <span class="op">=</span> TypeVar(<span class="st">"T_deps"</span>)</span>
<span id="cb110-97"><a href="#cb110-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-98"><a href="#cb110-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-99"><a href="#cb110-99" aria-hidden="true" tabindex="-1"></a><span class="at">@runtime_checkable</span></span>
<span id="cb110-100"><a href="#cb110-100" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NanobrickProtocol(Protocol, Generic[T_in, T_out, T_deps]):</span>
<span id="cb110-101"><a href="#cb110-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""What every nanobrick looks like to the type system"""</span></span>
<span id="cb110-102"><a href="#cb110-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-103"><a href="#cb110-103" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb110-104"><a href="#cb110-104" aria-hidden="true" tabindex="-1"></a>    version: <span class="bu">str</span></span>
<span id="cb110-105"><a href="#cb110-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-106"><a href="#cb110-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out: ...</span>
<span id="cb110-107"><a href="#cb110-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> invoke_sync(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out: ...</span>
<span id="cb110-108"><a href="#cb110-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-109"><a href="#cb110-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-110"><a href="#cb110-110" aria-hidden="true" tabindex="-1"></a><span class="co"># For runtime enforcement (actual base class)</span></span>
<span id="cb110-111"><a href="#cb110-111" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb110-112"><a href="#cb110-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-113"><a href="#cb110-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-114"><a href="#cb110-114" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NanobrickBase(ABC, Generic[T_in, T_out, T_deps]):</span>
<span id="cb110-115"><a href="#cb110-115" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""What you actually inherit from"""</span></span>
<span id="cb110-116"><a href="#cb110-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-117"><a href="#cb110-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb110-118"><a href="#cb110-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out:</span>
<span id="cb110-119"><a href="#cb110-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""You must implement this"""</span></span>
<span id="cb110-120"><a href="#cb110-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb110-121"><a href="#cb110-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-122"><a href="#cb110-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> invoke_sync(<span class="va">self</span>, <span class="bu">input</span>: T_in, <span class="op">*</span>, deps: T_deps <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> T_out:</span>
<span id="cb110-123"><a href="#cb110-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""We provide this for free!"""</span></span>
<span id="cb110-124"><a href="#cb110-124" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> asyncio</span>
<span id="cb110-125"><a href="#cb110-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-126"><a href="#cb110-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> asyncio.run(<span class="va">self</span>.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps))</span>
<span id="cb110-127"><a href="#cb110-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-128"><a href="#cb110-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-129"><a href="#cb110-129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coming Next: The Implementation Journey</span></span>
<span id="cb110-130"><a href="#cb110-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-131"><a href="#cb110-131" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Hello, Nanobrick! ✅</span></span>
<span id="cb110-132"><a href="#cb110-132" aria-hidden="true" tabindex="-1"></a>*Status: Complete*</span>
<span id="cb110-133"><a href="#cb110-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-134"><a href="#cb110-134" aria-hidden="true" tabindex="-1"></a>Our first working nanobrick is ready! Here's how to create one:</span>
<span id="cb110-135"><a href="#cb110-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-138"><a href="#cb110-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-139"><a href="#cb110-139" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-140"><a href="#cb110-140" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-141"><a href="#cb110-141" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-142"><a href="#cb110-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-143"><a href="#cb110-143" aria-hidden="true" tabindex="-1"></a><span class="co"># import sys</span></span>
<span id="cb110-144"><a href="#cb110-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-145"><a href="#cb110-145" aria-hidden="true" tabindex="-1"></a><span class="co"># sys.path.append("/Users/jankothyson/Code/kaosmaps/nano/nano-1/src")</span></span>
<span id="cb110-146"><a href="#cb110-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-147"><a href="#cb110-147" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb110-148"><a href="#cb110-148" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase, SimpleBrick</span>
<span id="cb110-149"><a href="#cb110-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-150"><a href="#cb110-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-151"><a href="#cb110-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Full control with NanobrickBase</span></span>
<span id="cb110-152"><a href="#cb110-152" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EchoBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">str</span>, <span class="va">None</span>]):</span>
<span id="cb110-153"><a href="#cb110-153" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""I repeat what you say!"""</span></span>
<span id="cb110-154"><a href="#cb110-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-155"><a href="#cb110-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-156"><a href="#cb110-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb110-157"><a href="#cb110-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-158"><a href="#cb110-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-159"><a href="#cb110-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Simpler with SimpleBrick (no deps needed)</span></span>
<span id="cb110-160"><a href="#cb110-160" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UpperBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-161"><a href="#cb110-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""I SHOUT WHAT YOU SAY!"""</span></span>
<span id="cb110-162"><a href="#cb110-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-163"><a href="#cb110-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-164"><a href="#cb110-164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.upper()</span>
<span id="cb110-165"><a href="#cb110-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-166"><a href="#cb110-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-167"><a href="#cb110-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Use them!</span></span>
<span id="cb110-168"><a href="#cb110-168" aria-hidden="true" tabindex="-1"></a>echo <span class="op">=</span> EchoBrick()</span>
<span id="cb110-169"><a href="#cb110-169" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> UpperBrick()</span>
<span id="cb110-170"><a href="#cb110-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-171"><a href="#cb110-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Async usage (native Jupyter style)</span></span>
<span id="cb110-172"><a href="#cb110-172" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> echo.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb110-173"><a href="#cb110-173" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Echo async (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-174"><a href="#cb110-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-175"><a href="#cb110-175" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb110-176"><a href="#cb110-176" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Upper async (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-177"><a href="#cb110-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-178"><a href="#cb110-178" aria-hidden="true" tabindex="-1"></a><span class="co"># In Jupyter/Quarto, we use await directly since we're in an async environment</span></span>
<span id="cb110-179"><a href="#cb110-179" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> echo.invoke(<span class="st">"Hello, World!"</span>)</span>
<span id="cb110-180"><a href="#cb110-180" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Echo second call (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-181"><a href="#cb110-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-182"><a href="#cb110-182" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"hello"</span>)</span>
<span id="cb110-183"><a href="#cb110-183" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Upper second call (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-184"><a href="#cb110-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-185"><a href="#cb110-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: invoke_sync() and asyncio.run() don't work in Jupyter due to the running event loop</span></span>
<span id="cb110-186"><a href="#cb110-186" aria-hidden="true" tabindex="-1"></a><span class="co"># In non-Jupyter environments, you would use:</span></span>
<span id="cb110-187"><a href="#cb110-187" aria-hidden="true" tabindex="-1"></a><span class="co"># result = echo.invoke_sync("Hello, World!")</span></span>
<span id="cb110-188"><a href="#cb110-188" aria-hidden="true" tabindex="-1"></a><span class="co"># result = asyncio.run(echo.invoke("Hello, World!"))</span></span>
<span id="cb110-189"><a href="#cb110-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-190"><a href="#cb110-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-191"><a href="#cb110-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### A Note on Async/Sync in Jupyter</span></span>
<span id="cb110-192"><a href="#cb110-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-193"><a href="#cb110-193" aria-hidden="true" tabindex="-1"></a>Jupyter notebooks run in an async environment, which affects how we call nanobricks:</span>
<span id="cb110-194"><a href="#cb110-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-195"><a href="#cb110-195" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**In Jupyter/Quarto**: Use <span class="in">`await`</span> directly (the running event loop prevents <span class="in">`asyncio.run()`</span>)</span>
<span id="cb110-196"><a href="#cb110-196" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**In regular Python scripts**: Use <span class="in">`invoke_sync()`</span> or <span class="in">`asyncio.run()`</span></span>
<span id="cb110-197"><a href="#cb110-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-198"><a href="#cb110-198" aria-hidden="true" tabindex="-1"></a>The <span class="in">`invoke_sync()`</span> method and <span class="in">`asyncio.run()`</span> are designed for non-async contexts and will raise errors in Jupyter due to the existing event loop. This is why we use <span class="in">`await`</span> directly in this notebook.</span>
<span id="cb110-199"><a href="#cb110-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-200"><a href="#cb110-200" aria-hidden="true" tabindex="-1"></a><span class="fu">### What Makes a Nanobrick?</span></span>
<span id="cb110-201"><a href="#cb110-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-202"><a href="#cb110-202" aria-hidden="true" tabindex="-1"></a>Every nanobrick has:</span>
<span id="cb110-203"><a href="#cb110-203" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**A name**: Defaults to the class name</span>
<span id="cb110-204"><a href="#cb110-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**A version**: Defaults to "0.1.0"</span>
<span id="cb110-205"><a href="#cb110-205" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**An async invoke method**: The core processing logic</span>
<span id="cb110-206"><a href="#cb110-206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Type parameters**: Input type, output type, and optional dependencies</span>
<span id="cb110-207"><a href="#cb110-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-210"><a href="#cb110-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-211"><a href="#cb110-211" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-212"><a href="#cb110-212" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-213"><a href="#cb110-213" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-214"><a href="#cb110-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-215"><a href="#cb110-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the nanobrick properties</span></span>
<span id="cb110-216"><a href="#cb110-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Name: </span><span class="sc">{</span>echo<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-217"><a href="#cb110-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Version: </span><span class="sc">{</span>echo<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-218"><a href="#cb110-218" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"String representation: </span><span class="sc">{</span><span class="bu">str</span>(echo)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-219"><a href="#cb110-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-220"><a href="#cb110-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-221"><a href="#cb110-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Composition Magic ✅</span></span>
<span id="cb110-222"><a href="#cb110-222" aria-hidden="true" tabindex="-1"></a>*Status: Complete*</span>
<span id="cb110-223"><a href="#cb110-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-224"><a href="#cb110-224" aria-hidden="true" tabindex="-1"></a>The pipe operator is working! Here's how to compose nanobricks:</span>
<span id="cb110-225"><a href="#cb110-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-228"><a href="#cb110-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-229"><a href="#cb110-229" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-230"><a href="#cb110-230" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-231"><a href="#cb110-231" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-232"><a href="#cb110-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-233"><a href="#cb110-233" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb110-234"><a href="#cb110-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-235"><a href="#cb110-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-236"><a href="#cb110-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some bricks</span></span>
<span id="cb110-237"><a href="#cb110-237" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GreetBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-238"><a href="#cb110-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-239"><a href="#cb110-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">!"</span></span>
<span id="cb110-240"><a href="#cb110-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-241"><a href="#cb110-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-242"><a href="#cb110-242" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ShoutBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-243"><a href="#cb110-243" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-244"><a href="#cb110-244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.upper()</span>
<span id="cb110-245"><a href="#cb110-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-246"><a href="#cb110-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-247"><a href="#cb110-247" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose them!</span></span>
<span id="cb110-248"><a href="#cb110-248" aria-hidden="true" tabindex="-1"></a>greet <span class="op">=</span> GreetBrick()</span>
<span id="cb110-249"><a href="#cb110-249" aria-hidden="true" tabindex="-1"></a>shout <span class="op">=</span> ShoutBrick()</span>
<span id="cb110-250"><a href="#cb110-250" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> greet <span class="op">|</span> shout</span>
<span id="cb110-251"><a href="#cb110-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-252"><a href="#cb110-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the pipeline</span></span>
<span id="cb110-253"><a href="#cb110-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Native Jupyter async style</span></span>
<span id="cb110-254"><a href="#cb110-254" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"world"</span>)</span>
<span id="cb110-255"><a href="#cb110-255" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline (await): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-256"><a href="#cb110-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-257"><a href="#cb110-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Another await call (since we're in async environment)</span></span>
<span id="cb110-258"><a href="#cb110-258" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"python"</span>)</span>
<span id="cb110-259"><a href="#cb110-259" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline (second call): </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-260"><a href="#cb110-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-261"><a href="#cb110-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-262"><a href="#cb110-262" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced Composition</span></span>
<span id="cb110-263"><a href="#cb110-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-264"><a href="#cb110-264" aria-hidden="true" tabindex="-1"></a>You can chain multiple bricks and even compose different types:</span>
<span id="cb110-265"><a href="#cb110-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-268"><a href="#cb110-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-269"><a href="#cb110-269" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-270"><a href="#cb110-270" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-271"><a href="#cb110-271" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-272"><a href="#cb110-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-273"><a href="#cb110-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Chain multiple bricks</span></span>
<span id="cb110-274"><a href="#cb110-274" aria-hidden="true" tabindex="-1"></a>excited <span class="op">=</span> greet <span class="op">|</span> shout <span class="op">|</span> shout  <span class="co"># Double shout!</span></span>
<span id="cb110-275"><a href="#cb110-275" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> excited.invoke(<span class="st">"alice"</span>)</span>
<span id="cb110-276"><a href="#cb110-276" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Double shout: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-277"><a href="#cb110-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-278"><a href="#cb110-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-279"><a href="#cb110-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Type transformations</span></span>
<span id="cb110-280"><a href="#cb110-280" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LengthBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">int</span>]):</span>
<span id="cb110-281"><a href="#cb110-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb110-282"><a href="#cb110-282" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="bu">input</span>)</span>
<span id="cb110-283"><a href="#cb110-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-284"><a href="#cb110-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-285"><a href="#cb110-285" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates a pipeline: str -&gt; str -&gt; int</span></span>
<span id="cb110-286"><a href="#cb110-286" aria-hidden="true" tabindex="-1"></a>count_greeting <span class="op">=</span> greet <span class="op">|</span> LengthBrick()</span>
<span id="cb110-287"><a href="#cb110-287" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> count_greeting.invoke(<span class="st">"bob"</span>)</span>
<span id="cb110-288"><a href="#cb110-288" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Length of greeting: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss"> (for 'Hello, bob!')"</span>)</span>
<span id="cb110-289"><a href="#cb110-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-290"><a href="#cb110-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-291"><a href="#cb110-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Error propagation (fail-fast)</span></span>
<span id="cb110-292"><a href="#cb110-292" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidateBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-293"><a href="#cb110-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-294"><a href="#cb110-294" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">input</span>.isalpha():</span>
<span id="cb110-295"><a href="#cb110-295" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Only letters allowed"</span>)</span>
<span id="cb110-296"><a href="#cb110-296" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb110-297"><a href="#cb110-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-298"><a href="#cb110-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-299"><a href="#cb110-299" aria-hidden="true" tabindex="-1"></a>safe_greet <span class="op">=</span> ValidateBrick() <span class="op">|</span> greet <span class="op">|</span> shout</span>
<span id="cb110-300"><a href="#cb110-300" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-301"><a href="#cb110-301" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> safe_greet.invoke(<span class="st">"123"</span>)</span>
<span id="cb110-302"><a href="#cb110-302" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb110-303"><a href="#cb110-303" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Caught expected error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-304"><a href="#cb110-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-305"><a href="#cb110-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-306"><a href="#cb110-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pipeline Class</span></span>
<span id="cb110-307"><a href="#cb110-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-308"><a href="#cb110-308" aria-hidden="true" tabindex="-1"></a>For longer compositions, use the Pipeline class:</span>
<span id="cb110-309"><a href="#cb110-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-312"><a href="#cb110-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-313"><a href="#cb110-313" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-314"><a href="#cb110-314" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-315"><a href="#cb110-315" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-316"><a href="#cb110-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-317"><a href="#cb110-317" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Pipeline</span>
<span id="cb110-318"><a href="#cb110-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-319"><a href="#cb110-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-320"><a href="#cb110-320" aria-hidden="true" tabindex="-1"></a><span class="co"># First define the missing brick</span></span>
<span id="cb110-321"><a href="#cb110-321" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AddExclamationBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-322"><a href="#cb110-322" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-323"><a href="#cb110-323" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">!!!!"</span></span>
<span id="cb110-324"><a href="#cb110-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-325"><a href="#cb110-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-326"><a href="#cb110-326" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline from multiple bricks</span></span>
<span id="cb110-327"><a href="#cb110-327" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(ValidateBrick(), GreetBrick(), ShoutBrick(), AddExclamationBrick())</span>
<span id="cb110-328"><a href="#cb110-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-329"><a href="#cb110-329" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(<span class="st">"world"</span>)</span>
<span id="cb110-330"><a href="#cb110-330" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-331"><a href="#cb110-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-332"><a href="#cb110-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-333"><a href="#cb110-333" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Dependency Injection ✅</span></span>
<span id="cb110-334"><a href="#cb110-334" aria-hidden="true" tabindex="-1"></a>*Status: Complete*</span>
<span id="cb110-335"><a href="#cb110-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-336"><a href="#cb110-336" aria-hidden="true" tabindex="-1"></a>Your nanobricks can now share resources! Here's how dependency injection works:</span>
<span id="cb110-337"><a href="#cb110-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-340"><a href="#cb110-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-341"><a href="#cb110-341" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-342"><a href="#cb110-342" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-343"><a href="#cb110-343" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-344"><a href="#cb110-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-345"><a href="#cb110-345" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase, StandardDeps, DependencyContainer</span>
<span id="cb110-346"><a href="#cb110-346" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.dependencies <span class="im">import</span> MockDatabase, MockLogger</span>
<span id="cb110-347"><a href="#cb110-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-348"><a href="#cb110-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-349"><a href="#cb110-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a brick that uses dependencies</span></span>
<span id="cb110-350"><a href="#cb110-350" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserLoaderBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb110-351"><a href="#cb110-351" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, user_id: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-352"><a href="#cb110-352" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> deps <span class="kw">or</span> <span class="st">"db"</span> <span class="kw">not</span> <span class="kw">in</span> deps:</span>
<span id="cb110-353"><a href="#cb110-353" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Database dependency required"</span>)</span>
<span id="cb110-354"><a href="#cb110-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-355"><a href="#cb110-355" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use the database from deps</span></span>
<span id="cb110-356"><a href="#cb110-356" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"db"</span>].query(<span class="ss">f"SELECT * FROM users WHERE id = </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-357"><a href="#cb110-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-358"><a href="#cb110-358" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Optional: use logger if available</span></span>
<span id="cb110-359"><a href="#cb110-359" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-360"><a href="#cb110-360" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"logger"</span>].info(<span class="ss">f"Loaded user </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-361"><a href="#cb110-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-362"><a href="#cb110-362" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result[<span class="dv">0</span>]</span>
<span id="cb110-363"><a href="#cb110-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-364"><a href="#cb110-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-365"><a href="#cb110-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dependencies</span></span>
<span id="cb110-366"><a href="#cb110-366" aria-hidden="true" tabindex="-1"></a>deps <span class="op">=</span> DependencyContainer(</span>
<span id="cb110-367"><a href="#cb110-367" aria-hidden="true" tabindex="-1"></a>    db<span class="op">=</span>MockDatabase(</span>
<span id="cb110-368"><a href="#cb110-368" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"SELECT * FROM users WHERE id = 123"</span>: [{<span class="st">"id"</span>: <span class="dv">123</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>}]}</span>
<span id="cb110-369"><a href="#cb110-369" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb110-370"><a href="#cb110-370" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">=</span>MockLogger(),</span>
<span id="cb110-371"><a href="#cb110-371" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>{<span class="st">"tenant"</span>: <span class="st">"AcmeCorp"</span>},</span>
<span id="cb110-372"><a href="#cb110-372" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-373"><a href="#cb110-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-374"><a href="#cb110-374" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the brick with dependencies</span></span>
<span id="cb110-375"><a href="#cb110-375" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> UserLoaderBrick()</span>
<span id="cb110-376"><a href="#cb110-376" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb110-377"><a href="#cb110-377" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded user: </span><span class="sc">{</span>user<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-378"><a href="#cb110-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-379"><a href="#cb110-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-380"><a href="#cb110-380" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dependency Types</span></span>
<span id="cb110-381"><a href="#cb110-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-382"><a href="#cb110-382" aria-hidden="true" tabindex="-1"></a>We provide some common dependency types:</span>
<span id="cb110-383"><a href="#cb110-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-386"><a href="#cb110-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-387"><a href="#cb110-387" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-388"><a href="#cb110-388" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-389"><a href="#cb110-389" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-390"><a href="#cb110-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-391"><a href="#cb110-391" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> StandardDeps</span>
<span id="cb110-392"><a href="#cb110-392" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> TypedDict</span>
<span id="cb110-393"><a href="#cb110-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-394"><a href="#cb110-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Show what StandardDeps looks like</span></span>
<span id="cb110-395"><a href="#cb110-395" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"StandardDeps is a TypedDict with the following fields:"</span>)</span>
<span id="cb110-396"><a href="#cb110-396" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- db: Database connection"</span>)</span>
<span id="cb110-397"><a href="#cb110-397" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- cache: Cache instance"</span>)</span>
<span id="cb110-398"><a href="#cb110-398" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- logger: Logger instance"</span>)</span>
<span id="cb110-399"><a href="#cb110-399" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- config: Configuration dict"</span>)</span>
<span id="cb110-400"><a href="#cb110-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-401"><a href="#cb110-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-402"><a href="#cb110-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of creating your own dependency type</span></span>
<span id="cb110-403"><a href="#cb110-403" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDeps(TypedDict):</span>
<span id="cb110-404"><a href="#cb110-404" aria-hidden="true" tabindex="-1"></a>    api_client: <span class="bu">object</span>  <span class="co"># Would be your APIClient type</span></span>
<span id="cb110-405"><a href="#cb110-405" aria-hidden="true" tabindex="-1"></a>    feature_flags: <span class="bu">dict</span></span>
<span id="cb110-406"><a href="#cb110-406" aria-hidden="true" tabindex="-1"></a>    user_context: <span class="bu">dict</span>  <span class="co"># Would be your UserContext type</span></span>
<span id="cb110-407"><a href="#cb110-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-408"><a href="#cb110-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-409"><a href="#cb110-409" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Custom dependency type created successfully!"</span>)</span>
<span id="cb110-410"><a href="#cb110-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-411"><a href="#cb110-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-412"><a href="#cb110-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dependencies in Pipelines</span></span>
<span id="cb110-413"><a href="#cb110-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-414"><a href="#cb110-414" aria-hidden="true" tabindex="-1"></a>Dependencies flow through entire pipelines automatically:</span>
<span id="cb110-415"><a href="#cb110-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-418"><a href="#cb110-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-419"><a href="#cb110-419" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-420"><a href="#cb110-420" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-421"><a href="#cb110-421" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-422"><a href="#cb110-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-423"><a href="#cb110-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Define example bricks for the pipeline</span></span>
<span id="cb110-424"><a href="#cb110-424" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EnrichBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb110-425"><a href="#cb110-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-426"><a href="#cb110-426" aria-hidden="true" tabindex="-1"></a>        enriched <span class="op">=</span> data.copy()</span>
<span id="cb110-427"><a href="#cb110-427" aria-hidden="true" tabindex="-1"></a>        enriched[<span class="st">"enriched"</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb110-428"><a href="#cb110-428" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> deps <span class="kw">and</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-429"><a href="#cb110-429" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"logger"</span>].info(<span class="st">"Data enriched"</span>)</span>
<span id="cb110-430"><a href="#cb110-430" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> enriched</span>
<span id="cb110-431"><a href="#cb110-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-432"><a href="#cb110-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-433"><a href="#cb110-433" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SaveBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb110-434"><a href="#cb110-434" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-435"><a href="#cb110-435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> deps <span class="kw">and</span> <span class="st">"db"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-436"><a href="#cb110-436" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Simulate saving to database</span></span>
<span id="cb110-437"><a href="#cb110-437" aria-hidden="true" tabindex="-1"></a>            deps[<span class="st">"db"</span>].queries.append(<span class="ss">f"INSERT INTO data VALUES (</span><span class="sc">{</span>data<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb110-438"><a href="#cb110-438" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb110-439"><a href="#cb110-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-440"><a href="#cb110-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-441"><a href="#cb110-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a UserValidateBrick that works with dict input</span></span>
<span id="cb110-442"><a href="#cb110-442" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserValidateBrick(NanobrickBase[<span class="bu">dict</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb110-443"><a href="#cb110-443" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, data: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-444"><a href="#cb110-444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"name"</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb110-445"><a href="#cb110-445" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Name is required"</span>)</span>
<span id="cb110-446"><a href="#cb110-446" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb110-447"><a href="#cb110-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-448"><a href="#cb110-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-449"><a href="#cb110-449" aria-hidden="true" tabindex="-1"></a><span class="co"># All bricks in the pipeline receive the same deps</span></span>
<span id="cb110-450"><a href="#cb110-450" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> UserValidateBrick() <span class="op">|</span> EnrichBrick() <span class="op">|</span> SaveBrick()</span>
<span id="cb110-451"><a href="#cb110-451" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">"id"</span>: <span class="dv">123</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>}</span>
<span id="cb110-452"><a href="#cb110-452" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> pipeline.invoke(data, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb110-453"><a href="#cb110-453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pipeline result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-454"><a href="#cb110-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-455"><a href="#cb110-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-456"><a href="#cb110-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Configuration Power</span></span>
<span id="cb110-457"><a href="#cb110-457" aria-hidden="true" tabindex="-1"></a>*Status: Complete! ✅*</span>
<span id="cb110-458"><a href="#cb110-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-459"><a href="#cb110-459" aria-hidden="true" tabindex="-1"></a>Nanobricks now supports powerful TOML-based configuration with environment overrides!</span>
<span id="cb110-460"><a href="#cb110-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-461"><a href="#cb110-461" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Loading Configuration</span></span>
<span id="cb110-462"><a href="#cb110-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-465"><a href="#cb110-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-466"><a href="#cb110-466" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-467"><a href="#cb110-467" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-468"><a href="#cb110-468" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-469"><a href="#cb110-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-470"><a href="#cb110-470" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> load_config, get_default_config</span>
<span id="cb110-471"><a href="#cb110-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-472"><a href="#cb110-472" aria-hidden="true" tabindex="-1"></a><span class="co"># Load default config (searches for nanobrick.toml, pyproject.toml, etc.)</span></span>
<span id="cb110-473"><a href="#cb110-473" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> load_config()</span>
<span id="cb110-474"><a href="#cb110-474" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Default config loaded: </span><span class="sc">{</span><span class="bu">type</span>(config)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-475"><a href="#cb110-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-476"><a href="#cb110-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Load with specific environment</span></span>
<span id="cb110-477"><a href="#cb110-477" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-478"><a href="#cb110-478" aria-hidden="true" tabindex="-1"></a>    prod_config <span class="op">=</span> load_config(environment<span class="op">=</span><span class="st">"production"</span>)</span>
<span id="cb110-479"><a href="#cb110-479" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Production config loaded successfully"</span>)</span>
<span id="cb110-480"><a href="#cb110-480" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb110-481"><a href="#cb110-481" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No production environment config found (expected)"</span>)</span>
<span id="cb110-482"><a href="#cb110-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-483"><a href="#cb110-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Load with overrides</span></span>
<span id="cb110-484"><a href="#cb110-484" aria-hidden="true" tabindex="-1"></a>custom_config <span class="op">=</span> load_config(overrides<span class="op">=</span>{<span class="st">"logging"</span>: {<span class="st">"level"</span>: <span class="st">"DEBUG"</span>}})</span>
<span id="cb110-485"><a href="#cb110-485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb110-486"><a href="#cb110-486" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Custom override - log level: </span><span class="sc">{</span>custom_config<span class="sc">.</span>get(<span class="st">'logging'</span>, {})<span class="sc">.</span>get(<span class="st">'level'</span>, <span class="st">'INFO'</span>)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb110-487"><a href="#cb110-487" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-488"><a href="#cb110-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-489"><a href="#cb110-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Get cached default config</span></span>
<span id="cb110-490"><a href="#cb110-490" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> get_default_config()</span>
<span id="cb110-491"><a href="#cb110-491" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cached config type: </span><span class="sc">{</span><span class="bu">type</span>(config)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-492"><a href="#cb110-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-493"><a href="#cb110-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-494"><a href="#cb110-494" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Configuration Files</span></span>
<span id="cb110-495"><a href="#cb110-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-496"><a href="#cb110-496" aria-hidden="true" tabindex="-1"></a>Create a <span class="in">`nanobrick.toml`</span> file:</span>
<span id="cb110-497"><a href="#cb110-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-498"><a href="#cb110-498" aria-hidden="true" tabindex="-1"></a><span class="in">```toml</span></span>
<span id="cb110-499"><a href="#cb110-499" aria-hidden="true" tabindex="-1"></a><span class="in">[project]</span></span>
<span id="cb110-500"><a href="#cb110-500" aria-hidden="true" tabindex="-1"></a><span class="in">name = "my-project"</span></span>
<span id="cb110-501"><a href="#cb110-501" aria-hidden="true" tabindex="-1"></a><span class="in">version = "1.0.0"</span></span>
<span id="cb110-502"><a href="#cb110-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-503"><a href="#cb110-503" aria-hidden="true" tabindex="-1"></a><span class="in">[logging]</span></span>
<span id="cb110-504"><a href="#cb110-504" aria-hidden="true" tabindex="-1"></a><span class="in">level = "INFO"</span></span>
<span id="cb110-505"><a href="#cb110-505" aria-hidden="true" tabindex="-1"></a><span class="in">format = "simple"</span></span>
<span id="cb110-506"><a href="#cb110-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-507"><a href="#cb110-507" aria-hidden="true" tabindex="-1"></a><span class="in">[database]</span></span>
<span id="cb110-508"><a href="#cb110-508" aria-hidden="true" tabindex="-1"></a><span class="in">url = "sqlite:///app.db"</span></span>
<span id="cb110-509"><a href="#cb110-509" aria-hidden="true" tabindex="-1"></a><span class="in">pool_size = 5</span></span>
<span id="cb110-510"><a href="#cb110-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-511"><a href="#cb110-511" aria-hidden="true" tabindex="-1"></a><span class="in"># Environment-specific overrides</span></span>
<span id="cb110-512"><a href="#cb110-512" aria-hidden="true" tabindex="-1"></a><span class="in">[environments.production]</span></span>
<span id="cb110-513"><a href="#cb110-513" aria-hidden="true" tabindex="-1"></a><span class="in">[environments.production.database]</span></span>
<span id="cb110-514"><a href="#cb110-514" aria-hidden="true" tabindex="-1"></a><span class="in">url = "postgresql://prod-server/app"</span></span>
<span id="cb110-515"><a href="#cb110-515" aria-hidden="true" tabindex="-1"></a><span class="in">pool_size = 20</span></span>
<span id="cb110-516"><a href="#cb110-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-517"><a href="#cb110-517" aria-hidden="true" tabindex="-1"></a><span class="in">[environments.test]</span></span>
<span id="cb110-518"><a href="#cb110-518" aria-hidden="true" tabindex="-1"></a><span class="in">[environments.test.database]</span></span>
<span id="cb110-519"><a href="#cb110-519" aria-hidden="true" tabindex="-1"></a><span class="in">url = "sqlite:///:memory:"</span></span>
<span id="cb110-520"><a href="#cb110-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-521"><a href="#cb110-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-522"><a href="#cb110-522" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Using Config in Bricks</span></span>
<span id="cb110-523"><a href="#cb110-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-526"><a href="#cb110-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-527"><a href="#cb110-527" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-528"><a href="#cb110-528" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-529"><a href="#cb110-529" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-530"><a href="#cb110-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-531"><a href="#cb110-531" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase</span>
<span id="cb110-532"><a href="#cb110-532" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> get_default_config, Config</span>
<span id="cb110-533"><a href="#cb110-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-534"><a href="#cb110-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-535"><a href="#cb110-535" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConfigurableBrick(NanobrickBase[<span class="bu">str</span>, <span class="bu">str</span>, <span class="va">None</span>]):</span>
<span id="cb110-536"><a href="#cb110-536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb110-537"><a href="#cb110-537" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> <span class="st">"configurable"</span></span>
<span id="cb110-538"><a href="#cb110-538" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.version <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span id="cb110-539"><a href="#cb110-539" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> get_default_config()</span>
<span id="cb110-540"><a href="#cb110-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-541"><a href="#cb110-541" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-542"><a href="#cb110-542" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Access config safely with get() method</span></span>
<span id="cb110-543"><a href="#cb110-543" aria-hidden="true" tabindex="-1"></a>        log_level <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"logging"</span>, {}).get(<span class="st">"level"</span>, <span class="st">"INFO"</span>)</span>
<span id="cb110-544"><a href="#cb110-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-545"><a href="#cb110-545" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Or dictionary style</span></span>
<span id="cb110-546"><a href="#cb110-546" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"features"</span>, {})</span>
<span id="cb110-547"><a href="#cb110-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-548"><a href="#cb110-548" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Processed '</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span>log_level<span class="sc">}</span><span class="ss"> logging"</span></span>
<span id="cb110-549"><a href="#cb110-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-550"><a href="#cb110-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-551"><a href="#cb110-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the configurable brick</span></span>
<span id="cb110-552"><a href="#cb110-552" aria-hidden="true" tabindex="-1"></a>configurable <span class="op">=</span> ConfigurableBrick()</span>
<span id="cb110-553"><a href="#cb110-553" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> configurable.invoke(<span class="st">"test data"</span>)</span>
<span id="cb110-554"><a href="#cb110-554" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-555"><a href="#cb110-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-556"><a href="#cb110-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-557"><a href="#cb110-557" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Config Object Features</span></span>
<span id="cb110-558"><a href="#cb110-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-559"><a href="#cb110-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dot notation access**: <span class="in">`config.database.host`</span></span>
<span id="cb110-560"><a href="#cb110-560" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dictionary access**: <span class="in">`config["database"]["host"]`</span></span>
<span id="cb110-561"><a href="#cb110-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Safe get with defaults**: <span class="in">`config.get("missing", "default")`</span></span>
<span id="cb110-562"><a href="#cb110-562" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Immutable with freeze**: <span class="in">`config.freeze()`</span></span>
<span id="cb110-563"><a href="#cb110-563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Environment support**: Automatic env-specific overrides</span>
<span id="cb110-564"><a href="#cb110-564" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Discovery chain**: Searches up directory tree for config files</span>
<span id="cb110-565"><a href="#cb110-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-566"><a href="#cb110-566" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Real Example from examples/configuration.py</span></span>
<span id="cb110-567"><a href="#cb110-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-570"><a href="#cb110-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-571"><a href="#cb110-571" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-572"><a href="#cb110-572" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-573"><a href="#cb110-573" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-574"><a href="#cb110-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-575"><a href="#cb110-575" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate Config API features</span></span>
<span id="cb110-576"><a href="#cb110-576" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> Config</span>
<span id="cb110-577"><a href="#cb110-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-578"><a href="#cb110-578" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a config object</span></span>
<span id="cb110-579"><a href="#cb110-579" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> Config(</span>
<span id="cb110-580"><a href="#cb110-580" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb110-581"><a href="#cb110-581" aria-hidden="true" tabindex="-1"></a>        <span class="st">"app"</span>: {</span>
<span id="cb110-582"><a href="#cb110-582" aria-hidden="true" tabindex="-1"></a>            <span class="st">"name"</span>: <span class="st">"demo"</span>,</span>
<span id="cb110-583"><a href="#cb110-583" aria-hidden="true" tabindex="-1"></a>            <span class="st">"version"</span>: <span class="st">"1.0.0"</span>,</span>
<span id="cb110-584"><a href="#cb110-584" aria-hidden="true" tabindex="-1"></a>            <span class="st">"settings"</span>: {<span class="st">"debug"</span>: <span class="va">True</span>, <span class="st">"timeout"</span>: <span class="dv">30</span>},</span>
<span id="cb110-585"><a href="#cb110-585" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb110-586"><a href="#cb110-586" aria-hidden="true" tabindex="-1"></a>        <span class="st">"features"</span>: [<span class="st">"auth"</span>, <span class="st">"api"</span>, <span class="st">"cache"</span>],</span>
<span id="cb110-587"><a href="#cb110-587" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-588"><a href="#cb110-588" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-589"><a href="#cb110-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-590"><a href="#cb110-590" aria-hidden="true" tabindex="-1"></a><span class="co"># Dot notation access</span></span>
<span id="cb110-591"><a href="#cb110-591" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"App name: </span><span class="sc">{</span>config<span class="sc">.</span>app<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-592"><a href="#cb110-592" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Debug mode: </span><span class="sc">{</span>config<span class="sc">.</span>app<span class="sc">.</span>settings<span class="sc">.</span>debug<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-593"><a href="#cb110-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-594"><a href="#cb110-594" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionary access</span></span>
<span id="cb110-595"><a href="#cb110-595" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>config[<span class="st">'features'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-596"><a href="#cb110-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-597"><a href="#cb110-597" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe get with default</span></span>
<span id="cb110-598"><a href="#cb110-598" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing key: </span><span class="sc">{</span>config<span class="sc">.</span>get(<span class="st">'missing'</span>, <span class="st">'default value'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-599"><a href="#cb110-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-600"><a href="#cb110-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert back to dict</span></span>
<span id="cb110-601"><a href="#cb110-601" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> config.to_dict()</span>
<span id="cb110-602"><a href="#cb110-602" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"As dict type: </span><span class="sc">{</span><span class="bu">type</span>(data)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-603"><a href="#cb110-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-604"><a href="#cb110-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-605"><a href="#cb110-605" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Working with Environment-Specific Configs</span></span>
<span id="cb110-606"><a href="#cb110-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-609"><a href="#cb110-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-610"><a href="#cb110-610" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-611"><a href="#cb110-611" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-612"><a href="#cb110-612" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-613"><a href="#cb110-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-614"><a href="#cb110-614" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of how environment configs work</span></span>
<span id="cb110-615"><a href="#cb110-615" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.config <span class="im">import</span> Config</span>
<span id="cb110-616"><a href="#cb110-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-617"><a href="#cb110-617" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a config with environments</span></span>
<span id="cb110-618"><a href="#cb110-618" aria-hidden="true" tabindex="-1"></a>full_config <span class="op">=</span> Config(</span>
<span id="cb110-619"><a href="#cb110-619" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb110-620"><a href="#cb110-620" aria-hidden="true" tabindex="-1"></a>        <span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"sqlite:///dev.db"</span>, <span class="st">"pool_size"</span>: <span class="dv">5</span>},</span>
<span id="cb110-621"><a href="#cb110-621" aria-hidden="true" tabindex="-1"></a>        <span class="st">"environments"</span>: {</span>
<span id="cb110-622"><a href="#cb110-622" aria-hidden="true" tabindex="-1"></a>            <span class="st">"production"</span>: {</span>
<span id="cb110-623"><a href="#cb110-623" aria-hidden="true" tabindex="-1"></a>                <span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"postgresql://prod-server/app"</span>, <span class="st">"pool_size"</span>: <span class="dv">20</span>}</span>
<span id="cb110-624"><a href="#cb110-624" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb110-625"><a href="#cb110-625" aria-hidden="true" tabindex="-1"></a>            <span class="st">"test"</span>: {<span class="st">"database"</span>: {<span class="st">"url"</span>: <span class="st">"sqlite:///:memory:"</span>}},</span>
<span id="cb110-626"><a href="#cb110-626" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb110-627"><a href="#cb110-627" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-628"><a href="#cb110-628" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-629"><a href="#cb110-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-630"><a href="#cb110-630" aria-hidden="true" tabindex="-1"></a><span class="co"># In real usage, load_config(environment="production") would apply these overrides</span></span>
<span id="cb110-631"><a href="#cb110-631" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dev database: </span><span class="sc">{</span>full_config<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-632"><a href="#cb110-632" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Prod database: </span><span class="sc">{</span>full_config<span class="sc">.</span>environments<span class="sc">.</span>production<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-633"><a href="#cb110-633" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test database: </span><span class="sc">{</span>full_config<span class="sc">.</span>environments<span class="sc">.</span>test<span class="sc">.</span>database<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-634"><a href="#cb110-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-635"><a href="#cb110-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-636"><a href="#cb110-636" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Skills Activate!</span></span>
<span id="cb110-637"><a href="#cb110-637" aria-hidden="true" tabindex="-1"></a>*Status: Complete! ✅*</span>
<span id="cb110-638"><a href="#cb110-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-639"><a href="#cb110-639" aria-hidden="true" tabindex="-1"></a>The skill framework is now working! Add capabilities on demand without changing your brick's core logic.</span>
<span id="cb110-640"><a href="#cb110-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-641"><a href="#cb110-641" aria-hidden="true" tabindex="-1"></a><span class="fu">#### What Are Skills?</span></span>
<span id="cb110-642"><a href="#cb110-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-643"><a href="#cb110-643" aria-hidden="true" tabindex="-1"></a>Skills are optional capabilities that nanobricks can activate when needed:</span>
<span id="cb110-644"><a href="#cb110-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-645"><a href="#cb110-645" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Timing**: Measure execution time ✅</span>
<span id="cb110-646"><a href="#cb110-646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Retry**: Automatic retry on failure ✅</span>
<span id="cb110-647"><a href="#cb110-647" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Caching**: Cache results for repeated calls ✅</span>
<span id="cb110-648"><a href="#cb110-648" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Logging**: Automatic logging of inputs/outputs ✅</span>
<span id="cb110-649"><a href="#cb110-649" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**API**: Expose as REST endpoints ✅</span>
<span id="cb110-650"><a href="#cb110-650" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CLI**: Command-line interface ✅</span>
<span id="cb110-651"><a href="#cb110-651" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Observability**: Metrics and tracing (coming soon)</span>
<span id="cb110-652"><a href="#cb110-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-653"><a href="#cb110-653" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Creating a Skill</span></span>
<span id="cb110-654"><a href="#cb110-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-657"><a href="#cb110-657" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-658"><a href="#cb110-658" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-659"><a href="#cb110-659" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-660"><a href="#cb110-660" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-661"><a href="#cb110-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-662"><a href="#cb110-662" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Skill, EnhancedBrick, register_skill</span>
<span id="cb110-663"><a href="#cb110-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-664"><a href="#cb110-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-665"><a href="#cb110-665" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"timing"</span>)</span>
<span id="cb110-666"><a href="#cb110-666" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TimingSkill(Skill):</span>
<span id="cb110-667"><a href="#cb110-667" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adds timing information to brick invocations."""</span></span>
<span id="cb110-668"><a href="#cb110-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-669"><a href="#cb110-669" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb110-670"><a href="#cb110-670" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> time</span>
<span id="cb110-671"><a href="#cb110-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-672"><a href="#cb110-672" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> TimingEnhanced(EnhancedBrick):</span>
<span id="cb110-673"><a href="#cb110-673" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb110-674"><a href="#cb110-674" aria-hidden="true" tabindex="-1"></a>                start <span class="op">=</span> time.time()</span>
<span id="cb110-675"><a href="#cb110-675" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb110-676"><a href="#cb110-676" aria-hidden="true" tabindex="-1"></a>                elapsed <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb110-677"><a href="#cb110-677" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"⏱️  </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_wrapped<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> took </span><span class="sc">{</span>elapsed<span class="sc">:.3f}</span><span class="ss">s"</span>)</span>
<span id="cb110-678"><a href="#cb110-678" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> result</span>
<span id="cb110-679"><a href="#cb110-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-680"><a href="#cb110-680" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> TimingEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb110-681"><a href="#cb110-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-682"><a href="#cb110-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-683"><a href="#cb110-683" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TimingSkill registered!"</span>)</span>
<span id="cb110-684"><a href="#cb110-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-685"><a href="#cb110-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-686"><a href="#cb110-686" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Using Skills</span></span>
<span id="cb110-687"><a href="#cb110-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-688"><a href="#cb110-688" aria-hidden="true" tabindex="-1"></a>There are three ways to add skills to your bricks:</span>
<span id="cb110-689"><a href="#cb110-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-690"><a href="#cb110-690" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 1. Method Chaining</span></span>
<span id="cb110-691"><a href="#cb110-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-694"><a href="#cb110-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-695"><a href="#cb110-695" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-696"><a href="#cb110-696" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-697"><a href="#cb110-697" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-698"><a href="#cb110-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-699"><a href="#cb110-699" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple brick</span></span>
<span id="cb110-700"><a href="#cb110-700" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SlowBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-701"><a href="#cb110-701" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-702"><a href="#cb110-702" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)  <span class="co"># Simulate slow work</span></span>
<span id="cb110-703"><a href="#cb110-703" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Processed: </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb110-704"><a href="#cb110-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-705"><a href="#cb110-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-706"><a href="#cb110-706" aria-hidden="true" tabindex="-1"></a><span class="co"># Add timing skill</span></span>
<span id="cb110-707"><a href="#cb110-707" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> SlowBrick()</span>
<span id="cb110-708"><a href="#cb110-708" aria-hidden="true" tabindex="-1"></a>timed_brick <span class="op">=</span> brick.with_skill(<span class="st">"timing"</span>)</span>
<span id="cb110-709"><a href="#cb110-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-710"><a href="#cb110-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Use it</span></span>
<span id="cb110-711"><a href="#cb110-711" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> timed_brick.invoke(<span class="st">"hello"</span>)</span>
<span id="cb110-712"><a href="#cb110-712" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-713"><a href="#cb110-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-714"><a href="#cb110-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-715"><a href="#cb110-715" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 2. Function Style</span></span>
<span id="cb110-716"><a href="#cb110-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-719"><a href="#cb110-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-720"><a href="#cb110-720" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-721"><a href="#cb110-721" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-722"><a href="#cb110-722" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-723"><a href="#cb110-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-724"><a href="#cb110-724" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> with_skill</span>
<span id="cb110-725"><a href="#cb110-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-726"><a href="#cb110-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-727"><a href="#cb110-727" aria-hidden="true" tabindex="-1"></a><span class="co"># Add multiple skills</span></span>
<span id="cb110-728"><a href="#cb110-728" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"cache"</span>)</span>
<span id="cb110-729"><a href="#cb110-729" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CacheSkill(Skill):</span>
<span id="cb110-730"><a href="#cb110-730" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb110-731"><a href="#cb110-731" aria-hidden="true" tabindex="-1"></a>        cache <span class="op">=</span> {}</span>
<span id="cb110-732"><a href="#cb110-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-733"><a href="#cb110-733" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> CacheEnhanced(EnhancedBrick):</span>
<span id="cb110-734"><a href="#cb110-734" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb110-735"><a href="#cb110-735" aria-hidden="true" tabindex="-1"></a>                key <span class="op">=</span> <span class="bu">str</span>(<span class="bu">input</span>)</span>
<span id="cb110-736"><a href="#cb110-736" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> key <span class="kw">in</span> cache:</span>
<span id="cb110-737"><a href="#cb110-737" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"💾 Cache hit for: </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-738"><a href="#cb110-738" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> cache[key]</span>
<span id="cb110-739"><a href="#cb110-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-740"><a href="#cb110-740" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb110-741"><a href="#cb110-741" aria-hidden="true" tabindex="-1"></a>                cache[key] <span class="op">=</span> result</span>
<span id="cb110-742"><a href="#cb110-742" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"💾 Cached: </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-743"><a href="#cb110-743" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> result</span>
<span id="cb110-744"><a href="#cb110-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-745"><a href="#cb110-745" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> CacheEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb110-746"><a href="#cb110-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-747"><a href="#cb110-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-748"><a href="#cb110-748" aria-hidden="true" tabindex="-1"></a><span class="co"># Chain skills</span></span>
<span id="cb110-749"><a href="#cb110-749" aria-hidden="true" tabindex="-1"></a>enhanced <span class="op">=</span> with_skill(with_skill(brick, <span class="st">"cache"</span>), <span class="st">"timing"</span>)</span>
<span id="cb110-750"><a href="#cb110-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-751"><a href="#cb110-751" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - slow</span></span>
<span id="cb110-752"><a href="#cb110-752" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> enhanced.invoke(<span class="st">"test"</span>)</span>
<span id="cb110-753"><a href="#cb110-753" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - fast (cached)</span></span>
<span id="cb110-754"><a href="#cb110-754" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> enhanced.invoke(<span class="st">"test"</span>)</span>
<span id="cb110-755"><a href="#cb110-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-756"><a href="#cb110-756" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Same results: </span><span class="sc">{</span>result1 <span class="op">==</span> result2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-757"><a href="#cb110-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-758"><a href="#cb110-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-759"><a href="#cb110-759" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 3. Decorator Style</span></span>
<span id="cb110-760"><a href="#cb110-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-763"><a href="#cb110-763" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-764"><a href="#cb110-764" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-765"><a href="#cb110-765" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-766"><a href="#cb110-766" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-767"><a href="#cb110-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-768"><a href="#cb110-768" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> skill</span>
<span id="cb110-769"><a href="#cb110-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-770"><a href="#cb110-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-771"><a href="#cb110-771" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"timing"</span>)</span>
<span id="cb110-772"><a href="#cb110-772" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cache"</span>)</span>
<span id="cb110-773"><a href="#cb110-773" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SmartBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">int</span>]):</span>
<span id="cb110-774"><a href="#cb110-774" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A brick decorated with skills."""</span></span>
<span id="cb110-775"><a href="#cb110-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-776"><a href="#cb110-776" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb110-777"><a href="#cb110-777" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.05</span>)  <span class="co"># Simulate work</span></span>
<span id="cb110-778"><a href="#cb110-778" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="bu">input</span>)</span>
<span id="cb110-779"><a href="#cb110-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-780"><a href="#cb110-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-781"><a href="#cb110-781" aria-hidden="true" tabindex="-1"></a><span class="co"># The brick is automatically enhanced</span></span>
<span id="cb110-782"><a href="#cb110-782" aria-hidden="true" tabindex="-1"></a>smart <span class="op">=</span> SmartBrick()</span>
<span id="cb110-783"><a href="#cb110-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-784"><a href="#cb110-784" aria-hidden="true" tabindex="-1"></a><span class="co"># Test it</span></span>
<span id="cb110-785"><a href="#cb110-785" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> text <span class="kw">in</span> [<span class="st">"hello"</span>, <span class="st">"world"</span>, <span class="st">"hello"</span>]:  <span class="co"># "hello" appears twice</span></span>
<span id="cb110-786"><a href="#cb110-786" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="cf">await</span> smart.invoke(text)</span>
<span id="cb110-787"><a href="#cb110-787" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Length of '</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span>length<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-788"><a href="#cb110-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-789"><a href="#cb110-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-790"><a href="#cb110-790" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Real Example: Retry Skill</span></span>
<span id="cb110-791"><a href="#cb110-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-794"><a href="#cb110-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-795"><a href="#cb110-795" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-796"><a href="#cb110-796" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-797"><a href="#cb110-797" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-798"><a href="#cb110-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-799"><a href="#cb110-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-800"><a href="#cb110-800" aria-hidden="true" tabindex="-1"></a><span class="at">@register_skill</span>(<span class="st">"retry"</span>)</span>
<span id="cb110-801"><a href="#cb110-801" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RetrySkill(Skill):</span>
<span id="cb110-802"><a href="#cb110-802" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Adds retry logic to brick invocations."""</span></span>
<span id="cb110-803"><a href="#cb110-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-804"><a href="#cb110-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_brick(<span class="va">self</span>, brick):</span>
<span id="cb110-805"><a href="#cb110-805" aria-hidden="true" tabindex="-1"></a>        max_retries <span class="op">=</span> <span class="va">self</span>.config.get(<span class="st">"max_retries"</span>, <span class="dv">3</span>)</span>
<span id="cb110-806"><a href="#cb110-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-807"><a href="#cb110-807" aria-hidden="true" tabindex="-1"></a>        <span class="kw">class</span> RetryEnhanced(EnhancedBrick):</span>
<span id="cb110-808"><a href="#cb110-808" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb110-809"><a href="#cb110-809" aria-hidden="true" tabindex="-1"></a>                last_error <span class="op">=</span> <span class="va">None</span></span>
<span id="cb110-810"><a href="#cb110-810" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb110-811"><a href="#cb110-811" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb110-812"><a href="#cb110-812" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="cf">await</span> <span class="va">self</span>._wrapped.invoke(<span class="bu">input</span>, deps<span class="op">=</span>deps)</span>
<span id="cb110-813"><a href="#cb110-813" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb110-814"><a href="#cb110-814" aria-hidden="true" tabindex="-1"></a>                        last_error <span class="op">=</span> e</span>
<span id="cb110-815"><a href="#cb110-815" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> attempt <span class="op">&lt;</span> max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb110-816"><a href="#cb110-816" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="ss">f"🔄 Retry </span><span class="sc">{</span>attempt <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_retries<span class="sc">}</span><span class="ss"> after: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-817"><a href="#cb110-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-818"><a href="#cb110-818" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> last_error</span>
<span id="cb110-819"><a href="#cb110-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-820"><a href="#cb110-820" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RetryEnhanced(brick, <span class="va">self</span>)</span>
<span id="cb110-821"><a href="#cb110-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-822"><a href="#cb110-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-823"><a href="#cb110-823" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with an unreliable brick</span></span>
<span id="cb110-824"><a href="#cb110-824" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UnreliableBrick(SimpleBrick[<span class="bu">int</span>, <span class="bu">int</span>]):</span>
<span id="cb110-825"><a href="#cb110-825" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb110-826"><a href="#cb110-826" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb110-827"><a href="#cb110-827" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb110-828"><a href="#cb110-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-829"><a href="#cb110-829" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">int</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb110-830"><a href="#cb110-830" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb110-831"><a href="#cb110-831" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fail first two times</span></span>
<span id="cb110-832"><a href="#cb110-832" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._count <span class="op">%</span> <span class="dv">3</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb110-833"><a href="#cb110-833" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed on attempt </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-834"><a href="#cb110-834" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span> <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb110-835"><a href="#cb110-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-836"><a href="#cb110-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-837"><a href="#cb110-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Add retry logic</span></span>
<span id="cb110-838"><a href="#cb110-838" aria-hidden="true" tabindex="-1"></a>unreliable <span class="op">=</span> UnreliableBrick()</span>
<span id="cb110-839"><a href="#cb110-839" aria-hidden="true" tabindex="-1"></a>reliable <span class="op">=</span> unreliable.with_skill(<span class="st">"retry"</span>, max_retries<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb110-840"><a href="#cb110-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-841"><a href="#cb110-841" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-842"><a href="#cb110-842" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> reliable.invoke(<span class="dv">21</span>)</span>
<span id="cb110-843"><a href="#cb110-843" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Success! Result: </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-844"><a href="#cb110-844" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb110-845"><a href="#cb110-845" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed after retries: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-846"><a href="#cb110-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-847"><a href="#cb110-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-848"><a href="#cb110-848" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 6: Built-in Skills</span></span>
<span id="cb110-849"><a href="#cb110-849" aria-hidden="true" tabindex="-1"></a>*Status: Complete! ✅*</span>
<span id="cb110-850"><a href="#cb110-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-851"><a href="#cb110-851" aria-hidden="true" tabindex="-1"></a>Nanobricks comes with three powerful built-in skills that cover the most common needs.</span>
<span id="cb110-852"><a href="#cb110-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-853"><a href="#cb110-853" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Logging Skill</span></span>
<span id="cb110-854"><a href="#cb110-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-855"><a href="#cb110-855" aria-hidden="true" tabindex="-1"></a>Automatically log inputs, outputs, and errors with customizable formatting:</span>
<span id="cb110-856"><a href="#cb110-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-859"><a href="#cb110-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-860"><a href="#cb110-860" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-861"><a href="#cb110-861" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-862"><a href="#cb110-862" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-863"><a href="#cb110-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-864"><a href="#cb110-864" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb110-865"><a href="#cb110-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-866"><a href="#cb110-866" aria-hidden="true" tabindex="-1"></a><span class="co"># Import built-in skills</span></span>
<span id="cb110-867"><a href="#cb110-867" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nanobricks.skills</span>
<span id="cb110-868"><a href="#cb110-868" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> skill, SimpleBrick</span>
<span id="cb110-869"><a href="#cb110-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-870"><a href="#cb110-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-871"><a href="#cb110-871" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>, level<span class="op">=</span><span class="st">"INFO"</span>, pretty<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-872"><a href="#cb110-872" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataProcessorBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-873"><a href="#cb110-873" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Processes data with automatic logging."""</span></span>
<span id="cb110-874"><a href="#cb110-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-875"><a href="#cb110-875" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-876"><a href="#cb110-876" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Your processing logic</span></span>
<span id="cb110-877"><a href="#cb110-877" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"item_count"</span>: <span class="bu">len</span>(<span class="bu">input</span>), <span class="st">"keys"</span>: <span class="bu">list</span>(<span class="bu">input</span>.keys())}</span>
<span id="cb110-878"><a href="#cb110-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-879"><a href="#cb110-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-880"><a href="#cb110-880" aria-hidden="true" tabindex="-1"></a><span class="co"># Use it</span></span>
<span id="cb110-881"><a href="#cb110-881" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessorBrick()</span>
<span id="cb110-882"><a href="#cb110-882" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>})</span>
<span id="cb110-883"><a href="#cb110-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-884"><a href="#cb110-884" aria-hidden="true" tabindex="-1"></a><span class="co"># Logs automatically:</span></span>
<span id="cb110-885"><a href="#cb110-885" aria-hidden="true" tabindex="-1"></a><span class="co"># 🔵 Input: {"a": 1, "b": 2}</span></span>
<span id="cb110-886"><a href="#cb110-886" aria-hidden="true" tabindex="-1"></a><span class="co"># 🟢 Output: {"processed": true, "item_count": 2, "keys": ["a", "b"]} (took 0.001s)</span></span>
<span id="cb110-887"><a href="#cb110-887" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-888"><a href="#cb110-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-889"><a href="#cb110-889" aria-hidden="true" tabindex="-1"></a>Logging options:</span>
<span id="cb110-890"><a href="#cb110-890" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`level`</span>: Log level (DEBUG, INFO, WARNING, ERROR)</span>
<span id="cb110-891"><a href="#cb110-891" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`log_inputs`</span>: Log inputs (default: True)</span>
<span id="cb110-892"><a href="#cb110-892" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`log_outputs`</span>: Log outputs (default: True)</span>
<span id="cb110-893"><a href="#cb110-893" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`log_errors`</span>: Log errors (default: True)</span>
<span id="cb110-894"><a href="#cb110-894" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`truncate`</span>: Max length for values (default: 100)</span>
<span id="cb110-895"><a href="#cb110-895" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pretty`</span>: Pretty-print JSON (default: False)</span>
<span id="cb110-896"><a href="#cb110-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-897"><a href="#cb110-897" aria-hidden="true" tabindex="-1"></a><span class="fu">#### API Skill</span></span>
<span id="cb110-898"><a href="#cb110-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-899"><a href="#cb110-899" aria-hidden="true" tabindex="-1"></a>Turn any nanobrick into a REST API with FastAPI:</span>
<span id="cb110-900"><a href="#cb110-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-903"><a href="#cb110-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-904"><a href="#cb110-904" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-905"><a href="#cb110-905" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-906"><a href="#cb110-906" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-907"><a href="#cb110-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-908"><a href="#cb110-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-909"><a href="#cb110-909" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, path<span class="op">=</span><span class="st">"/analyze"</span>, port<span class="op">=</span><span class="dv">8080</span>, docs<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-910"><a href="#cb110-910" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TextAnalyzerBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-911"><a href="#cb110-911" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyzes text and returns statistics."""</span></span>
<span id="cb110-912"><a href="#cb110-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-913"><a href="#cb110-913" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-914"><a href="#cb110-914" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> <span class="bu">input</span>.split()</span>
<span id="cb110-915"><a href="#cb110-915" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb110-916"><a href="#cb110-916" aria-hidden="true" tabindex="-1"></a>            <span class="st">"text"</span>: <span class="bu">input</span>,</span>
<span id="cb110-917"><a href="#cb110-917" aria-hidden="true" tabindex="-1"></a>            <span class="st">"word_count"</span>: <span class="bu">len</span>(words),</span>
<span id="cb110-918"><a href="#cb110-918" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unique_words"</span>: <span class="bu">len</span>(<span class="bu">set</span>(words)),</span>
<span id="cb110-919"><a href="#cb110-919" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb110-920"><a href="#cb110-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-921"><a href="#cb110-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-922"><a href="#cb110-922" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> TextAnalyzerBrick()</span>
<span id="cb110-923"><a href="#cb110-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-924"><a href="#cb110-924" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the API server</span></span>
<span id="cb110-925"><a href="#cb110-925" aria-hidden="true" tabindex="-1"></a><span class="co"># analyzer.start_server()  # Runs at http://localhost:8080/analyze</span></span>
<span id="cb110-926"><a href="#cb110-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-927"><a href="#cb110-927" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the API:</span></span>
<span id="cb110-928"><a href="#cb110-928" aria-hidden="true" tabindex="-1"></a><span class="co"># POST http://localhost:8080/analyze</span></span>
<span id="cb110-929"><a href="#cb110-929" aria-hidden="true" tabindex="-1"></a><span class="co"># {"data": "hello world hello"}</span></span>
<span id="cb110-930"><a href="#cb110-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-931"><a href="#cb110-931" aria-hidden="true" tabindex="-1"></a><span class="co"># API docs at http://localhost:8080/docs</span></span>
<span id="cb110-932"><a href="#cb110-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-933"><a href="#cb110-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-934"><a href="#cb110-934" aria-hidden="true" tabindex="-1"></a>API options:</span>
<span id="cb110-935"><a href="#cb110-935" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`path`</span>: Endpoint path (default: /{brick_name})</span>
<span id="cb110-936"><a href="#cb110-936" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`method`</span>: HTTP method (default: POST)</span>
<span id="cb110-937"><a href="#cb110-937" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`host`</span>: Host to bind (default: 0.0.0.0)</span>
<span id="cb110-938"><a href="#cb110-938" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`port`</span>: Port to bind (default: 8000)</span>
<span id="cb110-939"><a href="#cb110-939" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`docs`</span>: Enable Swagger docs (default: True)</span>
<span id="cb110-940"><a href="#cb110-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-941"><a href="#cb110-941" aria-hidden="true" tabindex="-1"></a><span class="fu">#### CLI Skill</span></span>
<span id="cb110-942"><a href="#cb110-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-943"><a href="#cb110-943" aria-hidden="true" tabindex="-1"></a>Create command-line interfaces with Typer:</span>
<span id="cb110-944"><a href="#cb110-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-947"><a href="#cb110-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-948"><a href="#cb110-948" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-949"><a href="#cb110-949" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-950"><a href="#cb110-950" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-951"><a href="#cb110-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-952"><a href="#cb110-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-953"><a href="#cb110-953" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cli"</span>, command<span class="op">=</span><span class="st">"transform"</span>, input_type<span class="op">=</span><span class="st">"json"</span>)</span>
<span id="cb110-954"><a href="#cb110-954" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataTransformerBrick(SimpleBrick[<span class="bu">list</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-955"><a href="#cb110-955" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Transforms data into summary statistics."""</span></span>
<span id="cb110-956"><a href="#cb110-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-957"><a href="#cb110-957" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">list</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-958"><a href="#cb110-958" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb110-959"><a href="#cb110-959" aria-hidden="true" tabindex="-1"></a>            <span class="st">"total_items"</span>: <span class="bu">len</span>(<span class="bu">input</span>),</span>
<span id="cb110-960"><a href="#cb110-960" aria-hidden="true" tabindex="-1"></a>            <span class="st">"first"</span>: <span class="bu">input</span>[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">input</span> <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb110-961"><a href="#cb110-961" aria-hidden="true" tabindex="-1"></a>            <span class="st">"last"</span>: <span class="bu">input</span>[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="bu">input</span> <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb110-962"><a href="#cb110-962" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb110-963"><a href="#cb110-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-964"><a href="#cb110-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-965"><a href="#cb110-965" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> DataTransformerBrick()</span>
<span id="cb110-966"><a href="#cb110-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-967"><a href="#cb110-967" aria-hidden="true" tabindex="-1"></a><span class="co"># Use from command line:</span></span>
<span id="cb110-968"><a href="#cb110-968" aria-hidden="true" tabindex="-1"></a><span class="co"># transform invoke '[1, 2, 3, 4, 5]'</span></span>
<span id="cb110-969"><a href="#cb110-969" aria-hidden="true" tabindex="-1"></a><span class="co"># transform invoke data.json --from-file</span></span>
<span id="cb110-970"><a href="#cb110-970" aria-hidden="true" tabindex="-1"></a><span class="co"># transform info</span></span>
<span id="cb110-971"><a href="#cb110-971" aria-hidden="true" tabindex="-1"></a><span class="co"># transform example</span></span>
<span id="cb110-972"><a href="#cb110-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-973"><a href="#cb110-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-974"><a href="#cb110-974" aria-hidden="true" tabindex="-1"></a>CLI options:</span>
<span id="cb110-975"><a href="#cb110-975" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`command`</span>: Command name (default: brick name)</span>
<span id="cb110-976"><a href="#cb110-976" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`description`</span>: Help text</span>
<span id="cb110-977"><a href="#cb110-977" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`input_type`</span>: json, text, or file</span>
<span id="cb110-978"><a href="#cb110-978" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`output_format`</span>: json, text, or pretty</span>
<span id="cb110-979"><a href="#cb110-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-980"><a href="#cb110-980" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Combining Built-in Skills</span></span>
<span id="cb110-981"><a href="#cb110-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-982"><a href="#cb110-982" aria-hidden="true" tabindex="-1"></a>The real power comes from combining skills:</span>
<span id="cb110-983"><a href="#cb110-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-986"><a href="#cb110-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-987"><a href="#cb110-987" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-988"><a href="#cb110-988" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-989"><a href="#cb110-989" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-990"><a href="#cb110-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-991"><a href="#cb110-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-992"><a href="#cb110-992" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>, level<span class="op">=</span><span class="st">"INFO"</span>)</span>
<span id="cb110-993"><a href="#cb110-993" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, port<span class="op">=</span><span class="dv">8000</span>)</span>
<span id="cb110-994"><a href="#cb110-994" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"cli"</span>, command<span class="op">=</span><span class="st">"process"</span>)</span>
<span id="cb110-995"><a href="#cb110-995" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProcessorBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-996"><a href="#cb110-996" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A brick with multiple interfaces."""</span></span>
<span id="cb110-997"><a href="#cb110-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-998"><a href="#cb110-998" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-999"><a href="#cb110-999" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process data</span></span>
<span id="cb110-1000"><a href="#cb110-1000" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {k: v <span class="op">*</span> <span class="dv">2</span> <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">input</span>.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))}</span>
<span id="cb110-1001"><a href="#cb110-1001" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb110-1002"><a href="#cb110-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1003"><a href="#cb110-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1004"><a href="#cb110-1004" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> ProcessorBrick()</span>
<span id="cb110-1005"><a href="#cb110-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1006"><a href="#cb110-1006" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can:</span></span>
<span id="cb110-1007"><a href="#cb110-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Call it directly (with logging)</span></span>
<span id="cb110-1008"><a href="#cb110-1008" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"a"</span>: <span class="dv">5</span>, <span class="st">"b"</span>: <span class="dv">10</span>})</span>
<span id="cb110-1009"><a href="#cb110-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1010"><a href="#cb110-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Access via REST API</span></span>
<span id="cb110-1011"><a href="#cb110-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># processor.start_server()</span></span>
<span id="cb110-1012"><a href="#cb110-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1013"><a href="#cb110-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use from command line</span></span>
<span id="cb110-1014"><a href="#cb110-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># process invoke '{"a": 5, "b": 10}'</span></span>
<span id="cb110-1015"><a href="#cb110-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1016"><a href="#cb110-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1017"><a href="#cb110-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">## Try It Yourself!</span></span>
<span id="cb110-1018"><a href="#cb110-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1019"><a href="#cb110-1019" aria-hidden="true" tabindex="-1"></a>Once we start implementing, you'll be able to run these examples:</span>
<span id="cb110-1020"><a href="#cb110-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1023"><a href="#cb110-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```{shell}</span></span>
<span id="cb110-1024"><a href="#cb110-1024" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb110-1025"><a href="#cb110-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-1026"><a href="#cb110-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-1027"><a href="#cb110-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1028"><a href="#cb110-1028" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the package</span></span>
<span id="cb110-1029"><a href="#cb110-1029" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> .</span>
<span id="cb110-1030"><a href="#cb110-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1031"><a href="#cb110-1031" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the examples</span></span>
<span id="cb110-1032"><a href="#cb110-1032" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/basic_pipeline.py</span>
<span id="cb110-1033"><a href="#cb110-1033" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/sync_usage.py</span>
<span id="cb110-1034"><a href="#cb110-1034" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/dependency_injection.py</span>
<span id="cb110-1035"><a href="#cb110-1035" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/configuration.py</span>
<span id="cb110-1036"><a href="#cb110-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1037"><a href="#cb110-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1038"><a href="#cb110-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">## Questions Along the Way?</span></span>
<span id="cb110-1039"><a href="#cb110-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1040"><a href="#cb110-1040" aria-hidden="true" tabindex="-1"></a>As we build, I'll add troubleshooting tips and explanations here. This document will grow with our implementation!</span>
<span id="cb110-1041"><a href="#cb110-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1042"><a href="#cb110-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">## Installation &amp; Setup</span></span>
<span id="cb110-1043"><a href="#cb110-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1044"><a href="#cb110-1044" aria-hidden="true" tabindex="-1"></a>Now that we have working code, here's how to get started:</span>
<span id="cb110-1045"><a href="#cb110-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1046"><a href="#cb110-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb110-1047"><a href="#cb110-1047" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone the repository</span></span>
<span id="cb110-1048"><a href="#cb110-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="op">&lt;</span>your-repo-url<span class="op">&gt;</span></span>
<span id="cb110-1049"><a href="#cb110-1049" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> nano-1</span>
<span id="cb110-1050"><a href="#cb110-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1051"><a href="#cb110-1051" aria-hidden="true" tabindex="-1"></a><span class="co"># Install in development mode</span></span>
<span id="cb110-1052"><a href="#cb110-1052" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> <span class="st">".[dev]"</span></span>
<span id="cb110-1053"><a href="#cb110-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1054"><a href="#cb110-1054" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the tests</span></span>
<span id="cb110-1055"><a href="#cb110-1055" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> tests/unit/test_protocol.py <span class="at">-v</span></span>
<span id="cb110-1056"><a href="#cb110-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1057"><a href="#cb110-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Check types</span></span>
<span id="cb110-1058"><a href="#cb110-1058" aria-hidden="true" tabindex="-1"></a><span class="ex">mypy</span> src/nanobricks/ <span class="at">--strict</span></span>
<span id="cb110-1059"><a href="#cb110-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1060"><a href="#cb110-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1061"><a href="#cb110-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Working Now?</span></span>
<span id="cb110-1062"><a href="#cb110-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1063"><a href="#cb110-1063" aria-hidden="true" tabindex="-1"></a>✅ Core protocol with NanobrickProtocol and NanobrickBase  </span>
<span id="cb110-1064"><a href="#cb110-1064" aria-hidden="true" tabindex="-1"></a>✅ SimpleBrick for easy nanobricks without dependencies  </span>
<span id="cb110-1065"><a href="#cb110-1065" aria-hidden="true" tabindex="-1"></a>✅ Async and sync invocation  </span>
<span id="cb110-1066"><a href="#cb110-1066" aria-hidden="true" tabindex="-1"></a>✅ Type safety with generics  </span>
<span id="cb110-1067"><a href="#cb110-1067" aria-hidden="true" tabindex="-1"></a>✅ Full pipe operator composition (|)  </span>
<span id="cb110-1068"><a href="#cb110-1068" aria-hidden="true" tabindex="-1"></a>✅ CompositeBrick for two-brick pipelines  </span>
<span id="cb110-1069"><a href="#cb110-1069" aria-hidden="true" tabindex="-1"></a>✅ Pipeline class for multi-brick chains  </span>
<span id="cb110-1070"><a href="#cb110-1070" aria-hidden="true" tabindex="-1"></a>✅ Error propagation (fail-fast)  </span>
<span id="cb110-1071"><a href="#cb110-1071" aria-hidden="true" tabindex="-1"></a>✅ Type transformations in pipelines  </span>
<span id="cb110-1072"><a href="#cb110-1072" aria-hidden="true" tabindex="-1"></a>✅ Dependency injection with StandardDeps  </span>
<span id="cb110-1073"><a href="#cb110-1073" aria-hidden="true" tabindex="-1"></a>✅ DependencyContainer for managing deps  </span>
<span id="cb110-1074"><a href="#cb110-1074" aria-hidden="true" tabindex="-1"></a>✅ Mock implementations for testing  </span>
<span id="cb110-1075"><a href="#cb110-1075" aria-hidden="true" tabindex="-1"></a>✅ Dependencies flow through pipelines  </span>
<span id="cb110-1076"><a href="#cb110-1076" aria-hidden="true" tabindex="-1"></a>✅ TOML-based configuration system  </span>
<span id="cb110-1077"><a href="#cb110-1077" aria-hidden="true" tabindex="-1"></a>✅ Environment-specific config overrides  </span>
<span id="cb110-1078"><a href="#cb110-1078" aria-hidden="true" tabindex="-1"></a>✅ Config discovery chain  </span>
<span id="cb110-1079"><a href="#cb110-1079" aria-hidden="true" tabindex="-1"></a>✅ Dot notation config access  </span>
<span id="cb110-1080"><a href="#cb110-1080" aria-hidden="true" tabindex="-1"></a>✅ Skill framework with enhance() pattern  </span>
<span id="cb110-1081"><a href="#cb110-1081" aria-hidden="true" tabindex="-1"></a>✅ Registry for skill management  </span>
<span id="cb110-1082"><a href="#cb110-1082" aria-hidden="true" tabindex="-1"></a>✅ with_skill() method chaining  </span>
<span id="cb110-1083"><a href="#cb110-1083" aria-hidden="true" tabindex="-1"></a>✅ @skill decorator support  </span>
<span id="cb110-1084"><a href="#cb110-1084" aria-hidden="true" tabindex="-1"></a>✅ Example skills: timing, retry, cache  </span>
<span id="cb110-1085"><a href="#cb110-1085" aria-hidden="true" tabindex="-1"></a>✅ **Built-in logging skill with smart formatting**  </span>
<span id="cb110-1086"><a href="#cb110-1086" aria-hidden="true" tabindex="-1"></a>✅ **Built-in API skill with FastAPI**  </span>
<span id="cb110-1087"><a href="#cb110-1087" aria-hidden="true" tabindex="-1"></a>✅ **Built-in CLI skill with Typer**  </span>
<span id="cb110-1088"><a href="#cb110-1088" aria-hidden="true" tabindex="-1"></a>✅ **Built-in Docker skill with Dockerfile generation**  </span>
<span id="cb110-1089"><a href="#cb110-1089" aria-hidden="true" tabindex="-1"></a>✅ **Built-in Kubernetes skill with manifest &amp; Helm chart generation**  </span>
<span id="cb110-1090"><a href="#cb110-1090" aria-hidden="true" tabindex="-1"></a>✅ **Performance optimizations: caching, batching, fusion, pooling**  </span>
<span id="cb110-1091"><a href="#cb110-1091" aria-hidden="true" tabindex="-1"></a>✅ Working examples in <span class="in">`examples/`</span> directory  </span>
<span id="cb110-1092"><a href="#cb110-1092" aria-hidden="true" tabindex="-1"></a>✅ 221 tests, 74% coverage  </span>
<span id="cb110-1093"><a href="#cb110-1093" aria-hidden="true" tabindex="-1"></a>✅ Strict mypy type checking  </span>
<span id="cb110-1094"><a href="#cb110-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1095"><a href="#cb110-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Try It Now!</span></span>
<span id="cb110-1096"><a href="#cb110-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1097"><a href="#cb110-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb110-1098"><a href="#cb110-1098" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the examples</span></span>
<span id="cb110-1099"><a href="#cb110-1099" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/basic_pipeline.py</span>
<span id="cb110-1100"><a href="#cb110-1100" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/sync_usage.py</span>
<span id="cb110-1101"><a href="#cb110-1101" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/dependency_injection.py</span>
<span id="cb110-1102"><a href="#cb110-1102" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/configuration.py</span>
<span id="cb110-1103"><a href="#cb110-1103" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/custom_skills.py</span>
<span id="cb110-1104"><a href="#cb110-1104" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/builtin_skills.py</span>
<span id="cb110-1105"><a href="#cb110-1105" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/deployment_example.py  <span class="co"># Docker &amp; Kubernetes deployment</span></span>
<span id="cb110-1106"><a href="#cb110-1106" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> examples/performance_example.py  <span class="co"># NEW! Performance optimizations</span></span>
<span id="cb110-1107"><a href="#cb110-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1108"><a href="#cb110-1108" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb110-1109"><a href="#cb110-1109" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> tests/unit/ <span class="at">-v</span></span>
<span id="cb110-1110"><a href="#cb110-1110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1111"><a href="#cb110-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1112"><a href="#cb110-1112" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real Examples from the examples/ Directory</span></span>
<span id="cb110-1113"><a href="#cb110-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1114"><a href="#cb110-1114" aria-hidden="true" tabindex="-1"></a>Here are some highlights from our working examples:</span>
<span id="cb110-1115"><a href="#cb110-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1116"><a href="#cb110-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">### From basic_pipeline.py</span></span>
<span id="cb110-1117"><a href="#cb110-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1120"><a href="#cb110-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1121"><a href="#cb110-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1122"><a href="#cb110-1122" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1123"><a href="#cb110-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1124"><a href="#cb110-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1125"><a href="#cb110-1125" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb110-1126"><a href="#cb110-1126" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb110-1127"><a href="#cb110-1127" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb110-1128"><a href="#cb110-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1129"><a href="#cb110-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1130"><a href="#cb110-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># Email processing example from basic_pipeline.py</span></span>
<span id="cb110-1131"><a href="#cb110-1131" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidateEmailBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-1132"><a href="#cb110-1132" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Validates that input looks like an email."""</span></span>
<span id="cb110-1133"><a href="#cb110-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1134"><a href="#cb110-1134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-1135"><a href="#cb110-1135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"@"</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span> <span class="kw">or</span> <span class="st">"."</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb110-1136"><a href="#cb110-1136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid email format: </span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1137"><a href="#cb110-1137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb110-1138"><a href="#cb110-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1139"><a href="#cb110-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1140"><a href="#cb110-1140" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NormalizeEmailBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-1141"><a href="#cb110-1141" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Normalizes email to lowercase and strips whitespace."""</span></span>
<span id="cb110-1142"><a href="#cb110-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1143"><a href="#cb110-1143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-1144"><a href="#cb110-1144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.strip().lower()</span>
<span id="cb110-1145"><a href="#cb110-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1146"><a href="#cb110-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1147"><a href="#cb110-1147" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExtractDomainBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">str</span>]):</span>
<span id="cb110-1148"><a href="#cb110-1148" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extracts domain from email address."""</span></span>
<span id="cb110-1149"><a href="#cb110-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1150"><a href="#cb110-1150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb110-1151"><a href="#cb110-1151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">input</span>.split(<span class="st">"@"</span>)[<span class="dv">1</span>]</span>
<span id="cb110-1152"><a href="#cb110-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1153"><a href="#cb110-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1154"><a href="#cb110-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pipeline</span></span>
<span id="cb110-1155"><a href="#cb110-1155" aria-hidden="true" tabindex="-1"></a>validate <span class="op">=</span> ValidateEmailBrick(name<span class="op">=</span><span class="st">"validate"</span>)</span>
<span id="cb110-1156"><a href="#cb110-1156" aria-hidden="true" tabindex="-1"></a>normalize <span class="op">=</span> NormalizeEmailBrick(name<span class="op">=</span><span class="st">"normalize"</span>)</span>
<span id="cb110-1157"><a href="#cb110-1157" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> ExtractDomainBrick(name<span class="op">=</span><span class="st">"extract"</span>)</span>
<span id="cb110-1158"><a href="#cb110-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1159"><a href="#cb110-1159" aria-hidden="true" tabindex="-1"></a>email_pipeline <span class="op">=</span> validate <span class="op">|</span> normalize <span class="op">|</span> extract</span>
<span id="cb110-1160"><a href="#cb110-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1161"><a href="#cb110-1161" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with various inputs</span></span>
<span id="cb110-1162"><a href="#cb110-1162" aria-hidden="true" tabindex="-1"></a>test_emails <span class="op">=</span> [<span class="st">"  John.Doe@Example.COM  "</span>, <span class="st">"alice@wonderland.io"</span>, <span class="st">"BOB@CORP.NET"</span>]</span>
<span id="cb110-1163"><a href="#cb110-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1164"><a href="#cb110-1164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Email Processing Pipeline:"</span>)</span>
<span id="cb110-1165"><a href="#cb110-1165" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> email <span class="kw">in</span> test_emails:</span>
<span id="cb110-1166"><a href="#cb110-1166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb110-1167"><a href="#cb110-1167" aria-hidden="true" tabindex="-1"></a>        domain <span class="op">=</span> <span class="cf">await</span> email_pipeline.invoke(email)</span>
<span id="cb110-1168"><a href="#cb110-1168" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>email<span class="sc">:30}</span><span class="ss"> -&gt; </span><span class="sc">{</span>domain<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1169"><a href="#cb110-1169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb110-1170"><a href="#cb110-1170" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>email<span class="sc">:30}</span><span class="ss"> -&gt; ERROR: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1171"><a href="#cb110-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1172"><a href="#cb110-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1173"><a href="#cb110-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">### From dependency_injection.py - Smart Caching</span></span>
<span id="cb110-1174"><a href="#cb110-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1177"><a href="#cb110-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1178"><a href="#cb110-1178" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1179"><a href="#cb110-1179" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1180"><a href="#cb110-1180" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1181"><a href="#cb110-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1182"><a href="#cb110-1182" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb110-1183"><a href="#cb110-1183" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> NanobrickBase</span>
<span id="cb110-1184"><a href="#cb110-1184" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.dependencies <span class="im">import</span> (</span>
<span id="cb110-1185"><a href="#cb110-1185" aria-hidden="true" tabindex="-1"></a>    StandardDeps,</span>
<span id="cb110-1186"><a href="#cb110-1186" aria-hidden="true" tabindex="-1"></a>    MockDatabase,</span>
<span id="cb110-1187"><a href="#cb110-1187" aria-hidden="true" tabindex="-1"></a>    MockCache,</span>
<span id="cb110-1188"><a href="#cb110-1188" aria-hidden="true" tabindex="-1"></a>    MockLogger,</span>
<span id="cb110-1189"><a href="#cb110-1189" aria-hidden="true" tabindex="-1"></a>    DependencyContainer,</span>
<span id="cb110-1190"><a href="#cb110-1190" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1191"><a href="#cb110-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1192"><a href="#cb110-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1193"><a href="#cb110-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># Smart loader with caching from dependency_injection.py</span></span>
<span id="cb110-1194"><a href="#cb110-1194" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SmartUserLoader(NanobrickBase[<span class="bu">str</span>, <span class="bu">dict</span>, StandardDeps]):</span>
<span id="cb110-1195"><a href="#cb110-1195" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Loads user data with intelligent caching."""</span></span>
<span id="cb110-1196"><a href="#cb110-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1197"><a href="#cb110-1197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(</span>
<span id="cb110-1198"><a href="#cb110-1198" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, user_id: <span class="bu">str</span>, <span class="op">*</span>, deps: Optional[StandardDeps] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb110-1199"><a href="#cb110-1199" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1200"><a href="#cb110-1200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> deps:</span>
<span id="cb110-1201"><a href="#cb110-1201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Dependencies required"</span>)</span>
<span id="cb110-1202"><a href="#cb110-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1203"><a href="#cb110-1203" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check cache first</span></span>
<span id="cb110-1204"><a href="#cb110-1204" aria-hidden="true" tabindex="-1"></a>        cache_key <span class="op">=</span> <span class="ss">f"user:</span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb110-1205"><a href="#cb110-1205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"cache"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-1206"><a href="#cb110-1206" aria-hidden="true" tabindex="-1"></a>            cached_data <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"cache"</span>].get(cache_key)</span>
<span id="cb110-1207"><a href="#cb110-1207" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cached_data:</span>
<span id="cb110-1208"><a href="#cb110-1208" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-1209"><a href="#cb110-1209" aria-hidden="true" tabindex="-1"></a>                    deps[<span class="st">"logger"</span>].debug(<span class="ss">f"Cache hit for </span><span class="sc">{</span>cache_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1210"><a href="#cb110-1210" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> cached_data</span>
<span id="cb110-1211"><a href="#cb110-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1212"><a href="#cb110-1212" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load from database</span></span>
<span id="cb110-1213"><a href="#cb110-1213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"db"</span> <span class="kw">not</span> <span class="kw">in</span> deps:</span>
<span id="cb110-1214"><a href="#cb110-1214" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Database required"</span>)</span>
<span id="cb110-1215"><a href="#cb110-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1216"><a href="#cb110-1216" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="cf">await</span> deps[<span class="st">"db"</span>].query(</span>
<span id="cb110-1217"><a href="#cb110-1217" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SELECT * FROM users WHERE id = ?"</span>, {<span class="st">"id"</span>: user_id}</span>
<span id="cb110-1218"><a href="#cb110-1218" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb110-1219"><a href="#cb110-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1220"><a href="#cb110-1220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> results:</span>
<span id="cb110-1221"><a href="#cb110-1221" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"User </span><span class="sc">{</span>user_id<span class="sc">}</span><span class="ss"> not found"</span>)</span>
<span id="cb110-1222"><a href="#cb110-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1223"><a href="#cb110-1223" aria-hidden="true" tabindex="-1"></a>        user_data <span class="op">=</span> results[<span class="dv">0</span>]</span>
<span id="cb110-1224"><a href="#cb110-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1225"><a href="#cb110-1225" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store in cache for next time</span></span>
<span id="cb110-1226"><a href="#cb110-1226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"cache"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-1227"><a href="#cb110-1227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> deps[<span class="st">"cache"</span>].<span class="bu">set</span>(cache_key, user_data, ttl<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb110-1228"><a href="#cb110-1228" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"logger"</span> <span class="kw">in</span> deps:</span>
<span id="cb110-1229"><a href="#cb110-1229" aria-hidden="true" tabindex="-1"></a>                deps[<span class="st">"logger"</span>].debug(<span class="ss">f"Cached data for </span><span class="sc">{</span>cache_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1230"><a href="#cb110-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1231"><a href="#cb110-1231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> user_data</span>
<span id="cb110-1232"><a href="#cb110-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1233"><a href="#cb110-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1234"><a href="#cb110-1234" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up dependencies</span></span>
<span id="cb110-1235"><a href="#cb110-1235" aria-hidden="true" tabindex="-1"></a>mock_db <span class="op">=</span> MockDatabase(</span>
<span id="cb110-1236"><a href="#cb110-1236" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb110-1237"><a href="#cb110-1237" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SELECT * FROM users WHERE id = ?"</span>: [</span>
<span id="cb110-1238"><a href="#cb110-1238" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"id"</span>: <span class="st">"123"</span>, <span class="st">"name"</span>: <span class="st">"Alice"</span>, <span class="st">"email"</span>: <span class="st">"alice@example.com"</span>}</span>
<span id="cb110-1239"><a href="#cb110-1239" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb110-1240"><a href="#cb110-1240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-1241"><a href="#cb110-1241" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1242"><a href="#cb110-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1243"><a href="#cb110-1243" aria-hidden="true" tabindex="-1"></a>deps <span class="op">=</span> DependencyContainer(db<span class="op">=</span>mock_db, cache<span class="op">=</span>MockCache(), logger<span class="op">=</span>MockLogger())</span>
<span id="cb110-1244"><a href="#cb110-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1245"><a href="#cb110-1245" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> SmartUserLoader()</span>
<span id="cb110-1246"><a href="#cb110-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1247"><a href="#cb110-1247" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - hits database</span></span>
<span id="cb110-1248"><a href="#cb110-1248" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"First call (DB):"</span>)</span>
<span id="cb110-1249"><a href="#cb110-1249" aria-hidden="true" tabindex="-1"></a>user1 <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb110-1250"><a href="#cb110-1250" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User: </span><span class="sc">{</span>user1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1251"><a href="#cb110-1251" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  DB queries: </span><span class="sc">{</span><span class="bu">len</span>(mock_db.queries)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1252"><a href="#cb110-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1253"><a href="#cb110-1253" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - hits cache</span></span>
<span id="cb110-1254"><a href="#cb110-1254" aria-hidden="true" tabindex="-1"></a>mock_db.queries.clear()</span>
<span id="cb110-1255"><a href="#cb110-1255" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Second call (Cache):"</span>)</span>
<span id="cb110-1256"><a href="#cb110-1256" aria-hidden="true" tabindex="-1"></a>user2 <span class="op">=</span> <span class="cf">await</span> loader.invoke(<span class="st">"123"</span>, deps<span class="op">=</span>deps.to_dict())</span>
<span id="cb110-1257"><a href="#cb110-1257" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User: </span><span class="sc">{</span>user2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1258"><a href="#cb110-1258" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  DB queries: </span><span class="sc">{</span><span class="bu">len</span>(mock_db.queries)<span class="sc">}</span><span class="ss"> (cache hit!)"</span>)</span>
<span id="cb110-1259"><a href="#cb110-1259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1260"><a href="#cb110-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1261"><a href="#cb110-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 7: Deployment Skills</span></span>
<span id="cb110-1262"><a href="#cb110-1262" aria-hidden="true" tabindex="-1"></a>*Status: Complete! ✅*</span>
<span id="cb110-1263"><a href="#cb110-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1264"><a href="#cb110-1264" aria-hidden="true" tabindex="-1"></a>Deploy your nanobricks anywhere with automatic containerization and orchestration!</span>
<span id="cb110-1265"><a href="#cb110-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1266"><a href="#cb110-1266" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Docker Skill</span></span>
<span id="cb110-1267"><a href="#cb110-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1268"><a href="#cb110-1268" aria-hidden="true" tabindex="-1"></a>Automatically containerize your nanobricks with zero configuration:</span>
<span id="cb110-1269"><a href="#cb110-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1272"><a href="#cb110-1272" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1273"><a href="#cb110-1273" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1274"><a href="#cb110-1274" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1275"><a href="#cb110-1275" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1276"><a href="#cb110-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1277"><a href="#cb110-1277" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb110-1278"><a href="#cb110-1278" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, DockerConfig</span>
<span id="cb110-1279"><a href="#cb110-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1280"><a href="#cb110-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a simple brick for the example</span></span>
<span id="cb110-1281"><a href="#cb110-1281" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDataProcessor(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-1282"><a href="#cb110-1282" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Process data with validation."""</span></span>
<span id="cb110-1283"><a href="#cb110-1283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-1284"><a href="#cb110-1284" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb110-1285"><a href="#cb110-1285" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name<span class="op">=</span><span class="st">"mydataprocessor"</span>, version<span class="op">=</span><span class="st">"1.0.0"</span>)</span>
<span id="cb110-1286"><a href="#cb110-1286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-1287"><a href="#cb110-1287" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1288"><a href="#cb110-1288" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process the data</span></span>
<span id="cb110-1289"><a href="#cb110-1289" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"count"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb110-1290"><a href="#cb110-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1291"><a href="#cb110-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple containerization</span></span>
<span id="cb110-1292"><a href="#cb110-1292" aria-hidden="true" tabindex="-1"></a>docker_skill <span class="op">=</span> SkillDocker()</span>
<span id="cb110-1293"><a href="#cb110-1293" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyDataProcessor()</span>
<span id="cb110-1294"><a href="#cb110-1294" aria-hidden="true" tabindex="-1"></a>enhanced <span class="op">=</span> docker_skill.enhance(brick)</span>
<span id="cb110-1295"><a href="#cb110-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1296"><a href="#cb110-1296" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Dockerfile</span></span>
<span id="cb110-1297"><a href="#cb110-1297" aria-hidden="true" tabindex="-1"></a>dockerfile <span class="op">=</span> docker_skill.generate_dockerfile(brick)</span>
<span id="cb110-1298"><a href="#cb110-1298" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated Dockerfile:"</span>)</span>
<span id="cb110-1299"><a href="#cb110-1299" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dockerfile)</span>
<span id="cb110-1300"><a href="#cb110-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1301"><a href="#cb110-1301" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb110-1302"><a href="#cb110-1302" aria-hidden="true" tabindex="-1"></a><span class="co"># FROM python:3.11-slim</span></span>
<span id="cb110-1303"><a href="#cb110-1303" aria-hidden="true" tabindex="-1"></a><span class="co"># WORKDIR /app</span></span>
<span id="cb110-1304"><a href="#cb110-1304" aria-hidden="true" tabindex="-1"></a><span class="co"># COPY requirements.txt .</span></span>
<span id="cb110-1305"><a href="#cb110-1305" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN pip install -r requirements.txt</span></span>
<span id="cb110-1306"><a href="#cb110-1306" aria-hidden="true" tabindex="-1"></a><span class="co"># COPY . .</span></span>
<span id="cb110-1307"><a href="#cb110-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPOSE 8000</span></span>
<span id="cb110-1308"><a href="#cb110-1308" aria-hidden="true" tabindex="-1"></a><span class="co"># CMD ["python", "-m", "nanobricks.run", "mydataprocessor"]</span></span>
<span id="cb110-1309"><a href="#cb110-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1310"><a href="#cb110-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1311"><a href="#cb110-1311" aria-hidden="true" tabindex="-1"></a>With custom configuration:</span>
<span id="cb110-1312"><a href="#cb110-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1315"><a href="#cb110-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1316"><a href="#cb110-1316" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1317"><a href="#cb110-1317" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1318"><a href="#cb110-1318" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1319"><a href="#cb110-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1320"><a href="#cb110-1320" aria-hidden="true" tabindex="-1"></a><span class="co"># Continue from previous cell - redefine for this cell</span></span>
<span id="cb110-1321"><a href="#cb110-1321" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb110-1322"><a href="#cb110-1322" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, DockerConfig</span>
<span id="cb110-1323"><a href="#cb110-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1324"><a href="#cb110-1324" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDataProcessor(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-1325"><a href="#cb110-1325" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Process data with validation."""</span></span>
<span id="cb110-1326"><a href="#cb110-1326" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-1327"><a href="#cb110-1327" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb110-1328"><a href="#cb110-1328" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name<span class="op">=</span><span class="st">"mydataprocessor"</span>, version<span class="op">=</span><span class="st">"1.0.0"</span>)</span>
<span id="cb110-1329"><a href="#cb110-1329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-1330"><a href="#cb110-1330" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1331"><a href="#cb110-1331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"count"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb110-1332"><a href="#cb110-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1333"><a href="#cb110-1333" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyDataProcessor()</span>
<span id="cb110-1334"><a href="#cb110-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1335"><a href="#cb110-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># Advanced Docker configuration</span></span>
<span id="cb110-1336"><a href="#cb110-1336" aria-hidden="true" tabindex="-1"></a>docker_config <span class="op">=</span> DockerConfig(</span>
<span id="cb110-1337"><a href="#cb110-1337" aria-hidden="true" tabindex="-1"></a>    base_image<span class="op">=</span><span class="st">"python:3.11-alpine"</span>,</span>
<span id="cb110-1338"><a href="#cb110-1338" aria-hidden="true" tabindex="-1"></a>    expose_ports<span class="op">=</span>[<span class="dv">8080</span>],</span>
<span id="cb110-1339"><a href="#cb110-1339" aria-hidden="true" tabindex="-1"></a>    environment<span class="op">=</span>{<span class="st">"API_KEY"</span>: <span class="st">"$</span><span class="sc">{API_KEY}</span><span class="st">"</span>, <span class="st">"ENV"</span>: <span class="st">"production"</span>},</span>
<span id="cb110-1340"><a href="#cb110-1340" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"app"</span>: <span class="st">"nanobricks"</span>, <span class="st">"version"</span>: <span class="st">"1.0.0"</span>},</span>
<span id="cb110-1341"><a href="#cb110-1341" aria-hidden="true" tabindex="-1"></a>    healthcheck<span class="op">=</span>{</span>
<span id="cb110-1342"><a href="#cb110-1342" aria-hidden="true" tabindex="-1"></a>        <span class="st">"test"</span>: [<span class="st">"CMD"</span>, <span class="st">"curl"</span>, <span class="st">"-f"</span>, <span class="st">"http://localhost:8080/health"</span>],</span>
<span id="cb110-1343"><a href="#cb110-1343" aria-hidden="true" tabindex="-1"></a>        <span class="st">"interval"</span>: <span class="st">"30s"</span>,</span>
<span id="cb110-1344"><a href="#cb110-1344" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeout"</span>: <span class="st">"3s"</span>,</span>
<span id="cb110-1345"><a href="#cb110-1345" aria-hidden="true" tabindex="-1"></a>        <span class="st">"retries"</span>: <span class="dv">3</span>,</span>
<span id="cb110-1346"><a href="#cb110-1346" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb110-1347"><a href="#cb110-1347" aria-hidden="true" tabindex="-1"></a>    system_packages<span class="op">=</span>[<span class="st">"curl"</span>],  <span class="co"># For healthcheck</span></span>
<span id="cb110-1348"><a href="#cb110-1348" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1349"><a href="#cb110-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1350"><a href="#cb110-1350" aria-hidden="true" tabindex="-1"></a>docker_skill <span class="op">=</span> SkillDocker(docker_config)</span>
<span id="cb110-1351"><a href="#cb110-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1352"><a href="#cb110-1352" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate docker-compose.yml</span></span>
<span id="cb110-1353"><a href="#cb110-1353" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: generate_compose expects a dict of services</span></span>
<span id="cb110-1354"><a href="#cb110-1354" aria-hidden="true" tabindex="-1"></a>compose <span class="op">=</span> docker_skill.generate_compose(</span>
<span id="cb110-1355"><a href="#cb110-1355" aria-hidden="true" tabindex="-1"></a>    services<span class="op">=</span>{<span class="st">"myapp"</span>: brick},</span>
<span id="cb110-1356"><a href="#cb110-1356" aria-hidden="true" tabindex="-1"></a>    networks<span class="op">=</span>[<span class="st">"app-network"</span>],</span>
<span id="cb110-1357"><a href="#cb110-1357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1358"><a href="#cb110-1358" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Docker Compose configuration generated!"</span>)</span>
<span id="cb110-1359"><a href="#cb110-1359" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Compose file includes services, networks, and configuration."</span>)</span>
<span id="cb110-1360"><a href="#cb110-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1361"><a href="#cb110-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1362"><a href="#cb110-1362" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Kubernetes Skill</span></span>
<span id="cb110-1363"><a href="#cb110-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1364"><a href="#cb110-1364" aria-hidden="true" tabindex="-1"></a>Deploy to Kubernetes with automatic manifest generation:</span>
<span id="cb110-1365"><a href="#cb110-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1368"><a href="#cb110-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1369"><a href="#cb110-1369" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1370"><a href="#cb110-1370" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1371"><a href="#cb110-1371" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1372"><a href="#cb110-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1373"><a href="#cb110-1373" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillKubernetes, KubernetesConfig</span>
<span id="cb110-1374"><a href="#cb110-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1375"><a href="#cb110-1375" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Kubernetes deployment</span></span>
<span id="cb110-1376"><a href="#cb110-1376" aria-hidden="true" tabindex="-1"></a>k8s_config <span class="op">=</span> KubernetesConfig(</span>
<span id="cb110-1377"><a href="#cb110-1377" aria-hidden="true" tabindex="-1"></a>    namespace<span class="op">=</span><span class="st">"production"</span>,</span>
<span id="cb110-1378"><a href="#cb110-1378" aria-hidden="true" tabindex="-1"></a>    replicas<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb110-1379"><a href="#cb110-1379" aria-hidden="true" tabindex="-1"></a>    resources<span class="op">=</span>{</span>
<span id="cb110-1380"><a href="#cb110-1380" aria-hidden="true" tabindex="-1"></a>        <span class="st">"requests"</span>: {<span class="st">"cpu"</span>: <span class="st">"100m"</span>, <span class="st">"memory"</span>: <span class="st">"128Mi"</span>},</span>
<span id="cb110-1381"><a href="#cb110-1381" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limits"</span>: {<span class="st">"cpu"</span>: <span class="st">"500m"</span>, <span class="st">"memory"</span>: <span class="st">"512Mi"</span>},</span>
<span id="cb110-1382"><a href="#cb110-1382" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb110-1383"><a href="#cb110-1383" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"app"</span>: <span class="st">"nanobricks"</span>, <span class="st">"tier"</span>: <span class="st">"backend"</span>},</span>
<span id="cb110-1384"><a href="#cb110-1384" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1385"><a href="#cb110-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1386"><a href="#cb110-1386" aria-hidden="true" tabindex="-1"></a>k8s_skill <span class="op">=</span> SkillKubernetes(k8s_config)</span>
<span id="cb110-1387"><a href="#cb110-1387" aria-hidden="true" tabindex="-1"></a><span class="co"># brick = MyAPIBrick()</span></span>
<span id="cb110-1388"><a href="#cb110-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1389"><a href="#cb110-1389" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all Kubernetes manifests</span></span>
<span id="cb110-1390"><a href="#cb110-1390" aria-hidden="true" tabindex="-1"></a><span class="co"># manifests = k8s_skill.generate_manifests(brick, "myapp:v1.0.0")</span></span>
<span id="cb110-1391"><a href="#cb110-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1392"><a href="#cb110-1392" aria-hidden="true" tabindex="-1"></a><span class="co"># Includes:</span></span>
<span id="cb110-1393"><a href="#cb110-1393" aria-hidden="true" tabindex="-1"></a><span class="co"># - Deployment with health checks and resource limits</span></span>
<span id="cb110-1394"><a href="#cb110-1394" aria-hidden="true" tabindex="-1"></a><span class="co"># - Service for load balancing</span></span>
<span id="cb110-1395"><a href="#cb110-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># - HorizontalPodAutoscaler for auto-scaling</span></span>
<span id="cb110-1396"><a href="#cb110-1396" aria-hidden="true" tabindex="-1"></a><span class="co"># - ConfigMap for configuration</span></span>
<span id="cb110-1397"><a href="#cb110-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1398"><a href="#cb110-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1399"><a href="#cb110-1399" aria-hidden="true" tabindex="-1"></a>Generate Helm charts for production deployments:</span>
<span id="cb110-1400"><a href="#cb110-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1403"><a href="#cb110-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1404"><a href="#cb110-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1405"><a href="#cb110-1405" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1406"><a href="#cb110-1406" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1407"><a href="#cb110-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1408"><a href="#cb110-1408" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate complete Helm chart</span></span>
<span id="cb110-1409"><a href="#cb110-1409" aria-hidden="true" tabindex="-1"></a>helm_chart <span class="op">=</span> k8s_skill.generate_helm_chart(brick, <span class="st">"myapp:v1.0.0"</span>)</span>
<span id="cb110-1410"><a href="#cb110-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1411"><a href="#cb110-1411" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates:</span></span>
<span id="cb110-1412"><a href="#cb110-1412" aria-hidden="true" tabindex="-1"></a><span class="co"># - Chart.yaml with metadata</span></span>
<span id="cb110-1413"><a href="#cb110-1413" aria-hidden="true" tabindex="-1"></a><span class="co"># - values.yaml with configurable parameters</span></span>
<span id="cb110-1414"><a href="#cb110-1414" aria-hidden="true" tabindex="-1"></a><span class="co"># - Templates for all Kubernetes resources</span></span>
<span id="cb110-1415"><a href="#cb110-1415" aria-hidden="true" tabindex="-1"></a><span class="co"># - Support for multiple environments</span></span>
<span id="cb110-1416"><a href="#cb110-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1417"><a href="#cb110-1417" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Helm chart structure:"</span>)</span>
<span id="cb110-1418"><a href="#cb110-1418" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename, content <span class="kw">in</span> helm_chart.items():</span>
<span id="cb110-1419"><a href="#cb110-1419" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-1420"><a href="#cb110-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1421"><a href="#cb110-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1422"><a href="#cb110-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Complete Deployment Pipeline</span></span>
<span id="cb110-1423"><a href="#cb110-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1424"><a href="#cb110-1424" aria-hidden="true" tabindex="-1"></a>Combine Docker and Kubernetes for full deployment automation:</span>
<span id="cb110-1425"><a href="#cb110-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1428"><a href="#cb110-1428" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1429"><a href="#cb110-1429" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1430"><a href="#cb110-1430" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1431"><a href="#cb110-1431" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1432"><a href="#cb110-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1433"><a href="#cb110-1433" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick, skill</span>
<span id="cb110-1434"><a href="#cb110-1434" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills.deployment <span class="im">import</span> SkillDocker, SkillKubernetes</span>
<span id="cb110-1435"><a href="#cb110-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1436"><a href="#cb110-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1437"><a href="#cb110-1437" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"logging"</span>)</span>
<span id="cb110-1438"><a href="#cb110-1438" aria-hidden="true" tabindex="-1"></a><span class="at">@skill</span>(<span class="st">"api"</span>, port<span class="op">=</span><span class="dv">8080</span>)</span>
<span id="cb110-1439"><a href="#cb110-1439" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductionBrick(SimpleBrick[<span class="bu">dict</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-1440"><a href="#cb110-1440" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A production-ready nanobrick."""</span></span>
<span id="cb110-1441"><a href="#cb110-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1442"><a href="#cb110-1442" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, <span class="bu">input</span>: <span class="bu">dict</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1443"><a href="#cb110-1443" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Your business logic here</span></span>
<span id="cb110-1444"><a href="#cb110-1444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed"</span>: <span class="va">True</span>, <span class="st">"items"</span>: <span class="bu">len</span>(<span class="bu">input</span>)}</span>
<span id="cb110-1445"><a href="#cb110-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1446"><a href="#cb110-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1447"><a href="#cb110-1447" aria-hidden="true" tabindex="-1"></a><span class="co"># Create deployment pipeline</span></span>
<span id="cb110-1448"><a href="#cb110-1448" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> ProductionBrick()</span>
<span id="cb110-1449"><a href="#cb110-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1450"><a href="#cb110-1450" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Containerize</span></span>
<span id="cb110-1451"><a href="#cb110-1451" aria-hidden="true" tabindex="-1"></a>docker <span class="op">=</span> SkillDocker()</span>
<span id="cb110-1452"><a href="#cb110-1452" aria-hidden="true" tabindex="-1"></a>dockerfile <span class="op">=</span> docker.generate_dockerfile(brick)</span>
<span id="cb110-1453"><a href="#cb110-1453" aria-hidden="true" tabindex="-1"></a>compose <span class="op">=</span> docker.generate_docker_compose(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb110-1454"><a href="#cb110-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1455"><a href="#cb110-1455" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Deploy to Kubernetes</span></span>
<span id="cb110-1456"><a href="#cb110-1456" aria-hidden="true" tabindex="-1"></a>k8s <span class="op">=</span> SkillKubernetes(</span>
<span id="cb110-1457"><a href="#cb110-1457" aria-hidden="true" tabindex="-1"></a>    KubernetesConfig(</span>
<span id="cb110-1458"><a href="#cb110-1458" aria-hidden="true" tabindex="-1"></a>        namespace<span class="op">=</span><span class="st">"production"</span>,</span>
<span id="cb110-1459"><a href="#cb110-1459" aria-hidden="true" tabindex="-1"></a>        replicas<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb110-1460"><a href="#cb110-1460" aria-hidden="true" tabindex="-1"></a>        autoscaling<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1461"><a href="#cb110-1461" aria-hidden="true" tabindex="-1"></a>        min_replicas<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb110-1462"><a href="#cb110-1462" aria-hidden="true" tabindex="-1"></a>        max_replicas<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb110-1463"><a href="#cb110-1463" aria-hidden="true" tabindex="-1"></a>        target_cpu_utilization<span class="op">=</span><span class="dv">70</span>,</span>
<span id="cb110-1464"><a href="#cb110-1464" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb110-1465"><a href="#cb110-1465" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1466"><a href="#cb110-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1467"><a href="#cb110-1467" aria-hidden="true" tabindex="-1"></a>manifests <span class="op">=</span> k8s.generate_manifests(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb110-1468"><a href="#cb110-1468" aria-hidden="true" tabindex="-1"></a>helm_chart <span class="op">=</span> k8s.generate_helm_chart(brick, <span class="st">"myapp:latest"</span>)</span>
<span id="cb110-1469"><a href="#cb110-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1470"><a href="#cb110-1470" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Deployment pipeline ready!"</span>)</span>
<span id="cb110-1471"><a href="#cb110-1471" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Dockerfile: </span><span class="sc">{</span><span class="bu">len</span>(dockerfile)<span class="sc">}</span><span class="ss"> lines"</span>)</span>
<span id="cb110-1472"><a href="#cb110-1472" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Kubernetes manifests: </span><span class="sc">{</span><span class="bu">len</span>(manifests)<span class="sc">}</span><span class="ss"> resources"</span>)</span>
<span id="cb110-1473"><a href="#cb110-1473" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Helm chart: </span><span class="sc">{</span><span class="bu">len</span>(helm_chart)<span class="sc">}</span><span class="ss"> files"</span>)</span>
<span id="cb110-1474"><a href="#cb110-1474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1475"><a href="#cb110-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1476"><a href="#cb110-1476" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 8: Performance Optimizations</span></span>
<span id="cb110-1477"><a href="#cb110-1477" aria-hidden="true" tabindex="-1"></a>*Status: Complete! ✅*</span>
<span id="cb110-1478"><a href="#cb110-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1479"><a href="#cb110-1479" aria-hidden="true" tabindex="-1"></a>Make your nanobricks blazing fast with built-in performance optimizations!</span>
<span id="cb110-1480"><a href="#cb110-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1481"><a href="#cb110-1481" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Caching</span></span>
<span id="cb110-1482"><a href="#cb110-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1483"><a href="#cb110-1483" aria-hidden="true" tabindex="-1"></a>Add intelligent caching to expensive operations:</span>
<span id="cb110-1484"><a href="#cb110-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1487"><a href="#cb110-1487" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1488"><a href="#cb110-1488" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1489"><a href="#cb110-1489" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1490"><a href="#cb110-1490" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1491"><a href="#cb110-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1492"><a href="#cb110-1492" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache</span>
<span id="cb110-1493"><a href="#cb110-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1494"><a href="#cb110-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1495"><a href="#cb110-1495" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an expensive brick</span></span>
<span id="cb110-1496"><a href="#cb110-1496" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DatabaseLookupBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-1497"><a href="#cb110-1497" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, key: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1498"><a href="#cb110-1498" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate expensive database query</span></span>
<span id="cb110-1499"><a href="#cb110-1499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.5</span>)</span>
<span id="cb110-1500"><a href="#cb110-1500" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"key"</span>: key, <span class="st">"data"</span>: <span class="ss">f"Data for </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb110-1501"><a href="#cb110-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1502"><a href="#cb110-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1503"><a href="#cb110-1503" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching</span></span>
<span id="cb110-1504"><a href="#cb110-1504" aria-hidden="true" tabindex="-1"></a>db_brick <span class="op">=</span> DatabaseLookupBrick()</span>
<span id="cb110-1505"><a href="#cb110-1505" aria-hidden="true" tabindex="-1"></a>cached_db <span class="op">=</span> with_cache(db_brick, max_size<span class="op">=</span><span class="dv">100</span>, ttl<span class="op">=</span><span class="dv">300</span>)  <span class="co"># 5 min TTL</span></span>
<span id="cb110-1506"><a href="#cb110-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1507"><a href="#cb110-1507" aria-hidden="true" tabindex="-1"></a><span class="co"># First call - slow (cache miss)</span></span>
<span id="cb110-1508"><a href="#cb110-1508" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> cached_db.invoke(<span class="st">"user123"</span>)  <span class="co"># Takes 0.5s</span></span>
<span id="cb110-1509"><a href="#cb110-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1510"><a href="#cb110-1510" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call - fast (cache hit)</span></span>
<span id="cb110-1511"><a href="#cb110-1511" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> cached_db.invoke(<span class="st">"user123"</span>)  <span class="co"># Instant!</span></span>
<span id="cb110-1512"><a href="#cb110-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1513"><a href="#cb110-1513" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cache stats</span></span>
<span id="cb110-1514"><a href="#cb110-1514" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cached_db.cache_info())</span>
<span id="cb110-1515"><a href="#cb110-1515" aria-hidden="true" tabindex="-1"></a><span class="co"># {'size': 1, 'max_size': 100, 'ttl': 300, ...}</span></span>
<span id="cb110-1516"><a href="#cb110-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1517"><a href="#cb110-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1518"><a href="#cb110-1518" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Batching</span></span>
<span id="cb110-1519"><a href="#cb110-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1520"><a href="#cb110-1520" aria-hidden="true" tabindex="-1"></a>Process multiple items efficiently:</span>
<span id="cb110-1521"><a href="#cb110-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1524"><a href="#cb110-1524" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1525"><a href="#cb110-1525" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1526"><a href="#cb110-1526" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1527"><a href="#cb110-1527" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1528"><a href="#cb110-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1529"><a href="#cb110-1529" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_batching</span>
<span id="cb110-1530"><a href="#cb110-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1531"><a href="#cb110-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1532"><a href="#cb110-1532" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a brick that benefits from batching</span></span>
<span id="cb110-1533"><a href="#cb110-1533" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> APICallBrick(SimpleBrick[<span class="bu">str</span>, <span class="bu">dict</span>]):</span>
<span id="cb110-1534"><a href="#cb110-1534" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> invoke(<span class="va">self</span>, item: <span class="bu">str</span>, <span class="op">*</span>, deps<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb110-1535"><a href="#cb110-1535" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate API call</span></span>
<span id="cb110-1536"><a href="#cb110-1536" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)</span>
<span id="cb110-1537"><a href="#cb110-1537" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"id"</span>: item, <span class="st">"processed"</span>: <span class="va">True</span>}</span>
<span id="cb110-1538"><a href="#cb110-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1539"><a href="#cb110-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1540"><a href="#cb110-1540" aria-hidden="true" tabindex="-1"></a><span class="co"># Add batching</span></span>
<span id="cb110-1541"><a href="#cb110-1541" aria-hidden="true" tabindex="-1"></a>api_brick <span class="op">=</span> APICallBrick()</span>
<span id="cb110-1542"><a href="#cb110-1542" aria-hidden="true" tabindex="-1"></a>batched_api <span class="op">=</span> with_batching(api_brick, batch_size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb110-1543"><a href="#cb110-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1544"><a href="#cb110-1544" aria-hidden="true" tabindex="-1"></a><span class="co"># Process multiple items efficiently</span></span>
<span id="cb110-1545"><a href="#cb110-1545" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="ss">f"item_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]</span>
<span id="cb110-1546"><a href="#cb110-1546" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> batched_api.invoke(items)</span>
<span id="cb110-1547"><a href="#cb110-1547" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results)</span>
<span id="cb110-1548"><a href="#cb110-1548" aria-hidden="true" tabindex="-1"></a><span class="co"># Processes in batches</span></span>
<span id="cb110-1549"><a href="#cb110-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1550"><a href="#cb110-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1551"><a href="#cb110-1551" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pipeline Fusion</span></span>
<span id="cb110-1552"><a href="#cb110-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1553"><a href="#cb110-1553" aria-hidden="true" tabindex="-1"></a>Optimize long pipelines by fusing operations:</span>
<span id="cb110-1554"><a href="#cb110-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1557"><a href="#cb110-1557" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1558"><a href="#cb110-1558" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1559"><a href="#cb110-1559" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1560"><a href="#cb110-1560" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1561"><a href="#cb110-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1562"><a href="#cb110-1562" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> Pipeline</span>
<span id="cb110-1563"><a href="#cb110-1563" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> fuse_pipeline</span>
<span id="cb110-1564"><a href="#cb110-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1565"><a href="#cb110-1565" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline</span></span>
<span id="cb110-1566"><a href="#cb110-1566" aria-hidden="true" tabindex="-1"></a>step1 <span class="op">=</span> TransformBrick()</span>
<span id="cb110-1567"><a href="#cb110-1567" aria-hidden="true" tabindex="-1"></a>step2 <span class="op">=</span> ValidateBrick()</span>
<span id="cb110-1568"><a href="#cb110-1568" aria-hidden="true" tabindex="-1"></a>step3 <span class="op">=</span> EnrichBrick()</span>
<span id="cb110-1569"><a href="#cb110-1569" aria-hidden="true" tabindex="-1"></a>step4 <span class="op">=</span> SaveBrick()</span>
<span id="cb110-1570"><a href="#cb110-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1571"><a href="#cb110-1571" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular pipeline</span></span>
<span id="cb110-1572"><a href="#cb110-1572" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(step1, step2, step3, step4)</span>
<span id="cb110-1573"><a href="#cb110-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1574"><a href="#cb110-1574" aria-hidden="true" tabindex="-1"></a><span class="co"># Fused pipeline - reduces async overhead</span></span>
<span id="cb110-1575"><a href="#cb110-1575" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> fuse_pipeline(pipeline)</span>
<span id="cb110-1576"><a href="#cb110-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1577"><a href="#cb110-1577" aria-hidden="true" tabindex="-1"></a><span class="co"># Both work the same, but fused is faster</span></span>
<span id="cb110-1578"><a href="#cb110-1578" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> fused.invoke(data)</span>
<span id="cb110-1579"><a href="#cb110-1579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1580"><a href="#cb110-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1581"><a href="#cb110-1581" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Memory Pooling</span></span>
<span id="cb110-1582"><a href="#cb110-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1583"><a href="#cb110-1583" aria-hidden="true" tabindex="-1"></a>Reuse objects to reduce allocation overhead:</span>
<span id="cb110-1584"><a href="#cb110-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1587"><a href="#cb110-1587" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1588"><a href="#cb110-1588" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb110-1589"><a href="#cb110-1589" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1590"><a href="#cb110-1590" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1591"><a href="#cb110-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1592"><a href="#cb110-1592" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> MemoryPool</span>
<span id="cb110-1593"><a href="#cb110-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1594"><a href="#cb110-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1595"><a href="#cb110-1595" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pool of reusable processors</span></span>
<span id="cb110-1596"><a href="#cb110-1596" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataProcessor:</span>
<span id="cb110-1597"><a href="#cb110-1597" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb110-1598"><a href="#cb110-1598" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">buffer</span> <span class="op">=</span> <span class="bu">bytearray</span>(<span class="dv">1024</span>)</span>
<span id="cb110-1599"><a href="#cb110-1599" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results <span class="op">=</span> []</span>
<span id="cb110-1600"><a href="#cb110-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1601"><a href="#cb110-1601" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset(<span class="va">self</span>):</span>
<span id="cb110-1602"><a href="#cb110-1602" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results.clear()</span>
<span id="cb110-1603"><a href="#cb110-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1604"><a href="#cb110-1604" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process(<span class="va">self</span>, data):</span>
<span id="cb110-1605"><a href="#cb110-1605" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process using pre-allocated buffer</span></span>
<span id="cb110-1606"><a href="#cb110-1606" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.results.append(<span class="bu">len</span>(data))</span>
<span id="cb110-1607"><a href="#cb110-1607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.results</span>
<span id="cb110-1608"><a href="#cb110-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1609"><a href="#cb110-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1610"><a href="#cb110-1610" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pool</span></span>
<span id="cb110-1611"><a href="#cb110-1611" aria-hidden="true" tabindex="-1"></a>pool <span class="op">=</span> MemoryPool(DataProcessor, size<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb110-1612"><a href="#cb110-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1613"><a href="#cb110-1613" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pooled objects</span></span>
<span id="cb110-1614"><a href="#cb110-1614" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> pool.acquire()</span>
<span id="cb110-1615"><a href="#cb110-1615" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> processor.process(<span class="st">"hello"</span>)</span>
<span id="cb110-1616"><a href="#cb110-1616" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb110-1617"><a href="#cb110-1617" aria-hidden="true" tabindex="-1"></a>pool.release(processor)  <span class="co"># Returns to pool for reuse</span></span>
<span id="cb110-1618"><a href="#cb110-1618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1619"><a href="#cb110-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1620"><a href="#cb110-1620" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Combined Optimizations</span></span>
<span id="cb110-1621"><a href="#cb110-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1622"><a href="#cb110-1622" aria-hidden="true" tabindex="-1"></a>Stack optimizations for maximum performance:</span>
<span id="cb110-1623"><a href="#cb110-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1626"><a href="#cb110-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1627"><a href="#cb110-1627" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1628"><a href="#cb110-1628" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1629"><a href="#cb110-1629" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: true</span></span>
<span id="cb110-1630"><a href="#cb110-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1631"><a href="#cb110-1631" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> SimpleBrick</span>
<span id="cb110-1632"><a href="#cb110-1632" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache, fuse_pipeline</span>
<span id="cb110-1633"><a href="#cb110-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1634"><a href="#cb110-1634" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complex pipeline</span></span>
<span id="cb110-1635"><a href="#cb110-1635" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> DataValidator()</span>
<span id="cb110-1636"><a href="#cb110-1636" aria-hidden="true" tabindex="-1"></a>enricher <span class="op">=</span> DataEnricher()</span>
<span id="cb110-1637"><a href="#cb110-1637" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> DataTransformer()</span>
<span id="cb110-1638"><a href="#cb110-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1639"><a href="#cb110-1639" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching to expensive operations</span></span>
<span id="cb110-1640"><a href="#cb110-1640" aria-hidden="true" tabindex="-1"></a>cached_enricher <span class="op">=</span> with_cache(enricher, max_size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb110-1641"><a href="#cb110-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1642"><a href="#cb110-1642" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fuse pipeline</span></span>
<span id="cb110-1643"><a href="#cb110-1643" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> validator <span class="op">|</span> cached_enricher <span class="op">|</span> transformer</span>
<span id="cb110-1644"><a href="#cb110-1644" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> fuse_pipeline([validator, cached_enricher, transformer])</span>
<span id="cb110-1645"><a href="#cb110-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1646"><a href="#cb110-1646" aria-hidden="true" tabindex="-1"></a><span class="co"># Ultra-fast processing with caching and fusion</span></span>
<span id="cb110-1647"><a href="#cb110-1647" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb110-1648"><a href="#cb110-1648" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> large_dataset:</span>
<span id="cb110-1649"><a href="#cb110-1649" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> fused.invoke(item)  <span class="co"># Cached + fused!</span></span>
<span id="cb110-1650"><a href="#cb110-1650" aria-hidden="true" tabindex="-1"></a>    results.append(result)</span>
<span id="cb110-1651"><a href="#cb110-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1652"><a href="#cb110-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1653"><a href="#cb110-1653" aria-hidden="true" tabindex="-1"></a><span class="fu">## Built-in Transformers</span></span>
<span id="cb110-1654"><a href="#cb110-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1655"><a href="#cb110-1655" aria-hidden="true" tabindex="-1"></a><span class="fu">### CSV Transformers</span></span>
<span id="cb110-1656"><a href="#cb110-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1657"><a href="#cb110-1657" aria-hidden="true" tabindex="-1"></a>Work with CSV data seamlessly:</span>
<span id="cb110-1658"><a href="#cb110-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1661"><a href="#cb110-1661" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1662"><a href="#cb110-1662" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1663"><a href="#cb110-1663" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1664"><a href="#cb110-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1665"><a href="#cb110-1665" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> CSVParser, CSVSerializer</span>
<span id="cb110-1666"><a href="#cb110-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1667"><a href="#cb110-1667" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse CSV text</span></span>
<span id="cb110-1668"><a href="#cb110-1668" aria-hidden="true" tabindex="-1"></a>parser <span class="op">=</span> CSVParser(delimiter<span class="op">=</span><span class="st">","</span>, strip_values<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-1669"><a href="#cb110-1669" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="cf">await</span> parser.invoke(<span class="st">"""name,age,city</span></span>
<span id="cb110-1670"><a href="#cb110-1670" aria-hidden="true" tabindex="-1"></a><span class="st">Alice,30,New York</span></span>
<span id="cb110-1671"><a href="#cb110-1671" aria-hidden="true" tabindex="-1"></a><span class="st">Bob,25,London"""</span>)</span>
<span id="cb110-1672"><a href="#cb110-1672" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: [{"name": "Alice", "age": "30", "city": "New York"}, ...]</span></span>
<span id="cb110-1673"><a href="#cb110-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1674"><a href="#cb110-1674" aria-hidden="true" tabindex="-1"></a><span class="co"># Serialize back to CSV</span></span>
<span id="cb110-1675"><a href="#cb110-1675" aria-hidden="true" tabindex="-1"></a>serializer <span class="op">=</span> CSVSerializer(columns<span class="op">=</span>[<span class="st">"name"</span>, <span class="st">"city"</span>])  <span class="co"># Select columns</span></span>
<span id="cb110-1676"><a href="#cb110-1676" aria-hidden="true" tabindex="-1"></a>csv_text <span class="op">=</span> <span class="cf">await</span> serializer.invoke(data)</span>
<span id="cb110-1677"><a href="#cb110-1677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1678"><a href="#cb110-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1679"><a href="#cb110-1679" aria-hidden="true" tabindex="-1"></a><span class="fu">### Text Normalization</span></span>
<span id="cb110-1680"><a href="#cb110-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1681"><a href="#cb110-1681" aria-hidden="true" tabindex="-1"></a>Clean and normalize text data:</span>
<span id="cb110-1682"><a href="#cb110-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1685"><a href="#cb110-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1686"><a href="#cb110-1686" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1687"><a href="#cb110-1687" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1688"><a href="#cb110-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1689"><a href="#cb110-1689" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> TextNormalizer</span>
<span id="cb110-1690"><a href="#cb110-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1691"><a href="#cb110-1691" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure normalization</span></span>
<span id="cb110-1692"><a href="#cb110-1692" aria-hidden="true" tabindex="-1"></a>normalizer <span class="op">=</span> TextNormalizer(</span>
<span id="cb110-1693"><a href="#cb110-1693" aria-hidden="true" tabindex="-1"></a>    lowercase<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1694"><a href="#cb110-1694" aria-hidden="true" tabindex="-1"></a>    remove_punctuation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1695"><a href="#cb110-1695" aria-hidden="true" tabindex="-1"></a>    expand_contractions<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1696"><a href="#cb110-1696" aria-hidden="true" tabindex="-1"></a>    remove_urls<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1697"><a href="#cb110-1697" aria-hidden="true" tabindex="-1"></a>    custom_replacements<span class="op">=</span>{</span>
<span id="cb110-1698"><a href="#cb110-1698" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CEO"</span>: <span class="st">"Chief Executive Officer"</span>,</span>
<span id="cb110-1699"><a href="#cb110-1699" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AI"</span>: <span class="st">"Artificial Intelligence"</span></span>
<span id="cb110-1700"><a href="#cb110-1700" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-1701"><a href="#cb110-1701" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1702"><a href="#cb110-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1703"><a href="#cb110-1703" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"The CEO said: Don't miss our AI update at https://example.com!"</span></span>
<span id="cb110-1704"><a href="#cb110-1704" aria-hidden="true" tabindex="-1"></a>clean <span class="op">=</span> <span class="cf">await</span> normalizer.invoke(text)</span>
<span id="cb110-1705"><a href="#cb110-1705" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: "the chief executive officer said do not miss our artificial intelligence update"</span></span>
<span id="cb110-1706"><a href="#cb110-1706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1707"><a href="#cb110-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1708"><a href="#cb110-1708" aria-hidden="true" tabindex="-1"></a><span class="fu">### Smart Type Conversion</span></span>
<span id="cb110-1709"><a href="#cb110-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1710"><a href="#cb110-1710" aria-hidden="true" tabindex="-1"></a>Convert between types intelligently:</span>
<span id="cb110-1711"><a href="#cb110-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1714"><a href="#cb110-1714" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1715"><a href="#cb110-1715" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1716"><a href="#cb110-1716" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1717"><a href="#cb110-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1718"><a href="#cb110-1718" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> SmartTypeConverter, BulkTypeConverter</span>
<span id="cb110-1719"><a href="#cb110-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1720"><a href="#cb110-1720" aria-hidden="true" tabindex="-1"></a><span class="co"># Single value conversion</span></span>
<span id="cb110-1721"><a href="#cb110-1721" aria-hidden="true" tabindex="-1"></a>to_date <span class="op">=</span> SmartTypeConverter(target_type<span class="op">=</span>date, date_format<span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb110-1722"><a href="#cb110-1722" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> to_date.invoke(<span class="st">"2024-01-15"</span>)  <span class="co"># Returns date object</span></span>
<span id="cb110-1723"><a href="#cb110-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1724"><a href="#cb110-1724" aria-hidden="true" tabindex="-1"></a><span class="co"># Bulk conversion with error handling</span></span>
<span id="cb110-1725"><a href="#cb110-1725" aria-hidden="true" tabindex="-1"></a>to_int <span class="op">=</span> BulkTypeConverter(</span>
<span id="cb110-1726"><a href="#cb110-1726" aria-hidden="true" tabindex="-1"></a>    target_type<span class="op">=</span><span class="bu">int</span>,</span>
<span id="cb110-1727"><a href="#cb110-1727" aria-hidden="true" tabindex="-1"></a>    skip_errors<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-1728"><a href="#cb110-1728" aria-hidden="true" tabindex="-1"></a>    error_value<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb110-1729"><a href="#cb110-1729" aria-hidden="true" tabindex="-1"></a>    report_errors<span class="op">=</span><span class="va">True</span></span>
<span id="cb110-1730"><a href="#cb110-1730" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1731"><a href="#cb110-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1732"><a href="#cb110-1732" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">"42"</span>, <span class="st">"100"</span>, <span class="st">"invalid"</span>, <span class="st">"75"</span>]</span>
<span id="cb110-1733"><a href="#cb110-1733" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> to_int.invoke(values)</span>
<span id="cb110-1734"><a href="#cb110-1734" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: {"results": [42, 100, 0, 75], "error_count": 1, ...}</span></span>
<span id="cb110-1735"><a href="#cb110-1735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1736"><a href="#cb110-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1737"><a href="#cb110-1737" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dynamic Type Conversion</span></span>
<span id="cb110-1738"><a href="#cb110-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1739"><a href="#cb110-1739" aria-hidden="true" tabindex="-1"></a>Convert dictionaries with type hints:</span>
<span id="cb110-1740"><a href="#cb110-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1743"><a href="#cb110-1743" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1744"><a href="#cb110-1744" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1745"><a href="#cb110-1745" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1746"><a href="#cb110-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1747"><a href="#cb110-1747" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> DynamicTypeConverter</span>
<span id="cb110-1748"><a href="#cb110-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1749"><a href="#cb110-1749" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure type mappings</span></span>
<span id="cb110-1750"><a href="#cb110-1750" aria-hidden="true" tabindex="-1"></a>converter <span class="op">=</span> DynamicTypeConverter(</span>
<span id="cb110-1751"><a href="#cb110-1751" aria-hidden="true" tabindex="-1"></a>    type_map<span class="op">=</span>{<span class="st">"age"</span>: <span class="bu">int</span>, <span class="st">"active"</span>: <span class="bu">bool</span>},</span>
<span id="cb110-1752"><a href="#cb110-1752" aria-hidden="true" tabindex="-1"></a>    infer_types<span class="op">=</span><span class="va">True</span>  <span class="co"># Auto-detect numbers and booleans</span></span>
<span id="cb110-1753"><a href="#cb110-1753" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1754"><a href="#cb110-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1755"><a href="#cb110-1755" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb110-1756"><a href="#cb110-1756" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>: <span class="st">"Alice"</span>,</span>
<span id="cb110-1757"><a href="#cb110-1757" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>: <span class="st">"30"</span>,        <span class="co"># Will convert to int</span></span>
<span id="cb110-1758"><a href="#cb110-1758" aria-hidden="true" tabindex="-1"></a>    <span class="st">"salary"</span>: <span class="st">"50000.50"</span>,  <span class="co"># Will infer as float</span></span>
<span id="cb110-1759"><a href="#cb110-1759" aria-hidden="true" tabindex="-1"></a>    <span class="st">"active"</span>: <span class="st">"yes"</span>     <span class="co"># Will convert to bool</span></span>
<span id="cb110-1760"><a href="#cb110-1760" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-1761"><a href="#cb110-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1762"><a href="#cb110-1762" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> converter.invoke(data)</span>
<span id="cb110-1763"><a href="#cb110-1763" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: {"name": "Alice", "age": 30, "salary": 50000.5, "active": True}</span></span>
<span id="cb110-1764"><a href="#cb110-1764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1765"><a href="#cb110-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1766"><a href="#cb110-1766" aria-hidden="true" tabindex="-1"></a><span class="fu">### DataFrame Transformers</span></span>
<span id="cb110-1767"><a href="#cb110-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1768"><a href="#cb110-1768" aria-hidden="true" tabindex="-1"></a>Work with pandas DataFrames for powerful data analysis:</span>
<span id="cb110-1769"><a href="#cb110-1769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1772"><a href="#cb110-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1773"><a href="#cb110-1773" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1774"><a href="#cb110-1774" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1775"><a href="#cb110-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1776"><a href="#cb110-1776" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> (</span>
<span id="cb110-1777"><a href="#cb110-1777" aria-hidden="true" tabindex="-1"></a>    DataFrameFilter,</span>
<span id="cb110-1778"><a href="#cb110-1778" aria-hidden="true" tabindex="-1"></a>    DataFrameGroupBy,</span>
<span id="cb110-1779"><a href="#cb110-1779" aria-hidden="true" tabindex="-1"></a>    DataFrameMerge,</span>
<span id="cb110-1780"><a href="#cb110-1780" aria-hidden="true" tabindex="-1"></a>    DataFrameReshape</span>
<span id="cb110-1781"><a href="#cb110-1781" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1782"><a href="#cb110-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1783"><a href="#cb110-1783" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data</span></span>
<span id="cb110-1784"><a href="#cb110-1784" aria-hidden="true" tabindex="-1"></a>sales_data <span class="op">=</span> [</span>
<span id="cb110-1785"><a href="#cb110-1785" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"price"</span>: <span class="fl">999.99</span>, <span class="st">"quantity"</span>: <span class="dv">5</span>, <span class="st">"region"</span>: <span class="st">"North"</span>},</span>
<span id="cb110-1786"><a href="#cb110-1786" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Mouse"</span>, <span class="st">"price"</span>: <span class="fl">29.99</span>, <span class="st">"quantity"</span>: <span class="dv">15</span>, <span class="st">"region"</span>: <span class="st">"South"</span>},</span>
<span id="cb110-1787"><a href="#cb110-1787" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"price"</span>: <span class="fl">999.99</span>, <span class="st">"quantity"</span>: <span class="dv">3</span>, <span class="st">"region"</span>: <span class="st">"South"</span>},</span>
<span id="cb110-1788"><a href="#cb110-1788" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb110-1789"><a href="#cb110-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1790"><a href="#cb110-1790" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter high-value sales</span></span>
<span id="cb110-1791"><a href="#cb110-1791" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> DataFrameFilter(</span>
<span id="cb110-1792"><a href="#cb110-1792" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"price"</span>,</span>
<span id="cb110-1793"><a href="#cb110-1793" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb110-1794"><a href="#cb110-1794" aria-hidden="true" tabindex="-1"></a>    op<span class="op">=</span><span class="st">"&gt;"</span></span>
<span id="cb110-1795"><a href="#cb110-1795" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1796"><a href="#cb110-1796" aria-hidden="true" tabindex="-1"></a>expensive_items <span class="op">=</span> <span class="cf">await</span> <span class="bu">filter</span>.invoke(sales_data)</span>
<span id="cb110-1797"><a href="#cb110-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1798"><a href="#cb110-1798" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and aggregate</span></span>
<span id="cb110-1799"><a href="#cb110-1799" aria-hidden="true" tabindex="-1"></a>groupby <span class="op">=</span> DataFrameGroupBy(</span>
<span id="cb110-1800"><a href="#cb110-1800" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"product"</span>,</span>
<span id="cb110-1801"><a href="#cb110-1801" aria-hidden="true" tabindex="-1"></a>    agg<span class="op">=</span>{</span>
<span id="cb110-1802"><a href="#cb110-1802" aria-hidden="true" tabindex="-1"></a>        <span class="st">"quantity"</span>: <span class="st">"sum"</span>,</span>
<span id="cb110-1803"><a href="#cb110-1803" aria-hidden="true" tabindex="-1"></a>        <span class="st">"price"</span>: [<span class="st">"mean"</span>, <span class="st">"count"</span>]</span>
<span id="cb110-1804"><a href="#cb110-1804" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-1805"><a href="#cb110-1805" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1806"><a href="#cb110-1806" aria-hidden="true" tabindex="-1"></a>product_summary <span class="op">=</span> <span class="cf">await</span> groupby.invoke(sales_data)</span>
<span id="cb110-1807"><a href="#cb110-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1808"><a href="#cb110-1808" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot data</span></span>
<span id="cb110-1809"><a href="#cb110-1809" aria-hidden="true" tabindex="-1"></a>pivot <span class="op">=</span> DataFrameReshape(</span>
<span id="cb110-1810"><a href="#cb110-1810" aria-hidden="true" tabindex="-1"></a>    reshape_type<span class="op">=</span><span class="st">"pivot"</span>,</span>
<span id="cb110-1811"><a href="#cb110-1811" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"product"</span>,</span>
<span id="cb110-1812"><a href="#cb110-1812" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"region"</span>,</span>
<span id="cb110-1813"><a href="#cb110-1813" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">"quantity"</span>,</span>
<span id="cb110-1814"><a href="#cb110-1814" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">"sum"</span></span>
<span id="cb110-1815"><a href="#cb110-1815" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1816"><a href="#cb110-1816" aria-hidden="true" tabindex="-1"></a>pivot_table <span class="op">=</span> <span class="cf">await</span> pivot.invoke(sales_data)</span>
<span id="cb110-1817"><a href="#cb110-1817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1818"><a href="#cb110-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1819"><a href="#cb110-1819" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Advanced DataFrame Operations</span></span>
<span id="cb110-1820"><a href="#cb110-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1823"><a href="#cb110-1823" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1824"><a href="#cb110-1824" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1825"><a href="#cb110-1825" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1826"><a href="#cb110-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1827"><a href="#cb110-1827" aria-hidden="true" tabindex="-1"></a><span class="co"># Complex filtering with queries</span></span>
<span id="cb110-1828"><a href="#cb110-1828" aria-hidden="true" tabindex="-1"></a>complex_filter <span class="op">=</span> DataFrameFilter(</span>
<span id="cb110-1829"><a href="#cb110-1829" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span><span class="st">"price &gt; 50 and region == 'North' and quantity &gt;= 5"</span></span>
<span id="cb110-1830"><a href="#cb110-1830" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1831"><a href="#cb110-1831" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> <span class="cf">await</span> complex_filter.invoke(sales_data)</span>
<span id="cb110-1832"><a href="#cb110-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1833"><a href="#cb110-1833" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with additional data</span></span>
<span id="cb110-1834"><a href="#cb110-1834" aria-hidden="true" tabindex="-1"></a>product_info <span class="op">=</span> pd.DataFrame([</span>
<span id="cb110-1835"><a href="#cb110-1835" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Laptop"</span>, <span class="st">"category"</span>: <span class="st">"Electronics"</span>, <span class="st">"cost"</span>: <span class="dv">700</span>},</span>
<span id="cb110-1836"><a href="#cb110-1836" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"product"</span>: <span class="st">"Mouse"</span>, <span class="st">"category"</span>: <span class="st">"Electronics"</span>, <span class="st">"cost"</span>: <span class="dv">15</span>}</span>
<span id="cb110-1837"><a href="#cb110-1837" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb110-1838"><a href="#cb110-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1839"><a href="#cb110-1839" aria-hidden="true" tabindex="-1"></a>merge <span class="op">=</span> DataFrameMerge(</span>
<span id="cb110-1840"><a href="#cb110-1840" aria-hidden="true" tabindex="-1"></a>    other<span class="op">=</span>product_info,</span>
<span id="cb110-1841"><a href="#cb110-1841" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb110-1842"><a href="#cb110-1842" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"product"</span></span>
<span id="cb110-1843"><a href="#cb110-1843" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1844"><a href="#cb110-1844" aria-hidden="true" tabindex="-1"></a>enriched_data <span class="op">=</span> <span class="cf">await</span> merge.invoke(sales_data)</span>
<span id="cb110-1845"><a href="#cb110-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1846"><a href="#cb110-1846" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series operations (requires datetime index)</span></span>
<span id="cb110-1847"><a href="#cb110-1847" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.transformers <span class="im">import</span> DataFrameTimeSeriesOperator</span>
<span id="cb110-1848"><a href="#cb110-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1849"><a href="#cb110-1849" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling average</span></span>
<span id="cb110-1850"><a href="#cb110-1850" aria-hidden="true" tabindex="-1"></a>rolling <span class="op">=</span> DataFrameTimeSeriesOperator(</span>
<span id="cb110-1851"><a href="#cb110-1851" aria-hidden="true" tabindex="-1"></a>    operation<span class="op">=</span><span class="st">"rolling"</span>,</span>
<span id="cb110-1852"><a href="#cb110-1852" aria-hidden="true" tabindex="-1"></a>    window<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb110-1853"><a href="#cb110-1853" aria-hidden="true" tabindex="-1"></a>    func<span class="op">=</span><span class="st">"mean"</span></span>
<span id="cb110-1854"><a href="#cb110-1854" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1855"><a href="#cb110-1855" aria-hidden="true" tabindex="-1"></a>smoothed_data <span class="op">=</span> <span class="cf">await</span> rolling.invoke(time_series_df)</span>
<span id="cb110-1856"><a href="#cb110-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1857"><a href="#cb110-1857" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to weekly</span></span>
<span id="cb110-1858"><a href="#cb110-1858" aria-hidden="true" tabindex="-1"></a>resample <span class="op">=</span> DataFrameTimeSeriesOperator(</span>
<span id="cb110-1859"><a href="#cb110-1859" aria-hidden="true" tabindex="-1"></a>    operation<span class="op">=</span><span class="st">"resample"</span>,</span>
<span id="cb110-1860"><a href="#cb110-1860" aria-hidden="true" tabindex="-1"></a>    rule<span class="op">=</span><span class="st">"W"</span>,  <span class="co"># Weekly</span></span>
<span id="cb110-1861"><a href="#cb110-1861" aria-hidden="true" tabindex="-1"></a>    func<span class="op">=</span><span class="st">"sum"</span></span>
<span id="cb110-1862"><a href="#cb110-1862" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-1863"><a href="#cb110-1863" aria-hidden="true" tabindex="-1"></a>weekly_data <span class="op">=</span> <span class="cf">await</span> resample.invoke(time_series_df)</span>
<span id="cb110-1864"><a href="#cb110-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1865"><a href="#cb110-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1866"><a href="#cb110-1866" aria-hidden="true" tabindex="-1"></a><span class="fu">## Developer Tools</span></span>
<span id="cb110-1867"><a href="#cb110-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1868"><a href="#cb110-1868" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project Scaffolding</span></span>
<span id="cb110-1869"><a href="#cb110-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1870"><a href="#cb110-1870" aria-hidden="true" tabindex="-1"></a>Create new nanobrick projects in seconds:</span>
<span id="cb110-1871"><a href="#cb110-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1872"><a href="#cb110-1872" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb110-1873"><a href="#cb110-1873" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new project</span></span>
<span id="cb110-1874"><a href="#cb110-1874" aria-hidden="true" tabindex="-1"></a><span class="ex">nanobrick</span> new my-awesome-brick <span class="dt">\</span></span>
<span id="cb110-1875"><a href="#cb110-1875" aria-hidden="true" tabindex="-1"></a>  <span class="at">--description</span> <span class="st">"An awesome data processor"</span> <span class="dt">\</span></span>
<span id="cb110-1876"><a href="#cb110-1876" aria-hidden="true" tabindex="-1"></a>  <span class="at">--author</span> <span class="st">"Your Name"</span> <span class="dt">\</span></span>
<span id="cb110-1877"><a href="#cb110-1877" aria-hidden="true" tabindex="-1"></a>  <span class="at">--email</span> <span class="st">"you@example.com"</span></span>
<span id="cb110-1878"><a href="#cb110-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1879"><a href="#cb110-1879" aria-hidden="true" tabindex="-1"></a><span class="co"># Project structure created:</span></span>
<span id="cb110-1880"><a href="#cb110-1880" aria-hidden="true" tabindex="-1"></a><span class="ex">my-awesome-brick/</span></span>
<span id="cb110-1881"><a href="#cb110-1881" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> pyproject.toml          <span class="co"># Project metadata &amp; dependencies</span></span>
<span id="cb110-1882"><a href="#cb110-1882" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> nanobrick.toml          <span class="co"># Nanobrick configuration</span></span>
<span id="cb110-1883"><a href="#cb110-1883" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md               <span class="co"># Documentation</span></span>
<span id="cb110-1884"><a href="#cb110-1884" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .gitignore              <span class="co"># Git ignore patterns</span></span>
<span id="cb110-1885"><a href="#cb110-1885" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .vscode/</span>
<span id="cb110-1886"><a href="#cb110-1886" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── settings.json       <span class="co"># VS Code configuration</span></span>
<span id="cb110-1887"><a href="#cb110-1887" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src/</span>
<span id="cb110-1888"><a href="#cb110-1888" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── my_awesome_brick/</span>
<span id="cb110-1889"><a href="#cb110-1889" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── __init__.py</span>
<span id="cb110-1890"><a href="#cb110-1890" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── core.py         <span class="co"># Your brick implementation</span></span>
<span id="cb110-1891"><a href="#cb110-1891" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests/</span>
<span id="cb110-1892"><a href="#cb110-1892" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> __init__.py</span>
<span id="cb110-1893"><a href="#cb110-1893" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> test_my_awesome_brick.py</span>
<span id="cb110-1894"><a href="#cb110-1894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1895"><a href="#cb110-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1896"><a href="#cb110-1896" aria-hidden="true" tabindex="-1"></a>The generated brick is ready to use:</span>
<span id="cb110-1897"><a href="#cb110-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1900"><a href="#cb110-1900" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1901"><a href="#cb110-1901" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1902"><a href="#cb110-1902" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1903"><a href="#cb110-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1904"><a href="#cb110-1904" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> my_awesome_brick <span class="im">import</span> MyAwesomeBrick</span>
<span id="cb110-1905"><a href="#cb110-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1906"><a href="#cb110-1906" aria-hidden="true" tabindex="-1"></a><span class="co"># Use your new brick</span></span>
<span id="cb110-1907"><a href="#cb110-1907" aria-hidden="true" tabindex="-1"></a>brick <span class="op">=</span> MyAwesomeBrick(prefix<span class="op">=</span><span class="st">"AWESOME"</span>)</span>
<span id="cb110-1908"><a href="#cb110-1908" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> brick.invoke(<span class="st">"hello"</span>)</span>
<span id="cb110-1909"><a href="#cb110-1909" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: "AWESOME: hello processed"</span></span>
<span id="cb110-1910"><a href="#cb110-1910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1911"><a href="#cb110-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1912"><a href="#cb110-1912" aria-hidden="true" tabindex="-1"></a><span class="fu">### Documentation Generation</span></span>
<span id="cb110-1913"><a href="#cb110-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1914"><a href="#cb110-1914" aria-hidden="true" tabindex="-1"></a>Automatically generate documentation from your nanobricks:</span>
<span id="cb110-1915"><a href="#cb110-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1918"><a href="#cb110-1918" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1919"><a href="#cb110-1919" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-1920"><a href="#cb110-1920" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-1921"><a href="#cb110-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1922"><a href="#cb110-1922" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.docs <span class="im">import</span> DocumentationGenerator</span>
<span id="cb110-1923"><a href="#cb110-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1924"><a href="#cb110-1924" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate docs for your bricks</span></span>
<span id="cb110-1925"><a href="#cb110-1925" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> DocumentationGenerator(output_dir<span class="op">=</span><span class="st">"docs/api"</span>)</span>
<span id="cb110-1926"><a href="#cb110-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1927"><a href="#cb110-1927" aria-hidden="true" tabindex="-1"></a><span class="co"># Document individual bricks</span></span>
<span id="cb110-1928"><a href="#cb110-1928" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> my_bricks <span class="im">import</span> DataProcessor, Validator, Transformer</span>
<span id="cb110-1929"><a href="#cb110-1929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1930"><a href="#cb110-1930" aria-hidden="true" tabindex="-1"></a>generator.write_docs([DataProcessor, Validator, Transformer])</span>
<span id="cb110-1931"><a href="#cb110-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1932"><a href="#cb110-1932" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates:</span></span>
<span id="cb110-1933"><a href="#cb110-1933" aria-hidden="true" tabindex="-1"></a><span class="co"># docs/api/</span></span>
<span id="cb110-1934"><a href="#cb110-1934" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── index.md              # Overview with links</span></span>
<span id="cb110-1935"><a href="#cb110-1935" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── dataprocessor.md      # Full docs for DataProcessor</span></span>
<span id="cb110-1936"><a href="#cb110-1936" aria-hidden="true" tabindex="-1"></a><span class="co">#   ├── validator.md          # Full docs for Validator</span></span>
<span id="cb110-1937"><a href="#cb110-1937" aria-hidden="true" tabindex="-1"></a><span class="co">#   └── transformer.md        # Full docs for Transformer</span></span>
<span id="cb110-1938"><a href="#cb110-1938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1939"><a href="#cb110-1939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1940"><a href="#cb110-1940" aria-hidden="true" tabindex="-1"></a>Generated documentation includes:</span>
<span id="cb110-1941"><a href="#cb110-1941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1942"><a href="#cb110-1942" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Type signatures with input/output/dependencies</span>
<span id="cb110-1943"><a href="#cb110-1943" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Constructor parameters</span>
<span id="cb110-1944"><a href="#cb110-1944" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Method documentation</span>
<span id="cb110-1945"><a href="#cb110-1945" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Usage examples extracted from docstrings</span>
<span id="cb110-1946"><a href="#cb110-1946" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Supported skills</span>
<span id="cb110-1947"><a href="#cb110-1947" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Composition examples</span>
<span id="cb110-1948"><a href="#cb110-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1949"><a href="#cb110-1949" aria-hidden="true" tabindex="-1"></a>Example generated documentation:</span>
<span id="cb110-1950"><a href="#cb110-1950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1951"><a href="#cb110-1951" aria-hidden="true" tabindex="-1"></a><span class="in">```markdown</span></span>
<span id="cb110-1952"><a href="#cb110-1952" aria-hidden="true" tabindex="-1"></a><span class="fu"># DataProcessor</span></span>
<span id="cb110-1953"><a href="#cb110-1953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1954"><a href="#cb110-1954" aria-hidden="true" tabindex="-1"></a><span class="in">`my_bricks.DataProcessor`</span></span>
<span id="cb110-1955"><a href="#cb110-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1956"><a href="#cb110-1956" aria-hidden="true" tabindex="-1"></a>A brick that processes data with validation and transformation.</span>
<span id="cb110-1957"><a href="#cb110-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1958"><a href="#cb110-1958" aria-hidden="true" tabindex="-1"></a><span class="fu">## Type Signature</span></span>
<span id="cb110-1959"><a href="#cb110-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1960"><a href="#cb110-1960" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Input**: <span class="in">`dict`</span></span>
<span id="cb110-1961"><a href="#cb110-1961" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Output**: <span class="in">`dict`</span></span>
<span id="cb110-1962"><a href="#cb110-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dependencies**: <span class="in">`DatabaseConfig`</span></span>
<span id="cb110-1963"><a href="#cb110-1963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1964"><a href="#cb110-1964" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructor</span></span>
<span id="cb110-1965"><a href="#cb110-1965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1966"><a href="#cb110-1966" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb110-1967"><a href="#cb110-1967" aria-hidden="true" tabindex="-1"></a>DataProcessor(validate<span class="op">=</span><span class="va">True</span>, transform<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-1968"><a href="#cb110-1968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1969"><a href="#cb110-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1970"><a href="#cb110-1970" aria-hidden="true" tabindex="-1"></a>Initialize data processor with options...</span>
<span id="cb110-1971"><a href="#cb110-1971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1972"><a href="#cb110-1972" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examples</span></span>
<span id="cb110-1973"><a href="#cb110-1973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1974"><a href="#cb110-1974" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb110-1975"><a href="#cb110-1975" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> processor <span class="op">=</span> DataProcessor()</span>
<span id="cb110-1976"><a href="#cb110-1976" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> result <span class="op">=</span> <span class="cf">await</span> processor.invoke({<span class="st">"name"</span>: <span class="st">"Alice"</span>, <span class="st">"age"</span>: <span class="dv">30</span>})</span>
<span id="cb110-1977"><a href="#cb110-1977" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(result)</span>
<span id="cb110-1978"><a href="#cb110-1978" aria-hidden="true" tabindex="-1"></a>{<span class="st">"name"</span>: <span class="st">"ALICE"</span>, <span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"valid"</span>: <span class="va">True</span>}</span>
<span id="cb110-1979"><a href="#cb110-1979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1980"><a href="#cb110-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1981"><a href="#cb110-1981" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supported Skills</span></span>
<span id="cb110-1982"><a href="#cb110-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1983"><a href="#cb110-1983" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Skill Framework</span>
<span id="cb110-1984"><a href="#cb110-1984" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Logging</span>
<span id="cb110-1985"><a href="#cb110-1985" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>API</span>
<span id="cb110-1986"><a href="#cb110-1986" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Observability</span>
<span id="cb110-1987"><a href="#cb110-1987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-1988"><a href="#cb110-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1989"><a href="#cb110-1989" aria-hidden="true" tabindex="-1"></a><span class="in">### Developer Experience Tools</span></span>
<span id="cb110-1990"><a href="#cb110-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1991"><a href="#cb110-1991" aria-hidden="true" tabindex="-1"></a><span class="in">#### Pipeline Debugger</span></span>
<span id="cb110-1992"><a href="#cb110-1992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1993"><a href="#cb110-1993" aria-hidden="true" tabindex="-1"></a><span class="in">Debug your pipelines step-by-step:</span></span>
<span id="cb110-1994"><a href="#cb110-1994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-1997"><a href="#cb110-1997" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-1998"><a href="#cb110-1998" aria-hidden="true" tabindex="-1"></a><span class="in"># | eval: false</span></span>
<span id="cb110-1999"><a href="#cb110-1999" aria-hidden="true" tabindex="-1"></a><span class="in"># | echo: true</span></span>
<span id="cb110-2000"><a href="#cb110-2000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2001"><a href="#cb110-2001" aria-hidden="true" tabindex="-1"></a><span class="in">from nanobricks.devtools import BrickDebugger</span></span>
<span id="cb110-2002"><a href="#cb110-2002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2003"><a href="#cb110-2003" aria-hidden="true" tabindex="-1"></a><span class="in"># Create debugger</span></span>
<span id="cb110-2004"><a href="#cb110-2004" aria-hidden="true" tabindex="-1"></a><span class="in">debugger = BrickDebugger(</span></span>
<span id="cb110-2005"><a href="#cb110-2005" aria-hidden="true" tabindex="-1"></a><span class="in">    capture_input=True,</span></span>
<span id="cb110-2006"><a href="#cb110-2006" aria-hidden="true" tabindex="-1"></a><span class="in">    capture_output=True,</span></span>
<span id="cb110-2007"><a href="#cb110-2007" aria-hidden="true" tabindex="-1"></a><span class="in">    capture_errors=True,</span></span>
<span id="cb110-2008"><a href="#cb110-2008" aria-hidden="true" tabindex="-1"></a><span class="in">    save_to_file="debug.json"</span></span>
<span id="cb110-2009"><a href="#cb110-2009" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb110-2010"><a href="#cb110-2010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2011"><a href="#cb110-2011" aria-hidden="true" tabindex="-1"></a><span class="in"># Wrap bricks with debugging</span></span>
<span id="cb110-2012"><a href="#cb110-2012" aria-hidden="true" tabindex="-1"></a><span class="in">processor = debugger.wrap_brick(DataProcessor())</span></span>
<span id="cb110-2013"><a href="#cb110-2013" aria-hidden="true" tabindex="-1"></a><span class="in">validator = debugger.wrap_brick(Validator())</span></span>
<span id="cb110-2014"><a href="#cb110-2014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2015"><a href="#cb110-2015" aria-hidden="true" tabindex="-1"></a><span class="in"># Create debugged pipeline</span></span>
<span id="cb110-2016"><a href="#cb110-2016" aria-hidden="true" tabindex="-1"></a><span class="in">pipeline = processor | validator</span></span>
<span id="cb110-2017"><a href="#cb110-2017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2018"><a href="#cb110-2018" aria-hidden="true" tabindex="-1"></a><span class="in"># Run and see what happens</span></span>
<span id="cb110-2019"><a href="#cb110-2019" aria-hidden="true" tabindex="-1"></a><span class="in">result = await pipeline.invoke({"name": "Alice", "age": 30})</span></span>
<span id="cb110-2020"><a href="#cb110-2020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2021"><a href="#cb110-2021" aria-hidden="true" tabindex="-1"></a><span class="in"># Print execution trace</span></span>
<span id="cb110-2022"><a href="#cb110-2022" aria-hidden="true" tabindex="-1"></a><span class="in">debugger.print_trace()</span></span>
<span id="cb110-2023"><a href="#cb110-2023" aria-hidden="true" tabindex="-1"></a><span class="in"># Output:</span></span>
<span id="cb110-2024"><a href="#cb110-2024" aria-hidden="true" tabindex="-1"></a><span class="in"># 📊 Execution Trace:</span></span>
<span id="cb110-2025"><a href="#cb110-2025" aria-hidden="true" tabindex="-1"></a><span class="in"># ============================================================</span></span>
<span id="cb110-2026"><a href="#cb110-2026" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb110-2027"><a href="#cb110-2027" aria-hidden="true" tabindex="-1"></a><span class="in"># [14:32:15.123] ▶️  DataProcessor</span></span>
<span id="cb110-2028"><a href="#cb110-2028" aria-hidden="true" tabindex="-1"></a><span class="in">#     Input: {'name': 'Alice', 'age': 30}</span></span>
<span id="cb110-2029"><a href="#cb110-2029" aria-hidden="true" tabindex="-1"></a><span class="in"># [14:32:15.234] ✅ DataProcessor (111.00ms)</span></span>
<span id="cb110-2030"><a href="#cb110-2030" aria-hidden="true" tabindex="-1"></a><span class="in">#     Output: {'name': 'ALICE', 'age': 30, 'processed': True}</span></span>
<span id="cb110-2031"><a href="#cb110-2031" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb110-2032"><a href="#cb110-2032" aria-hidden="true" tabindex="-1"></a><span class="in"># [14:32:15.235] ▶️  Validator</span></span>
<span id="cb110-2033"><a href="#cb110-2033" aria-hidden="true" tabindex="-1"></a><span class="in">#     Input: {'name': 'ALICE', 'age': 30, 'processed': True}</span></span>
<span id="cb110-2034"><a href="#cb110-2034" aria-hidden="true" tabindex="-1"></a><span class="in"># [14:32:15.267] ✅ Validator (32.00ms)</span></span>
<span id="cb110-2035"><a href="#cb110-2035" aria-hidden="true" tabindex="-1"></a><span class="in">#     Output: {'name': 'ALICE', 'age': 30, 'processed': True, 'valid': True}</span></span>
<span id="cb110-2036"><a href="#cb110-2036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2037"><a href="#cb110-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2038"><a href="#cb110-2038" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Performance Profiler</span></span>
<span id="cb110-2039"><a href="#cb110-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2040"><a href="#cb110-2040" aria-hidden="true" tabindex="-1"></a>Profile your bricks to find bottlenecks:</span>
<span id="cb110-2041"><a href="#cb110-2041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2044"><a href="#cb110-2044" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2045"><a href="#cb110-2045" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2046"><a href="#cb110-2046" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2047"><a href="#cb110-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2048"><a href="#cb110-2048" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.devtools <span class="im">import</span> BrickProfiler, profile_brick</span>
<span id="cb110-2049"><a href="#cb110-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2050"><a href="#cb110-2050" aria-hidden="true" tabindex="-1"></a><span class="co"># Create profiler</span></span>
<span id="cb110-2051"><a href="#cb110-2051" aria-hidden="true" tabindex="-1"></a>profiler <span class="op">=</span> BrickProfiler(measure_memory<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-2052"><a href="#cb110-2052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2053"><a href="#cb110-2053" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile a pipeline</span></span>
<span id="cb110-2054"><a href="#cb110-2054" aria-hidden="true" tabindex="-1"></a>slow_brick <span class="op">=</span> profiler.wrap_brick(SlowProcessor())</span>
<span id="cb110-2055"><a href="#cb110-2055" aria-hidden="true" tabindex="-1"></a>fast_brick <span class="op">=</span> profiler.wrap_brick(FastValidator())</span>
<span id="cb110-2056"><a href="#cb110-2056" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> slow_brick <span class="op">|</span> fast_brick</span>
<span id="cb110-2057"><a href="#cb110-2057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2058"><a href="#cb110-2058" aria-hidden="true" tabindex="-1"></a><span class="co"># Run multiple times</span></span>
<span id="cb110-2059"><a href="#cb110-2059" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb110-2060"><a href="#cb110-2060" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> pipeline.invoke(<span class="ss">f"data_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2061"><a href="#cb110-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2062"><a href="#cb110-2062" aria-hidden="true" tabindex="-1"></a><span class="co"># Print performance stats</span></span>
<span id="cb110-2063"><a href="#cb110-2063" aria-hidden="true" tabindex="-1"></a>profiler.print_stats()</span>
<span id="cb110-2064"><a href="#cb110-2064" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb110-2065"><a href="#cb110-2065" aria-hidden="true" tabindex="-1"></a><span class="co"># ⏱️  Performance Profile:</span></span>
<span id="cb110-2066"><a href="#cb110-2066" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================================================================</span></span>
<span id="cb110-2067"><a href="#cb110-2067" aria-hidden="true" tabindex="-1"></a><span class="co"># Brick                          Calls   Total(ms)    Avg(ms)    Min(ms)    Max(ms)</span></span>
<span id="cb110-2068"><a href="#cb110-2068" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------------------</span></span>
<span id="cb110-2069"><a href="#cb110-2069" aria-hidden="true" tabindex="-1"></a><span class="co"># SlowProcessor                    100     8543.21      85.43      82.10      95.33</span></span>
<span id="cb110-2070"><a href="#cb110-2070" aria-hidden="true" tabindex="-1"></a><span class="co"># FastValidator                    100      234.56       2.35       2.01       3.44</span></span>
<span id="cb110-2071"><a href="#cb110-2071" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb110-2072"><a href="#cb110-2072" aria-hidden="true" tabindex="-1"></a><span class="co"># 💾 Memory Usage:</span></span>
<span id="cb110-2073"><a href="#cb110-2073" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------------------</span></span>
<span id="cb110-2074"><a href="#cb110-2074" aria-hidden="true" tabindex="-1"></a><span class="co"># SlowProcessor                  Delta:   +12.34 MB</span></span>
<span id="cb110-2075"><a href="#cb110-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2076"><a href="#cb110-2076" aria-hidden="true" tabindex="-1"></a><span class="co"># Find bottlenecks</span></span>
<span id="cb110-2077"><a href="#cb110-2077" aria-hidden="true" tabindex="-1"></a>bottlenecks <span class="op">=</span> profiler.get_bottlenecks(threshold_pct<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb110-2078"><a href="#cb110-2078" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bottlenecks: </span><span class="sc">{</span>bottlenecks<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># ['SlowProcessor']</span></span>
<span id="cb110-2079"><a href="#cb110-2079" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2080"><a href="#cb110-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2081"><a href="#cb110-2081" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pipeline Visualizer</span></span>
<span id="cb110-2082"><a href="#cb110-2082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2083"><a href="#cb110-2083" aria-hidden="true" tabindex="-1"></a>Visualize your pipeline structure:</span>
<span id="cb110-2084"><a href="#cb110-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2087"><a href="#cb110-2087" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2088"><a href="#cb110-2088" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2089"><a href="#cb110-2089" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2090"><a href="#cb110-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2091"><a href="#cb110-2091" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.devtools <span class="im">import</span> visualize_pipeline</span>
<span id="cb110-2092"><a href="#cb110-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2093"><a href="#cb110-2093" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complex pipeline</span></span>
<span id="cb110-2094"><a href="#cb110-2094" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> DataLoader()</span>
<span id="cb110-2095"><a href="#cb110-2095" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessor()</span>
<span id="cb110-2096"><a href="#cb110-2096" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> Validator()</span>
<span id="cb110-2097"><a href="#cb110-2097" aria-hidden="true" tabindex="-1"></a>saver <span class="op">=</span> DataSaver()</span>
<span id="cb110-2098"><a href="#cb110-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2099"><a href="#cb110-2099" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> loader <span class="op">|</span> processor <span class="op">|</span> validator <span class="op">|</span> saver</span>
<span id="cb110-2100"><a href="#cb110-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2101"><a href="#cb110-2101" aria-hidden="true" tabindex="-1"></a><span class="co"># ASCII visualization</span></span>
<span id="cb110-2102"><a href="#cb110-2102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visualize_pipeline(pipeline))</span>
<span id="cb110-2103"><a href="#cb110-2103" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb110-2104"><a href="#cb110-2104" aria-hidden="true" tabindex="-1"></a><span class="co"># Pipeline Flow:</span></span>
<span id="cb110-2105"><a href="#cb110-2105" aria-hidden="true" tabindex="-1"></a><span class="co"># ==================================================</span></span>
<span id="cb110-2106"><a href="#cb110-2106" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb110-2107"><a href="#cb110-2107" aria-hidden="true" tabindex="-1"></a><span class="co">#      INPUT</span></span>
<span id="cb110-2108"><a href="#cb110-2108" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb110-2109"><a href="#cb110-2109" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb110-2110"><a href="#cb110-2110" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb110-2111"><a href="#cb110-2111" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataLoader      │</span></span>
<span id="cb110-2112"><a href="#cb110-2112" aria-hidden="true" tabindex="-1"></a><span class="co"># │     DataLoader       │</span></span>
<span id="cb110-2113"><a href="#cb110-2113" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb110-2114"><a href="#cb110-2114" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb110-2115"><a href="#cb110-2115" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb110-2116"><a href="#cb110-2116" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb110-2117"><a href="#cb110-2117" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb110-2118"><a href="#cb110-2118" aria-hidden="true" tabindex="-1"></a><span class="co"># │    DataProcessor     │</span></span>
<span id="cb110-2119"><a href="#cb110-2119" aria-hidden="true" tabindex="-1"></a><span class="co"># │    DataProcessor     │</span></span>
<span id="cb110-2120"><a href="#cb110-2120" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb110-2121"><a href="#cb110-2121" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb110-2122"><a href="#cb110-2122" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb110-2123"><a href="#cb110-2123" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb110-2124"><a href="#cb110-2124" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb110-2125"><a href="#cb110-2125" aria-hidden="true" tabindex="-1"></a><span class="co"># │      Validator       │</span></span>
<span id="cb110-2126"><a href="#cb110-2126" aria-hidden="true" tabindex="-1"></a><span class="co"># │      Validator       │</span></span>
<span id="cb110-2127"><a href="#cb110-2127" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb110-2128"><a href="#cb110-2128" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb110-2129"><a href="#cb110-2129" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb110-2130"><a href="#cb110-2130" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb110-2131"><a href="#cb110-2131" aria-hidden="true" tabindex="-1"></a><span class="co"># ┌──────────────────────┐</span></span>
<span id="cb110-2132"><a href="#cb110-2132" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataSaver       │</span></span>
<span id="cb110-2133"><a href="#cb110-2133" aria-hidden="true" tabindex="-1"></a><span class="co"># │      DataSaver       │</span></span>
<span id="cb110-2134"><a href="#cb110-2134" aria-hidden="true" tabindex="-1"></a><span class="co"># │       v1.0.0         │</span></span>
<span id="cb110-2135"><a href="#cb110-2135" aria-hidden="true" tabindex="-1"></a><span class="co"># └──────────────────────┘</span></span>
<span id="cb110-2136"><a href="#cb110-2136" aria-hidden="true" tabindex="-1"></a><span class="co">#        │</span></span>
<span id="cb110-2137"><a href="#cb110-2137" aria-hidden="true" tabindex="-1"></a><span class="co">#        ▼</span></span>
<span id="cb110-2138"><a href="#cb110-2138" aria-hidden="true" tabindex="-1"></a><span class="co">#      OUTPUT</span></span>
<span id="cb110-2139"><a href="#cb110-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2140"><a href="#cb110-2140" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Mermaid diagram</span></span>
<span id="cb110-2141"><a href="#cb110-2141" aria-hidden="true" tabindex="-1"></a>mermaid <span class="op">=</span> visualize_pipeline(pipeline, style<span class="op">=</span><span class="st">"mermaid"</span>, save_to<span class="op">=</span><span class="st">"pipeline.mmd"</span>)</span>
<span id="cb110-2142"><a href="#cb110-2142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2143"><a href="#cb110-2143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2144"><a href="#cb110-2144" aria-hidden="true" tabindex="-1"></a><span class="fu">## AI Integration</span></span>
<span id="cb110-2145"><a href="#cb110-2145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2146"><a href="#cb110-2146" aria-hidden="true" tabindex="-1"></a><span class="fu">### AI Reasoning Skill</span></span>
<span id="cb110-2147"><a href="#cb110-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2148"><a href="#cb110-2148" aria-hidden="true" tabindex="-1"></a>Enhance your nanobricks with AI-powered intelligence:</span>
<span id="cb110-2149"><a href="#cb110-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2152"><a href="#cb110-2152" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2153"><a href="#cb110-2153" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2154"><a href="#cb110-2154" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2155"><a href="#cb110-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2156"><a href="#cb110-2156" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills <span class="im">import</span> create_ai_skill</span>
<span id="cb110-2157"><a href="#cb110-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2158"><a href="#cb110-2158" aria-hidden="true" tabindex="-1"></a><span class="co"># Create AI skill with cost controls</span></span>
<span id="cb110-2159"><a href="#cb110-2159" aria-hidden="true" tabindex="-1"></a>ai_skill <span class="op">=</span> create_ai_skill(</span>
<span id="cb110-2160"><a href="#cb110-2160" aria-hidden="true" tabindex="-1"></a>    max_cost_per_invoke<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># $0.05 limit per call</span></span>
<span id="cb110-2161"><a href="#cb110-2161" aria-hidden="true" tabindex="-1"></a>    enable_reasoning_trace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2162"><a href="#cb110-2162" aria-hidden="true" tabindex="-1"></a>    enable_memory<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2163"><a href="#cb110-2163" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2164"><a href="#cb110-2164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2165"><a href="#cb110-2165" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhance any brick with AI</span></span>
<span id="cb110-2166"><a href="#cb110-2166" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> DataValidator()</span>
<span id="cb110-2167"><a href="#cb110-2167" aria-hidden="true" tabindex="-1"></a>ai_validator <span class="op">=</span> validator.with_skill(ai_skill)</span>
<span id="cb110-2168"><a href="#cb110-2168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2169"><a href="#cb110-2169" aria-hidden="true" tabindex="-1"></a><span class="co"># The AI will:</span></span>
<span id="cb110-2170"><a href="#cb110-2170" aria-hidden="true" tabindex="-1"></a><span class="co"># - Understand complex validation rules from context</span></span>
<span id="cb110-2171"><a href="#cb110-2171" aria-hidden="true" tabindex="-1"></a><span class="co"># - Learn from past validations</span></span>
<span id="cb110-2172"><a href="#cb110-2172" aria-hidden="true" tabindex="-1"></a><span class="co"># - Provide intelligent error recovery</span></span>
<span id="cb110-2173"><a href="#cb110-2173" aria-hidden="true" tabindex="-1"></a><span class="co"># - Track costs to prevent overruns</span></span>
<span id="cb110-2174"><a href="#cb110-2174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2175"><a href="#cb110-2175" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> ai_validator.invoke(complex_data)</span>
<span id="cb110-2176"><a href="#cb110-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2177"><a href="#cb110-2177" aria-hidden="true" tabindex="-1"></a><span class="co"># Check AI reasoning</span></span>
<span id="cb110-2178"><a href="#cb110-2178" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">hasattr</span>(ai_validator, <span class="st">'get_reasoning_trace'</span>):</span>
<span id="cb110-2179"><a href="#cb110-2179" aria-hidden="true" tabindex="-1"></a>    trace <span class="op">=</span> ai_validator.get_reasoning_trace()</span>
<span id="cb110-2180"><a href="#cb110-2180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> trace:</span>
<span id="cb110-2181"><a href="#cb110-2181" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>step<span class="sc">.</span>timestamp<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>step<span class="sc">.</span>thought<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2182"><a href="#cb110-2182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2183"><a href="#cb110-2183" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor costs</span></span>
<span id="cb110-2184"><a href="#cb110-2184" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AI costs: </span><span class="sc">{</span>ai_skill<span class="sc">.</span>get_cost_report()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2185"><a href="#cb110-2185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2186"><a href="#cb110-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2187"><a href="#cb110-2187" aria-hidden="true" tabindex="-1"></a><span class="fu">### MCP Server Integration</span></span>
<span id="cb110-2188"><a href="#cb110-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2189"><a href="#cb110-2189" aria-hidden="true" tabindex="-1"></a>Expose your nanobricks as tools for LLMs via Model Context Protocol:</span>
<span id="cb110-2190"><a href="#cb110-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2193"><a href="#cb110-2193" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2194"><a href="#cb110-2194" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2195"><a href="#cb110-2195" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2196"><a href="#cb110-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2197"><a href="#cb110-2197" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.skills <span class="im">import</span> create_mcp_server, MCPToolConfig</span>
<span id="cb110-2198"><a href="#cb110-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2199"><a href="#cb110-2199" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure tool exposure</span></span>
<span id="cb110-2200"><a href="#cb110-2200" aria-hidden="true" tabindex="-1"></a>summarizer <span class="op">=</span> TextSummarizer()</span>
<span id="cb110-2201"><a href="#cb110-2201" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> DataAnalyzer()</span>
<span id="cb110-2202"><a href="#cb110-2202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2203"><a href="#cb110-2203" aria-hidden="true" tabindex="-1"></a><span class="co"># Create MCP server</span></span>
<span id="cb110-2204"><a href="#cb110-2204" aria-hidden="true" tabindex="-1"></a>mcp_server <span class="op">=</span> create_mcp_server(</span>
<span id="cb110-2205"><a href="#cb110-2205" aria-hidden="true" tabindex="-1"></a>    bricks<span class="op">=</span>[summarizer, analyzer],</span>
<span id="cb110-2206"><a href="#cb110-2206" aria-hidden="true" tabindex="-1"></a>    server_name<span class="op">=</span><span class="st">"my-tools"</span>,</span>
<span id="cb110-2207"><a href="#cb110-2207" aria-hidden="true" tabindex="-1"></a>    configs<span class="op">=</span>{</span>
<span id="cb110-2208"><a href="#cb110-2208" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TextSummarizer"</span>: MCPToolConfig(</span>
<span id="cb110-2209"><a href="#cb110-2209" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"summarize"</span>,</span>
<span id="cb110-2210"><a href="#cb110-2210" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Summarizes text intelligently"</span>,</span>
<span id="cb110-2211"><a href="#cb110-2211" aria-hidden="true" tabindex="-1"></a>            example_inputs<span class="op">=</span>[{<span class="st">"text"</span>: <span class="st">"Long article..."</span>}],</span>
<span id="cb110-2212"><a href="#cb110-2212" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb110-2213"><a href="#cb110-2213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-2214"><a href="#cb110-2214" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2215"><a href="#cb110-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2216"><a href="#cb110-2216" aria-hidden="true" tabindex="-1"></a><span class="co"># Run server for LLM access</span></span>
<span id="cb110-2217"><a href="#cb110-2217" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> mcp_server.run_server()</span>
<span id="cb110-2218"><a href="#cb110-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2219"><a href="#cb110-2219" aria-hidden="true" tabindex="-1"></a><span class="co"># Your LLM can now use these tools!</span></span>
<span id="cb110-2220"><a href="#cb110-2220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2221"><a href="#cb110-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2222"><a href="#cb110-2222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agent Communication</span></span>
<span id="cb110-2223"><a href="#cb110-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2224"><a href="#cb110-2224" aria-hidden="true" tabindex="-1"></a>Build multi-agent systems with nanobricks:</span>
<span id="cb110-2225"><a href="#cb110-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2228"><a href="#cb110-2228" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2229"><a href="#cb110-2229" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2230"><a href="#cb110-2230" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2231"><a href="#cb110-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2232"><a href="#cb110-2232" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.agent <span class="im">import</span> create_agent</span>
<span id="cb110-2233"><a href="#cb110-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2234"><a href="#cb110-2234" aria-hidden="true" tabindex="-1"></a><span class="co"># Create agents from bricks</span></span>
<span id="cb110-2235"><a href="#cb110-2235" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> create_agent(DataProcessor(), name<span class="op">=</span><span class="st">"Processor Agent"</span>)</span>
<span id="cb110-2236"><a href="#cb110-2236" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> create_agent(DataValidator(), name<span class="op">=</span><span class="st">"Validator Agent"</span>) </span>
<span id="cb110-2237"><a href="#cb110-2237" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> create_agent(DataAnalyzer(), name<span class="op">=</span><span class="st">"Analyzer Agent"</span>)</span>
<span id="cb110-2238"><a href="#cb110-2238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2239"><a href="#cb110-2239" aria-hidden="true" tabindex="-1"></a><span class="co"># Agents can discover each other</span></span>
<span id="cb110-2240"><a href="#cb110-2240" aria-hidden="true" tabindex="-1"></a>discovered <span class="op">=</span> <span class="cf">await</span> processor.discover_agents(capability<span class="op">=</span><span class="st">"validation"</span>)</span>
<span id="cb110-2241"><a href="#cb110-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2242"><a href="#cb110-2242" aria-hidden="true" tabindex="-1"></a><span class="co"># Send messages between agents</span></span>
<span id="cb110-2243"><a href="#cb110-2243" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> processor.send_message(</span>
<span id="cb110-2244"><a href="#cb110-2244" aria-hidden="true" tabindex="-1"></a>    to_agent<span class="op">=</span>validator.<span class="bu">id</span>,</span>
<span id="cb110-2245"><a href="#cb110-2245" aria-hidden="true" tabindex="-1"></a>    message_type<span class="op">=</span>MessageType.REQUEST,</span>
<span id="cb110-2246"><a href="#cb110-2246" aria-hidden="true" tabindex="-1"></a>    content<span class="op">=</span>{<span class="st">"validate"</span>: data}</span>
<span id="cb110-2247"><a href="#cb110-2247" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2248"><a href="#cb110-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2249"><a href="#cb110-2249" aria-hidden="true" tabindex="-1"></a><span class="co"># Request processing from another agent</span></span>
<span id="cb110-2250"><a href="#cb110-2250" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> processor.request_processing(</span>
<span id="cb110-2251"><a href="#cb110-2251" aria-hidden="true" tabindex="-1"></a>    target_agent<span class="op">=</span>analyzer.<span class="bu">id</span>,</span>
<span id="cb110-2252"><a href="#cb110-2252" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span><span class="op">=</span>processed_data,</span>
<span id="cb110-2253"><a href="#cb110-2253" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="fl">30.0</span></span>
<span id="cb110-2254"><a href="#cb110-2254" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2255"><a href="#cb110-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2256"><a href="#cb110-2256" aria-hidden="true" tabindex="-1"></a><span class="co"># Broadcast to all agents</span></span>
<span id="cb110-2257"><a href="#cb110-2257" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> processor.broadcast(</span>
<span id="cb110-2258"><a href="#cb110-2258" aria-hidden="true" tabindex="-1"></a>    MessageType.ANNOUNCE,</span>
<span id="cb110-2259"><a href="#cb110-2259" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"status"</span>: <span class="st">"processing complete"</span>}</span>
<span id="cb110-2260"><a href="#cb110-2260" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2261"><a href="#cb110-2261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2262"><a href="#cb110-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2263"><a href="#cb110-2263" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adaptive Behavior</span></span>
<span id="cb110-2264"><a href="#cb110-2264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2265"><a href="#cb110-2265" aria-hidden="true" tabindex="-1"></a>Create self-tuning nanobricks that learn and adapt:</span>
<span id="cb110-2266"><a href="#cb110-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2269"><a href="#cb110-2269" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2270"><a href="#cb110-2270" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2271"><a href="#cb110-2271" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2272"><a href="#cb110-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2273"><a href="#cb110-2273" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.adaptive <span class="im">import</span> create_adaptive_brick</span>
<span id="cb110-2274"><a href="#cb110-2274" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.adaptive.policies <span class="im">import</span> ThresholdPolicy, MLPolicy</span>
<span id="cb110-2275"><a href="#cb110-2275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2276"><a href="#cb110-2276" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple threshold-based adaptation</span></span>
<span id="cb110-2277"><a href="#cb110-2277" aria-hidden="true" tabindex="-1"></a>policy <span class="op">=</span> ThresholdPolicy(</span>
<span id="cb110-2278"><a href="#cb110-2278" aria-hidden="true" tabindex="-1"></a>    latency_threshold_ms<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb110-2279"><a href="#cb110-2279" aria-hidden="true" tabindex="-1"></a>    error_rate_threshold<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb110-2280"><a href="#cb110-2280" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2281"><a href="#cb110-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2282"><a href="#cb110-2282" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> DataProcessor()</span>
<span id="cb110-2283"><a href="#cb110-2283" aria-hidden="true" tabindex="-1"></a>adaptive_processor <span class="op">=</span> create_adaptive_brick(processor, policy)</span>
<span id="cb110-2284"><a href="#cb110-2284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2285"><a href="#cb110-2285" aria-hidden="true" tabindex="-1"></a><span class="co"># The brick will automatically:</span></span>
<span id="cb110-2286"><a href="#cb110-2286" aria-hidden="true" tabindex="-1"></a><span class="co"># - Monitor performance metrics</span></span>
<span id="cb110-2287"><a href="#cb110-2287" aria-hidden="true" tabindex="-1"></a><span class="co"># - Detect when thresholds are exceeded</span></span>
<span id="cb110-2288"><a href="#cb110-2288" aria-hidden="true" tabindex="-1"></a><span class="co"># - Adjust parameters (batch size, concurrency, etc.)</span></span>
<span id="cb110-2289"><a href="#cb110-2289" aria-hidden="true" tabindex="-1"></a><span class="co"># - Retry with different strategies on errors</span></span>
<span id="cb110-2290"><a href="#cb110-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2291"><a href="#cb110-2291" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ML-based adaptation for complex scenarios</span></span>
<span id="cb110-2292"><a href="#cb110-2292" aria-hidden="true" tabindex="-1"></a>ml_policy <span class="op">=</span> MLPolicy(model_path<span class="op">=</span><span class="st">"adaptation_model.pkl"</span>)</span>
<span id="cb110-2293"><a href="#cb110-2293" aria-hidden="true" tabindex="-1"></a>smart_processor <span class="op">=</span> create_adaptive_brick(processor, ml_policy)</span>
<span id="cb110-2294"><a href="#cb110-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2295"><a href="#cb110-2295" aria-hidden="true" tabindex="-1"></a><span class="co"># Check adaptation status</span></span>
<span id="cb110-2296"><a href="#cb110-2296" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> adaptive_processor.get_metrics_summary()</span>
<span id="cb110-2297"><a href="#cb110-2297" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Success rate: </span><span class="sc">{</span>metrics[<span class="st">'success_rate'</span>]<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb110-2298"><a href="#cb110-2298" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Current adaptations: </span><span class="sc">{</span>metrics[<span class="st">'current_adaptations'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2299"><a href="#cb110-2299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2300"><a href="#cb110-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2301"><a href="#cb110-2301" aria-hidden="true" tabindex="-1"></a><span class="fu">### AI-Powered Examples</span></span>
<span id="cb110-2302"><a href="#cb110-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2303"><a href="#cb110-2303" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Intelligent Validator</span></span>
<span id="cb110-2304"><a href="#cb110-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2307"><a href="#cb110-2307" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2308"><a href="#cb110-2308" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2309"><a href="#cb110-2309" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2310"><a href="#cb110-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2311"><a href="#cb110-2311" aria-hidden="true" tabindex="-1"></a><span class="co"># A validator that understands context</span></span>
<span id="cb110-2312"><a href="#cb110-2312" aria-hidden="true" tabindex="-1"></a>validator <span class="op">=</span> IntelligentValidator(</span>
<span id="cb110-2313"><a href="#cb110-2313" aria-hidden="true" tabindex="-1"></a>    context<span class="op">=</span><span class="st">"user registration with email and phone"</span></span>
<span id="cb110-2314"><a href="#cb110-2314" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2315"><a href="#cb110-2315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2316"><a href="#cb110-2316" aria-hidden="true" tabindex="-1"></a><span class="co"># Add AI for smarter validation</span></span>
<span id="cb110-2317"><a href="#cb110-2317" aria-hidden="true" tabindex="-1"></a>ai_validator <span class="op">=</span> validator.with_skill(create_ai_skill())</span>
<span id="cb110-2318"><a href="#cb110-2318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2319"><a href="#cb110-2319" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> ai_validator.invoke({</span>
<span id="cb110-2320"><a href="#cb110-2320" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>: <span class="st">""</span>,</span>
<span id="cb110-2321"><a href="#cb110-2321" aria-hidden="true" tabindex="-1"></a>    <span class="st">"email"</span>: <span class="st">"invalid-email"</span>,</span>
<span id="cb110-2322"><a href="#cb110-2322" aria-hidden="true" tabindex="-1"></a>    <span class="st">"phone"</span>: <span class="st">"555"</span></span>
<span id="cb110-2323"><a href="#cb110-2323" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb110-2324"><a href="#cb110-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2325"><a href="#cb110-2325" aria-hidden="true" tabindex="-1"></a><span class="co"># AI provides intelligent feedback:</span></span>
<span id="cb110-2326"><a href="#cb110-2326" aria-hidden="true" tabindex="-1"></a><span class="co"># - Errors: ["Invalid email format"]</span></span>
<span id="cb110-2327"><a href="#cb110-2327" aria-hidden="true" tabindex="-1"></a><span class="co"># - Warnings: ["Name is empty", "Phone too short"]  </span></span>
<span id="cb110-2328"><a href="#cb110-2328" aria-hidden="true" tabindex="-1"></a><span class="co"># - Suggestions: ["Use format: name@domain.com", "Include country code"]</span></span>
<span id="cb110-2329"><a href="#cb110-2329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2330"><a href="#cb110-2330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2331"><a href="#cb110-2331" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Conversational Pipeline Assistant</span></span>
<span id="cb110-2332"><a href="#cb110-2332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2335"><a href="#cb110-2335" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2336"><a href="#cb110-2336" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb110-2337"><a href="#cb110-2337" aria-hidden="true" tabindex="-1"></a><span class="co"># | echo: true</span></span>
<span id="cb110-2338"><a href="#cb110-2338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2339"><a href="#cb110-2339" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a conversational assistant for your pipeline</span></span>
<span id="cb110-2340"><a href="#cb110-2340" aria-hidden="true" tabindex="-1"></a>assistant <span class="op">=</span> ConversationalBrick(</span>
<span id="cb110-2341"><a href="#cb110-2341" aria-hidden="true" tabindex="-1"></a>    system_prompt<span class="op">=</span><span class="st">"Help users debug data pipelines"</span></span>
<span id="cb110-2342"><a href="#cb110-2342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2343"><a href="#cb110-2343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2344"><a href="#cb110-2344" aria-hidden="true" tabindex="-1"></a><span class="co"># Use in your pipeline for interactive debugging</span></span>
<span id="cb110-2345"><a href="#cb110-2345" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> DataLoader() <span class="op">|</span> processor <span class="op">|</span> assistant <span class="op">|</span> validator</span>
<span id="cb110-2346"><a href="#cb110-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2347"><a href="#cb110-2347" aria-hidden="true" tabindex="-1"></a><span class="co"># The assistant can:</span></span>
<span id="cb110-2348"><a href="#cb110-2348" aria-hidden="true" tabindex="-1"></a><span class="co"># - Answer questions about the pipeline</span></span>
<span id="cb110-2349"><a href="#cb110-2349" aria-hidden="true" tabindex="-1"></a><span class="co"># - Explain errors in plain language</span></span>
<span id="cb110-2350"><a href="#cb110-2350" aria-hidden="true" tabindex="-1"></a><span class="co"># - Suggest optimizations</span></span>
<span id="cb110-2351"><a href="#cb110-2351" aria-hidden="true" tabindex="-1"></a><span class="co"># - Guide users through debugging</span></span>
<span id="cb110-2352"><a href="#cb110-2352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2353"><a href="#cb110-2353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2354"><a href="#cb110-2354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Security Features</span></span>
<span id="cb110-2355"><a href="#cb110-2355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2356"><a href="#cb110-2356" aria-hidden="true" tabindex="-1"></a>Protect your nanobricks with comprehensive security measures:</span>
<span id="cb110-2357"><a href="#cb110-2357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2358"><a href="#cb110-2358" aria-hidden="true" tabindex="-1"></a><span class="fu">### Input Sanitization</span></span>
<span id="cb110-2359"><a href="#cb110-2359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2360"><a href="#cb110-2360" aria-hidden="true" tabindex="-1"></a>Prevent injection attacks with automatic sanitization:</span>
<span id="cb110-2361"><a href="#cb110-2361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2364"><a href="#cb110-2364" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2365"><a href="#cb110-2365" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2366"><a href="#cb110-2366" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2367"><a href="#cb110-2367" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2368"><a href="#cb110-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2369"><a href="#cb110-2369" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> InputSanitizer</span>
<span id="cb110-2370"><a href="#cb110-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2371"><a href="#cb110-2371" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect against XSS and SQL injection</span></span>
<span id="cb110-2372"><a href="#cb110-2372" aria-hidden="true" tabindex="-1"></a>sanitizer <span class="op">=</span> InputSanitizer(</span>
<span id="cb110-2373"><a href="#cb110-2373" aria-hidden="true" tabindex="-1"></a>    UserService(),</span>
<span id="cb110-2374"><a href="#cb110-2374" aria-hidden="true" tabindex="-1"></a>    html_escape<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2375"><a href="#cb110-2375" aria-hidden="true" tabindex="-1"></a>    sql_escape<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2376"><a href="#cb110-2376" aria-hidden="true" tabindex="-1"></a>    max_length<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb110-2377"><a href="#cb110-2377" aria-hidden="true" tabindex="-1"></a>    allowed_chars<span class="op">=</span><span class="st">"a-zA-Z0-9 .-_"</span>,</span>
<span id="cb110-2378"><a href="#cb110-2378" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2379"><a href="#cb110-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2380"><a href="#cb110-2380" aria-hidden="true" tabindex="-1"></a><span class="co"># Malicious input gets sanitized</span></span>
<span id="cb110-2381"><a href="#cb110-2381" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> sanitizer.invoke(<span class="st">'&lt;script&gt;alert("xss")&lt;/script&gt;'</span>)</span>
<span id="cb110-2382"><a href="#cb110-2382" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: '&amp;lt;script&amp;gt;alert(&amp;quot;xss&amp;quot;)&amp;lt;/script&amp;gt;'</span></span>
<span id="cb110-2383"><a href="#cb110-2383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2384"><a href="#cb110-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2385"><a href="#cb110-2385" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rate Limiting</span></span>
<span id="cb110-2386"><a href="#cb110-2386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2387"><a href="#cb110-2387" aria-hidden="true" tabindex="-1"></a>Prevent abuse with configurable rate limits:</span>
<span id="cb110-2388"><a href="#cb110-2388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2391"><a href="#cb110-2391" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2392"><a href="#cb110-2392" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2393"><a href="#cb110-2393" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2394"><a href="#cb110-2394" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2395"><a href="#cb110-2395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2396"><a href="#cb110-2396" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> RateLimiter</span>
<span id="cb110-2397"><a href="#cb110-2397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2398"><a href="#cb110-2398" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit requests per user</span></span>
<span id="cb110-2399"><a href="#cb110-2399" aria-hidden="true" tabindex="-1"></a>limiter <span class="op">=</span> RateLimiter(</span>
<span id="cb110-2400"><a href="#cb110-2400" aria-hidden="true" tabindex="-1"></a>    ApiService(),</span>
<span id="cb110-2401"><a href="#cb110-2401" aria-hidden="true" tabindex="-1"></a>    max_requests<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb110-2402"><a href="#cb110-2402" aria-hidden="true" tabindex="-1"></a>    window_seconds<span class="op">=</span><span class="dv">60</span>,</span>
<span id="cb110-2403"><a href="#cb110-2403" aria-hidden="true" tabindex="-1"></a>    burst_size<span class="op">=</span><span class="dv">10</span>,  <span class="co"># Max burst within short period</span></span>
<span id="cb110-2404"><a href="#cb110-2404" aria-hidden="true" tabindex="-1"></a>    key_func<span class="op">=</span><span class="kw">lambda</span> <span class="bu">input</span>, deps: deps[<span class="st">"user_id"</span>],</span>
<span id="cb110-2405"><a href="#cb110-2405" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2406"><a href="#cb110-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2407"><a href="#cb110-2407" aria-hidden="true" tabindex="-1"></a><span class="co"># Exceeding limits raises an error</span></span>
<span id="cb110-2408"><a href="#cb110-2408" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-2409"><a href="#cb110-2409" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> limiter.invoke(request, deps<span class="op">=</span>{<span class="st">"user_id"</span>: <span class="st">"alice"</span>})</span>
<span id="cb110-2410"><a href="#cb110-2410" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb110-2411"><a href="#cb110-2411" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Rate limited: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2412"><a href="#cb110-2412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2413"><a href="#cb110-2413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2414"><a href="#cb110-2414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Permission-Based Access Control</span></span>
<span id="cb110-2415"><a href="#cb110-2415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2416"><a href="#cb110-2416" aria-hidden="true" tabindex="-1"></a>Fine-grained permissions and role-based access:</span>
<span id="cb110-2417"><a href="#cb110-2417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2420"><a href="#cb110-2420" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2421"><a href="#cb110-2421" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2422"><a href="#cb110-2422" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2423"><a href="#cb110-2423" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2424"><a href="#cb110-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2425"><a href="#cb110-2425" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> PermissionGuard, Permission, SecurityContext</span>
<span id="cb110-2426"><a href="#cb110-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2427"><a href="#cb110-2427" aria-hidden="true" tabindex="-1"></a><span class="co"># Require specific permissions</span></span>
<span id="cb110-2428"><a href="#cb110-2428" aria-hidden="true" tabindex="-1"></a>admin_only <span class="op">=</span> PermissionGuard(</span>
<span id="cb110-2429"><a href="#cb110-2429" aria-hidden="true" tabindex="-1"></a>    DeleteService(),</span>
<span id="cb110-2430"><a href="#cb110-2430" aria-hidden="true" tabindex="-1"></a>    required_permissions<span class="op">=</span>{Permission.DELETE, Permission.ADMIN},</span>
<span id="cb110-2431"><a href="#cb110-2431" aria-hidden="true" tabindex="-1"></a>    required_roles<span class="op">=</span>{<span class="st">"administrator"</span>},</span>
<span id="cb110-2432"><a href="#cb110-2432" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2433"><a href="#cb110-2433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2434"><a href="#cb110-2434" aria-hidden="true" tabindex="-1"></a><span class="co"># Create security context</span></span>
<span id="cb110-2435"><a href="#cb110-2435" aria-hidden="true" tabindex="-1"></a>context <span class="op">=</span> SecurityContext(</span>
<span id="cb110-2436"><a href="#cb110-2436" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">=</span><span class="st">"alice"</span>,</span>
<span id="cb110-2437"><a href="#cb110-2437" aria-hidden="true" tabindex="-1"></a>    permissions<span class="op">=</span>{Permission.READ, Permission.WRITE},</span>
<span id="cb110-2438"><a href="#cb110-2438" aria-hidden="true" tabindex="-1"></a>    roles<span class="op">=</span>{<span class="st">"user"</span>},</span>
<span id="cb110-2439"><a href="#cb110-2439" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2440"><a href="#cb110-2440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2441"><a href="#cb110-2441" aria-hidden="true" tabindex="-1"></a><span class="co"># Access denied without proper permissions</span></span>
<span id="cb110-2442"><a href="#cb110-2442" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-2443"><a href="#cb110-2443" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> admin_only.invoke(request, deps<span class="op">=</span>{<span class="st">"security_context"</span>: context})</span>
<span id="cb110-2444"><a href="#cb110-2444" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">PermissionError</span>:</span>
<span id="cb110-2445"><a href="#cb110-2445" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Access denied"</span>)</span>
<span id="cb110-2446"><a href="#cb110-2446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2447"><a href="#cb110-2447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2448"><a href="#cb110-2448" aria-hidden="true" tabindex="-1"></a><span class="fu">### Encryption</span></span>
<span id="cb110-2449"><a href="#cb110-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2450"><a href="#cb110-2450" aria-hidden="true" tabindex="-1"></a>Protect sensitive data at rest and in transit:</span>
<span id="cb110-2451"><a href="#cb110-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2454"><a href="#cb110-2454" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2455"><a href="#cb110-2455" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2456"><a href="#cb110-2456" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2457"><a href="#cb110-2457" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2458"><a href="#cb110-2458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2459"><a href="#cb110-2459" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> EncryptionBrick</span>
<span id="cb110-2460"><a href="#cb110-2460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2461"><a href="#cb110-2461" aria-hidden="true" tabindex="-1"></a><span class="co"># Encrypt specific fields</span></span>
<span id="cb110-2462"><a href="#cb110-2462" aria-hidden="true" tabindex="-1"></a>encrypted <span class="op">=</span> EncryptionBrick(</span>
<span id="cb110-2463"><a href="#cb110-2463" aria-hidden="true" tabindex="-1"></a>    UserDataStore(),</span>
<span id="cb110-2464"><a href="#cb110-2464" aria-hidden="true" tabindex="-1"></a>    fields_to_encrypt<span class="op">=</span>[<span class="st">"password"</span>, <span class="st">"ssn"</span>, <span class="st">"credit_card"</span>],</span>
<span id="cb110-2465"><a href="#cb110-2465" aria-hidden="true" tabindex="-1"></a>    encrypt_output<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2466"><a href="#cb110-2466" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2467"><a href="#cb110-2467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2468"><a href="#cb110-2468" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensitive fields are automatically encrypted</span></span>
<span id="cb110-2469"><a href="#cb110-2469" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> encrypted.invoke({</span>
<span id="cb110-2470"><a href="#cb110-2470" aria-hidden="true" tabindex="-1"></a>    <span class="st">"username"</span>: <span class="st">"alice"</span>,</span>
<span id="cb110-2471"><a href="#cb110-2471" aria-hidden="true" tabindex="-1"></a>    <span class="st">"password"</span>: <span class="st">"secret123"</span>,  <span class="co"># Will be encrypted</span></span>
<span id="cb110-2472"><a href="#cb110-2472" aria-hidden="true" tabindex="-1"></a>    <span class="st">"email"</span>: <span class="st">"alice@example.com"</span>,  <span class="co"># Not encrypted</span></span>
<span id="cb110-2473"><a href="#cb110-2473" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb110-2474"><a href="#cb110-2474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2475"><a href="#cb110-2475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2476"><a href="#cb110-2476" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audit Logging</span></span>
<span id="cb110-2477"><a href="#cb110-2477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2478"><a href="#cb110-2478" aria-hidden="true" tabindex="-1"></a>Track all operations for compliance and security:</span>
<span id="cb110-2479"><a href="#cb110-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2482"><a href="#cb110-2482" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2483"><a href="#cb110-2483" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2484"><a href="#cb110-2484" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2485"><a href="#cb110-2485" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2486"><a href="#cb110-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2487"><a href="#cb110-2487" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> AuditLogger</span>
<span id="cb110-2488"><a href="#cb110-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2489"><a href="#cb110-2489" aria-hidden="true" tabindex="-1"></a><span class="co"># Log all operations</span></span>
<span id="cb110-2490"><a href="#cb110-2490" aria-hidden="true" tabindex="-1"></a>audited <span class="op">=</span> AuditLogger(</span>
<span id="cb110-2491"><a href="#cb110-2491" aria-hidden="true" tabindex="-1"></a>    PaymentService(),</span>
<span id="cb110-2492"><a href="#cb110-2492" aria-hidden="true" tabindex="-1"></a>    log_input<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2493"><a href="#cb110-2493" aria-hidden="true" tabindex="-1"></a>    log_output<span class="op">=</span><span class="va">False</span>,  <span class="co"># Don't log sensitive output</span></span>
<span id="cb110-2494"><a href="#cb110-2494" aria-hidden="true" tabindex="-1"></a>    hash_sensitive_data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2495"><a href="#cb110-2495" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2496"><a href="#cb110-2496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2497"><a href="#cb110-2497" aria-hidden="true" tabindex="-1"></a><span class="co"># All operations are logged</span></span>
<span id="cb110-2498"><a href="#cb110-2498" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> audited.invoke(payment_request)</span>
<span id="cb110-2499"><a href="#cb110-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2500"><a href="#cb110-2500" aria-hidden="true" tabindex="-1"></a><span class="co"># Query audit log</span></span>
<span id="cb110-2501"><a href="#cb110-2501" aria-hidden="true" tabindex="-1"></a>entries <span class="op">=</span> audited.get_audit_log(</span>
<span id="cb110-2502"><a href="#cb110-2502" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">=</span><span class="st">"alice"</span>,</span>
<span id="cb110-2503"><a href="#cb110-2503" aria-hidden="true" tabindex="-1"></a>    start_time<span class="op">=</span>yesterday,</span>
<span id="cb110-2504"><a href="#cb110-2504" aria-hidden="true" tabindex="-1"></a>    success_only<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb110-2505"><a href="#cb110-2505" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2506"><a href="#cb110-2506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2507"><a href="#cb110-2507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2508"><a href="#cb110-2508" aria-hidden="true" tabindex="-1"></a><span class="fu">### Layered Security</span></span>
<span id="cb110-2509"><a href="#cb110-2509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2510"><a href="#cb110-2510" aria-hidden="true" tabindex="-1"></a>Apply multiple security layers at once:</span>
<span id="cb110-2511"><a href="#cb110-2511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2514"><a href="#cb110-2514" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2515"><a href="#cb110-2515" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2516"><a href="#cb110-2516" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2517"><a href="#cb110-2517" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2518"><a href="#cb110-2518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2519"><a href="#cb110-2519" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.security <span class="im">import</span> secure_nanobrick</span>
<span id="cb110-2520"><a href="#cb110-2520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2521"><a href="#cb110-2521" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply all security features</span></span>
<span id="cb110-2522"><a href="#cb110-2522" aria-hidden="true" tabindex="-1"></a>secure_service <span class="op">=</span> secure_nanobrick(</span>
<span id="cb110-2523"><a href="#cb110-2523" aria-hidden="true" tabindex="-1"></a>    CriticalService(),</span>
<span id="cb110-2524"><a href="#cb110-2524" aria-hidden="true" tabindex="-1"></a>    sanitize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2525"><a href="#cb110-2525" aria-hidden="true" tabindex="-1"></a>    rate_limit<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb110-2526"><a href="#cb110-2526" aria-hidden="true" tabindex="-1"></a>    permissions<span class="op">=</span>{Permission.EXECUTE},</span>
<span id="cb110-2527"><a href="#cb110-2527" aria-hidden="true" tabindex="-1"></a>    encrypt<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2528"><a href="#cb110-2528" aria-hidden="true" tabindex="-1"></a>    audit<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2529"><a href="#cb110-2529" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2530"><a href="#cb110-2530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2531"><a href="#cb110-2531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2532"><a href="#cb110-2532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Production Features</span></span>
<span id="cb110-2533"><a href="#cb110-2533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2534"><a href="#cb110-2534" aria-hidden="true" tabindex="-1"></a>Make your nanobricks production-ready with reliability patterns:</span>
<span id="cb110-2535"><a href="#cb110-2535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2536"><a href="#cb110-2536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Circuit Breakers</span></span>
<span id="cb110-2537"><a href="#cb110-2537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2538"><a href="#cb110-2538" aria-hidden="true" tabindex="-1"></a>Prevent cascading failures with automatic circuit breaking:</span>
<span id="cb110-2539"><a href="#cb110-2539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2542"><a href="#cb110-2542" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2543"><a href="#cb110-2543" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2544"><a href="#cb110-2544" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2545"><a href="#cb110-2545" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2546"><a href="#cb110-2546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2547"><a href="#cb110-2547" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> CircuitBreaker</span>
<span id="cb110-2548"><a href="#cb110-2548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2549"><a href="#cb110-2549" aria-hidden="true" tabindex="-1"></a><span class="co"># Protect unreliable services</span></span>
<span id="cb110-2550"><a href="#cb110-2550" aria-hidden="true" tabindex="-1"></a>breaker <span class="op">=</span> CircuitBreaker(</span>
<span id="cb110-2551"><a href="#cb110-2551" aria-hidden="true" tabindex="-1"></a>    ExternalApiService(),</span>
<span id="cb110-2552"><a href="#cb110-2552" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">5</span>,      <span class="co"># Open after 5 failures</span></span>
<span id="cb110-2553"><a href="#cb110-2553" aria-hidden="true" tabindex="-1"></a>    success_threshold<span class="op">=</span><span class="dv">2</span>,      <span class="co"># Close after 2 successes</span></span>
<span id="cb110-2554"><a href="#cb110-2554" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">60</span>,       <span class="co"># Reset attempt after 60s</span></span>
<span id="cb110-2555"><a href="#cb110-2555" aria-hidden="true" tabindex="-1"></a>    fallback<span class="op">=</span><span class="kw">lambda</span> x, d: cached_response,  <span class="co"># Fallback when open</span></span>
<span id="cb110-2556"><a href="#cb110-2556" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2557"><a href="#cb110-2557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2558"><a href="#cb110-2558" aria-hidden="true" tabindex="-1"></a><span class="co"># Circuit opens automatically on failures</span></span>
<span id="cb110-2559"><a href="#cb110-2559" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> breaker.invoke(request)</span>
<span id="cb110-2560"><a href="#cb110-2560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2561"><a href="#cb110-2561" aria-hidden="true" tabindex="-1"></a><span class="co"># Check circuit status</span></span>
<span id="cb110-2562"><a href="#cb110-2562" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Circuit state: </span><span class="sc">{</span>breaker<span class="sc">.</span>state<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># CLOSED, OPEN, or HALF_OPEN</span></span>
<span id="cb110-2563"><a href="#cb110-2563" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stats: </span><span class="sc">{</span>breaker<span class="sc">.</span>stats<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2564"><a href="#cb110-2564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2565"><a href="#cb110-2565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2566"><a href="#cb110-2566" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bulkhead Isolation</span></span>
<span id="cb110-2567"><a href="#cb110-2567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2568"><a href="#cb110-2568" aria-hidden="true" tabindex="-1"></a>Isolate resources to prevent total system failure:</span>
<span id="cb110-2569"><a href="#cb110-2569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2572"><a href="#cb110-2572" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2573"><a href="#cb110-2573" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2574"><a href="#cb110-2574" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2575"><a href="#cb110-2575" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2576"><a href="#cb110-2576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2577"><a href="#cb110-2577" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> Bulkhead</span>
<span id="cb110-2578"><a href="#cb110-2578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2579"><a href="#cb110-2579" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit concurrent executions</span></span>
<span id="cb110-2580"><a href="#cb110-2580" aria-hidden="true" tabindex="-1"></a>bulkhead <span class="op">=</span> Bulkhead(</span>
<span id="cb110-2581"><a href="#cb110-2581" aria-hidden="true" tabindex="-1"></a>    ResourceIntensiveService(),</span>
<span id="cb110-2582"><a href="#cb110-2582" aria-hidden="true" tabindex="-1"></a>    max_concurrent<span class="op">=</span><span class="dv">5</span>,        <span class="co"># Max 5 concurrent</span></span>
<span id="cb110-2583"><a href="#cb110-2583" aria-hidden="true" tabindex="-1"></a>    max_queue_size<span class="op">=</span><span class="dv">10</span>,       <span class="co"># Queue up to 10 more</span></span>
<span id="cb110-2584"><a href="#cb110-2584" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">30</span>,      <span class="co"># Timeout waiting for slot</span></span>
<span id="cb110-2585"><a href="#cb110-2585" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2586"><a href="#cb110-2586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2587"><a href="#cb110-2587" aria-hidden="true" tabindex="-1"></a><span class="co"># Requests beyond limits are rejected</span></span>
<span id="cb110-2588"><a href="#cb110-2588" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-2589"><a href="#cb110-2589" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[</span>
<span id="cb110-2590"><a href="#cb110-2590" aria-hidden="true" tabindex="-1"></a>        bulkhead.invoke(req) <span class="cf">for</span> req <span class="kw">in</span> many_requests</span>
<span id="cb110-2591"><a href="#cb110-2591" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb110-2592"><a href="#cb110-2592" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">RuntimeError</span> <span class="im">as</span> e:</span>
<span id="cb110-2593"><a href="#cb110-2593" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Bulkhead full: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2594"><a href="#cb110-2594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2595"><a href="#cb110-2595" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor bulkhead status</span></span>
<span id="cb110-2596"><a href="#cb110-2596" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Active: </span><span class="sc">{</span>bulkhead<span class="sc">.</span>active_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2597"><a href="#cb110-2597" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stats: </span><span class="sc">{</span>bulkhead<span class="sc">.</span>stats<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2598"><a href="#cb110-2598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2599"><a href="#cb110-2599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2600"><a href="#cb110-2600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Health Checks</span></span>
<span id="cb110-2601"><a href="#cb110-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2602"><a href="#cb110-2602" aria-hidden="true" tabindex="-1"></a>Monitor service health automatically:</span>
<span id="cb110-2603"><a href="#cb110-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2606"><a href="#cb110-2606" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2607"><a href="#cb110-2607" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2608"><a href="#cb110-2608" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2609"><a href="#cb110-2609" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2610"><a href="#cb110-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2611"><a href="#cb110-2611" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> HealthCheck</span>
<span id="cb110-2612"><a href="#cb110-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2613"><a href="#cb110-2613" aria-hidden="true" tabindex="-1"></a><span class="co"># Add health monitoring</span></span>
<span id="cb110-2614"><a href="#cb110-2614" aria-hidden="true" tabindex="-1"></a>monitored <span class="op">=</span> HealthCheck(</span>
<span id="cb110-2615"><a href="#cb110-2615" aria-hidden="true" tabindex="-1"></a>    CriticalService(),</span>
<span id="cb110-2616"><a href="#cb110-2616" aria-hidden="true" tabindex="-1"></a>    check_interval_seconds<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb110-2617"><a href="#cb110-2617" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb110-2618"><a href="#cb110-2618" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2619"><a href="#cb110-2619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2620"><a href="#cb110-2620" aria-hidden="true" tabindex="-1"></a><span class="co"># Start background health checks</span></span>
<span id="cb110-2621"><a href="#cb110-2621" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> monitored.start_health_checks()</span>
<span id="cb110-2622"><a href="#cb110-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2623"><a href="#cb110-2623" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the service normally</span></span>
<span id="cb110-2624"><a href="#cb110-2624" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> monitored.invoke(request)</span>
<span id="cb110-2625"><a href="#cb110-2625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2626"><a href="#cb110-2626" aria-hidden="true" tabindex="-1"></a><span class="co"># Check health status</span></span>
<span id="cb110-2627"><a href="#cb110-2627" aria-hidden="true" tabindex="-1"></a>health <span class="op">=</span> <span class="cf">await</span> monitored.check_health()</span>
<span id="cb110-2628"><a href="#cb110-2628" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Status: </span><span class="sc">{</span>health<span class="sc">.</span>status<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># HEALTHY, DEGRADED, or UNHEALTHY</span></span>
<span id="cb110-2629"><a href="#cb110-2629" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Details: </span><span class="sc">{</span>health<span class="sc">.</span>details<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2630"><a href="#cb110-2630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2631"><a href="#cb110-2631" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom health check logic</span></span>
<span id="cb110-2632"><a href="#cb110-2632" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_check():</span>
<span id="cb110-2633"><a href="#cb110-2633" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check database, disk space, etc.</span></span>
<span id="cb110-2634"><a href="#cb110-2634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> database_connected <span class="kw">and</span> disk_space_ok:</span>
<span id="cb110-2635"><a href="#cb110-2635" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> HealthCheckResult(HealthStatus.HEALTHY)</span>
<span id="cb110-2636"><a href="#cb110-2636" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb110-2637"><a href="#cb110-2637" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> HealthCheckResult(HealthStatus.UNHEALTHY)</span>
<span id="cb110-2638"><a href="#cb110-2638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2639"><a href="#cb110-2639" aria-hidden="true" tabindex="-1"></a>custom_monitored <span class="op">=</span> HealthCheck(service, custom_check<span class="op">=</span>custom_check)</span>
<span id="cb110-2640"><a href="#cb110-2640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2641"><a href="#cb110-2641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2642"><a href="#cb110-2642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Graceful Shutdown</span></span>
<span id="cb110-2643"><a href="#cb110-2643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2644"><a href="#cb110-2644" aria-hidden="true" tabindex="-1"></a>Clean shutdown with proper resource cleanup:</span>
<span id="cb110-2645"><a href="#cb110-2645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2648"><a href="#cb110-2648" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2649"><a href="#cb110-2649" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2650"><a href="#cb110-2650" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2651"><a href="#cb110-2651" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2652"><a href="#cb110-2652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2653"><a href="#cb110-2653" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> GracefulShutdown</span>
<span id="cb110-2654"><a href="#cb110-2654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2655"><a href="#cb110-2655" aria-hidden="true" tabindex="-1"></a><span class="co"># Create shutdown manager</span></span>
<span id="cb110-2656"><a href="#cb110-2656" aria-hidden="true" tabindex="-1"></a>shutdown <span class="op">=</span> GracefulShutdown(timeout_seconds<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb110-2657"><a href="#cb110-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2658"><a href="#cb110-2658" aria-hidden="true" tabindex="-1"></a><span class="co"># Register resources to manage</span></span>
<span id="cb110-2659"><a href="#cb110-2659" aria-hidden="true" tabindex="-1"></a>shutdown.register_brick(database_service)</span>
<span id="cb110-2660"><a href="#cb110-2660" aria-hidden="true" tabindex="-1"></a>shutdown.register_brick(cache_service)</span>
<span id="cb110-2661"><a href="#cb110-2661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2662"><a href="#cb110-2662" aria-hidden="true" tabindex="-1"></a><span class="co"># Register background tasks</span></span>
<span id="cb110-2663"><a href="#cb110-2663" aria-hidden="true" tabindex="-1"></a>shutdown.register_task(monitoring_task)</span>
<span id="cb110-2664"><a href="#cb110-2664" aria-hidden="true" tabindex="-1"></a>shutdown.register_task(cleanup_task)</span>
<span id="cb110-2665"><a href="#cb110-2665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2666"><a href="#cb110-2666" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom shutdown handlers</span></span>
<span id="cb110-2667"><a href="#cb110-2667" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> save_state():</span>
<span id="cb110-2668"><a href="#cb110-2668" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> state_store.save()</span>
<span id="cb110-2669"><a href="#cb110-2669" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"State saved"</span>)</span>
<span id="cb110-2670"><a href="#cb110-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2671"><a href="#cb110-2671" aria-hidden="true" tabindex="-1"></a>shutdown.register_handler(save_state)</span>
<span id="cb110-2672"><a href="#cb110-2672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2673"><a href="#cb110-2673" aria-hidden="true" tabindex="-1"></a><span class="co"># Install signal handlers (SIGTERM, SIGINT)</span></span>
<span id="cb110-2674"><a href="#cb110-2674" aria-hidden="true" tabindex="-1"></a>shutdown.install_signal_handlers()</span>
<span id="cb110-2675"><a href="#cb110-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2676"><a href="#cb110-2676" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait for shutdown signal</span></span>
<span id="cb110-2677"><a href="#cb110-2677" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> shutdown.wait_for_shutdown()</span>
<span id="cb110-2678"><a href="#cb110-2678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2679"><a href="#cb110-2679" aria-hidden="true" tabindex="-1"></a><span class="co"># Or trigger manually</span></span>
<span id="cb110-2680"><a href="#cb110-2680" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> shutdown.shutdown()</span>
<span id="cb110-2681"><a href="#cb110-2681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2682"><a href="#cb110-2682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2683"><a href="#cb110-2683" aria-hidden="true" tabindex="-1"></a><span class="fu">### All-in-One Production Setup</span></span>
<span id="cb110-2684"><a href="#cb110-2684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2685"><a href="#cb110-2685" aria-hidden="true" tabindex="-1"></a>Apply all production features at once:</span>
<span id="cb110-2686"><a href="#cb110-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2689"><a href="#cb110-2689" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2690"><a href="#cb110-2690" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2691"><a href="#cb110-2691" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2692"><a href="#cb110-2692" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2693"><a href="#cb110-2693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2694"><a href="#cb110-2694" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.production <span class="im">import</span> with_production_features</span>
<span id="cb110-2695"><a href="#cb110-2695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2696"><a href="#cb110-2696" aria-hidden="true" tabindex="-1"></a><span class="co"># Make any brick production-ready</span></span>
<span id="cb110-2697"><a href="#cb110-2697" aria-hidden="true" tabindex="-1"></a>production_service <span class="op">=</span> with_production_features(</span>
<span id="cb110-2698"><a href="#cb110-2698" aria-hidden="true" tabindex="-1"></a>    MyService(),</span>
<span id="cb110-2699"><a href="#cb110-2699" aria-hidden="true" tabindex="-1"></a>    circuit_breaker<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2700"><a href="#cb110-2700" aria-hidden="true" tabindex="-1"></a>    bulkhead<span class="op">=</span><span class="dv">10</span>,           <span class="co"># Max 10 concurrent</span></span>
<span id="cb110-2701"><a href="#cb110-2701" aria-hidden="true" tabindex="-1"></a>    health_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2702"><a href="#cb110-2702" aria-hidden="true" tabindex="-1"></a>    failure_threshold<span class="op">=</span><span class="dv">5</span>,   <span class="co"># Circuit breaker setting</span></span>
<span id="cb110-2703"><a href="#cb110-2703" aria-hidden="true" tabindex="-1"></a>    timeout_seconds<span class="op">=</span><span class="dv">60</span>,    <span class="co"># Circuit reset timeout</span></span>
<span id="cb110-2704"><a href="#cb110-2704" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2705"><a href="#cb110-2705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2706"><a href="#cb110-2706" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally - all protection is transparent</span></span>
<span id="cb110-2707"><a href="#cb110-2707" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> production_service.invoke(request)</span>
<span id="cb110-2708"><a href="#cb110-2708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2709"><a href="#cb110-2709" aria-hidden="true" tabindex="-1"></a><span class="co"># Features work together:</span></span>
<span id="cb110-2710"><a href="#cb110-2710" aria-hidden="true" tabindex="-1"></a><span class="co"># - Circuit breaker prevents cascading failures</span></span>
<span id="cb110-2711"><a href="#cb110-2711" aria-hidden="true" tabindex="-1"></a><span class="co"># - Bulkhead limits resource usage</span></span>
<span id="cb110-2712"><a href="#cb110-2712" aria-hidden="true" tabindex="-1"></a><span class="co"># - Health checks monitor service status</span></span>
<span id="cb110-2713"><a href="#cb110-2713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2714"><a href="#cb110-2714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2715"><a href="#cb110-2715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Optimization</span></span>
<span id="cb110-2716"><a href="#cb110-2716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2717"><a href="#cb110-2717" aria-hidden="true" tabindex="-1"></a>Optimize your nanobricks for maximum performance:</span>
<span id="cb110-2718"><a href="#cb110-2718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2719"><a href="#cb110-2719" aria-hidden="true" tabindex="-1"></a><span class="fu">### Caching</span></span>
<span id="cb110-2720"><a href="#cb110-2720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2721"><a href="#cb110-2721" aria-hidden="true" tabindex="-1"></a>Cache expensive operations with TTL and LRU eviction:</span>
<span id="cb110-2722"><a href="#cb110-2722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2725"><a href="#cb110-2725" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2726"><a href="#cb110-2726" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2727"><a href="#cb110-2727" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2728"><a href="#cb110-2728" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2729"><a href="#cb110-2729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2730"><a href="#cb110-2730" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_cache</span>
<span id="cb110-2731"><a href="#cb110-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2732"><a href="#cb110-2732" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caching to any brick</span></span>
<span id="cb110-2733"><a href="#cb110-2733" aria-hidden="true" tabindex="-1"></a>fibonacci <span class="op">=</span> FibonacciBrick()</span>
<span id="cb110-2734"><a href="#cb110-2734" aria-hidden="true" tabindex="-1"></a>cached_fib <span class="op">=</span> with_cache(</span>
<span id="cb110-2735"><a href="#cb110-2735" aria-hidden="true" tabindex="-1"></a>    fibonacci,</span>
<span id="cb110-2736"><a href="#cb110-2736" aria-hidden="true" tabindex="-1"></a>    max_size<span class="op">=</span><span class="dv">1000</span>,      <span class="co"># Max cache entries</span></span>
<span id="cb110-2737"><a href="#cb110-2737" aria-hidden="true" tabindex="-1"></a>    ttl<span class="op">=</span><span class="dv">300</span>,            <span class="co"># 5 minute TTL</span></span>
<span id="cb110-2738"><a href="#cb110-2738" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2739"><a href="#cb110-2739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2740"><a href="#cb110-2740" aria-hidden="true" tabindex="-1"></a><span class="co"># First call computes</span></span>
<span id="cb110-2741"><a href="#cb110-2741" aria-hidden="true" tabindex="-1"></a>result1 <span class="op">=</span> <span class="cf">await</span> cached_fib.invoke(<span class="dv">20</span>)  <span class="co"># Takes time</span></span>
<span id="cb110-2742"><a href="#cb110-2742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2743"><a href="#cb110-2743" aria-hidden="true" tabindex="-1"></a><span class="co"># Second call is instant</span></span>
<span id="cb110-2744"><a href="#cb110-2744" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> <span class="cf">await</span> cached_fib.invoke(<span class="dv">20</span>)  <span class="co"># From cache!</span></span>
<span id="cb110-2745"><a href="#cb110-2745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2746"><a href="#cb110-2746" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cache statistics</span></span>
<span id="cb110-2747"><a href="#cb110-2747" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> cached_fib.cache_info()</span>
<span id="cb110-2748"><a href="#cb110-2748" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache hits: </span><span class="sc">{</span>stats[<span class="st">'hits'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2749"><a href="#cb110-2749" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache size: </span><span class="sc">{</span>stats[<span class="st">'size'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2750"><a href="#cb110-2750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2751"><a href="#cb110-2751" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear cache if needed</span></span>
<span id="cb110-2752"><a href="#cb110-2752" aria-hidden="true" tabindex="-1"></a>cached_fib.clear_cache()</span>
<span id="cb110-2753"><a href="#cb110-2753" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2754"><a href="#cb110-2754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2755"><a href="#cb110-2755" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connection Pooling</span></span>
<span id="cb110-2756"><a href="#cb110-2756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2757"><a href="#cb110-2757" aria-hidden="true" tabindex="-1"></a>Efficiently manage external resources:</span>
<span id="cb110-2758"><a href="#cb110-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2761"><a href="#cb110-2761" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2762"><a href="#cb110-2762" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2763"><a href="#cb110-2763" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2764"><a href="#cb110-2764" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2765"><a href="#cb110-2765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2766"><a href="#cb110-2766" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> ConnectionPool</span>
<span id="cb110-2767"><a href="#cb110-2767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2768"><a href="#cb110-2768" aria-hidden="true" tabindex="-1"></a><span class="co"># Create connection pool</span></span>
<span id="cb110-2769"><a href="#cb110-2769" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> create_db_connection():</span>
<span id="cb110-2770"><a href="#cb110-2770" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate expensive connection</span></span>
<span id="cb110-2771"><a href="#cb110-2771" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)</span>
<span id="cb110-2772"><a href="#cb110-2772" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"id"</span>: random.randint(<span class="dv">1000</span>, <span class="dv">9999</span>), <span class="st">"connected"</span>: <span class="va">True</span>}</span>
<span id="cb110-2773"><a href="#cb110-2773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2774"><a href="#cb110-2774" aria-hidden="true" tabindex="-1"></a>pool <span class="op">=</span> ConnectionPool(</span>
<span id="cb110-2775"><a href="#cb110-2775" aria-hidden="true" tabindex="-1"></a>    create_db_connection,</span>
<span id="cb110-2776"><a href="#cb110-2776" aria-hidden="true" tabindex="-1"></a>    min_size<span class="op">=</span><span class="dv">2</span>,         <span class="co"># Keep 2 connections ready</span></span>
<span id="cb110-2777"><a href="#cb110-2777" aria-hidden="true" tabindex="-1"></a>    max_size<span class="op">=</span><span class="dv">10</span>,        <span class="co"># Max 10 connections</span></span>
<span id="cb110-2778"><a href="#cb110-2778" aria-hidden="true" tabindex="-1"></a>    acquire_timeout<span class="op">=</span><span class="fl">5.0</span>,</span>
<span id="cb110-2779"><a href="#cb110-2779" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2780"><a href="#cb110-2780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2781"><a href="#cb110-2781" aria-hidden="true" tabindex="-1"></a><span class="co"># Use connections efficiently</span></span>
<span id="cb110-2782"><a href="#cb110-2782" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="cf">with</span> pool.acquire() <span class="im">as</span> conn:</span>
<span id="cb110-2783"><a href="#cb110-2783" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Connection is automatically returned to pool</span></span>
<span id="cb110-2784"><a href="#cb110-2784" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> db_brick.invoke(query, deps<span class="op">=</span>{<span class="st">"connection"</span>: conn})</span>
<span id="cb110-2785"><a href="#cb110-2785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2786"><a href="#cb110-2786" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor pool health</span></span>
<span id="cb110-2787"><a href="#cb110-2787" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> pool.get_stats()</span>
<span id="cb110-2788"><a href="#cb110-2788" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Active connections: </span><span class="sc">{</span>stats[<span class="st">'in_use'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2789"><a href="#cb110-2789" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Available: </span><span class="sc">{</span>stats[<span class="st">'available'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2790"><a href="#cb110-2790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2791"><a href="#cb110-2791" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup</span></span>
<span id="cb110-2792"><a href="#cb110-2792" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> pool.close()</span>
<span id="cb110-2793"><a href="#cb110-2793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2794"><a href="#cb110-2794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2795"><a href="#cb110-2795" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pipeline Fusion</span></span>
<span id="cb110-2796"><a href="#cb110-2796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2797"><a href="#cb110-2797" aria-hidden="true" tabindex="-1"></a>Optimize pipeline execution by fusing operations:</span>
<span id="cb110-2798"><a href="#cb110-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2801"><a href="#cb110-2801" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2802"><a href="#cb110-2802" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2803"><a href="#cb110-2803" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2804"><a href="#cb110-2804" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2805"><a href="#cb110-2805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2806"><a href="#cb110-2806" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> FusedPipeline</span>
<span id="cb110-2807"><a href="#cb110-2807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2808"><a href="#cb110-2808" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular pipeline</span></span>
<span id="cb110-2809"><a href="#cb110-2809" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> TransformBrick(<span class="bu">str</span>.upper)</span>
<span id="cb110-2810"><a href="#cb110-2810" aria-hidden="true" tabindex="-1"></a>strip <span class="op">=</span> TransformBrick(<span class="bu">str</span>.strip)</span>
<span id="cb110-2811"><a href="#cb110-2811" aria-hidden="true" tabindex="-1"></a>reverse <span class="op">=</span> TransformBrick(<span class="kw">lambda</span> x: x[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb110-2812"><a href="#cb110-2812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2813"><a href="#cb110-2813" aria-hidden="true" tabindex="-1"></a><span class="co"># Create fused pipeline for better performance</span></span>
<span id="cb110-2814"><a href="#cb110-2814" aria-hidden="true" tabindex="-1"></a>fused <span class="op">=</span> FusedPipeline([upper, strip, reverse])</span>
<span id="cb110-2815"><a href="#cb110-2815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2816"><a href="#cb110-2816" aria-hidden="true" tabindex="-1"></a><span class="co"># Benchmark comparison</span></span>
<span id="cb110-2817"><a href="#cb110-2817" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb110-2818"><a href="#cb110-2818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2819"><a href="#cb110-2819" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular execution</span></span>
<span id="cb110-2820"><a href="#cb110-2820" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb110-2821"><a href="#cb110-2821" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb110-2822"><a href="#cb110-2822" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> upper.invoke(<span class="st">"  hello  "</span>)</span>
<span id="cb110-2823"><a href="#cb110-2823" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> strip.invoke(result)</span>
<span id="cb110-2824"><a href="#cb110-2824" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> reverse.invoke(result)</span>
<span id="cb110-2825"><a href="#cb110-2825" aria-hidden="true" tabindex="-1"></a>regular_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb110-2826"><a href="#cb110-2826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2827"><a href="#cb110-2827" aria-hidden="true" tabindex="-1"></a><span class="co"># Fused execution - reduces async overhead</span></span>
<span id="cb110-2828"><a href="#cb110-2828" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb110-2829"><a href="#cb110-2829" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb110-2830"><a href="#cb110-2830" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> fused.invoke(<span class="st">"  hello  "</span>)</span>
<span id="cb110-2831"><a href="#cb110-2831" aria-hidden="true" tabindex="-1"></a>fused_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb110-2832"><a href="#cb110-2832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2833"><a href="#cb110-2833" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Speedup: </span><span class="sc">{</span>regular_time <span class="op">/</span> fused_time<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb110-2834"><a href="#cb110-2834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2835"><a href="#cb110-2835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2836"><a href="#cb110-2836" aria-hidden="true" tabindex="-1"></a><span class="fu">### Performance Profiling</span></span>
<span id="cb110-2837"><a href="#cb110-2837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2838"><a href="#cb110-2838" aria-hidden="true" tabindex="-1"></a>Profile your bricks to identify bottlenecks:</span>
<span id="cb110-2839"><a href="#cb110-2839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2842"><a href="#cb110-2842" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2843"><a href="#cb110-2843" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2844"><a href="#cb110-2844" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2845"><a href="#cb110-2845" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2846"><a href="#cb110-2846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2847"><a href="#cb110-2847" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> ProfilerBrick</span>
<span id="cb110-2848"><a href="#cb110-2848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2849"><a href="#cb110-2849" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap any brick with profiling</span></span>
<span id="cb110-2850"><a href="#cb110-2850" aria-hidden="true" tabindex="-1"></a>profiled <span class="op">=</span> ProfilerBrick(</span>
<span id="cb110-2851"><a href="#cb110-2851" aria-hidden="true" tabindex="-1"></a>    SlowService(),</span>
<span id="cb110-2852"><a href="#cb110-2852" aria-hidden="true" tabindex="-1"></a>    enable_trace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-2853"><a href="#cb110-2853" aria-hidden="true" tabindex="-1"></a>    log_slow_calls<span class="op">=</span><span class="fl">100.0</span>,  <span class="co"># Log calls &gt; 100ms</span></span>
<span id="cb110-2854"><a href="#cb110-2854" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2855"><a href="#cb110-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2856"><a href="#cb110-2856" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally</span></span>
<span id="cb110-2857"><a href="#cb110-2857" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> profiled.invoke(request)</span>
<span id="cb110-2858"><a href="#cb110-2858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2859"><a href="#cb110-2859" aria-hidden="true" tabindex="-1"></a><span class="co"># Get performance metrics</span></span>
<span id="cb110-2860"><a href="#cb110-2860" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> profiled.get_metrics()</span>
<span id="cb110-2861"><a href="#cb110-2861" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average time: </span><span class="sc">{</span>metrics<span class="sc">.</span>avg_time_ms<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb110-2862"><a href="#cb110-2862" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min/Max: </span><span class="sc">{</span>metrics<span class="sc">.</span>min_time_ms<span class="sc">:.2f}</span><span class="ss">ms / </span><span class="sc">{</span>metrics<span class="sc">.</span>max_time_ms<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb110-2863"><a href="#cb110-2863" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total calls: </span><span class="sc">{</span>metrics<span class="sc">.</span>total_calls<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-2864"><a href="#cb110-2864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2865"><a href="#cb110-2865" aria-hidden="true" tabindex="-1"></a><span class="co"># Get detailed traces</span></span>
<span id="cb110-2866"><a href="#cb110-2866" aria-hidden="true" tabindex="-1"></a>traces <span class="op">=</span> profiled.get_traces()</span>
<span id="cb110-2867"><a href="#cb110-2867" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trace <span class="kw">in</span> traces:</span>
<span id="cb110-2868"><a href="#cb110-2868" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>trace[<span class="st">'brick'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>trace[<span class="st">'duration_ms'</span>]<span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb110-2869"><a href="#cb110-2869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2870"><a href="#cb110-2870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2871"><a href="#cb110-2871" aria-hidden="true" tabindex="-1"></a><span class="fu">### Benchmarking</span></span>
<span id="cb110-2872"><a href="#cb110-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2873"><a href="#cb110-2873" aria-hidden="true" tabindex="-1"></a>Accurately benchmark your nanobricks:</span>
<span id="cb110-2874"><a href="#cb110-2874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2877"><a href="#cb110-2877" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2878"><a href="#cb110-2878" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2879"><a href="#cb110-2879" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2880"><a href="#cb110-2880" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2881"><a href="#cb110-2881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2882"><a href="#cb110-2882" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> Benchmark</span>
<span id="cb110-2883"><a href="#cb110-2883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2884"><a href="#cb110-2884" aria-hidden="true" tabindex="-1"></a><span class="co"># Create benchmark</span></span>
<span id="cb110-2885"><a href="#cb110-2885" aria-hidden="true" tabindex="-1"></a>bench <span class="op">=</span> Benchmark(<span class="st">"data_processing"</span>)</span>
<span id="cb110-2886"><a href="#cb110-2886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2887"><a href="#cb110-2887" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure performance</span></span>
<span id="cb110-2888"><a href="#cb110-2888" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> bench.measure(</span>
<span id="cb110-2889"><a href="#cb110-2889" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span>: processor.invoke(test_data),</span>
<span id="cb110-2890"><a href="#cb110-2890" aria-hidden="true" tabindex="-1"></a>    iterations<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb110-2891"><a href="#cb110-2891" aria-hidden="true" tabindex="-1"></a>    warmup<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb110-2892"><a href="#cb110-2892" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2893"><a href="#cb110-2893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2894"><a href="#cb110-2894" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Operations/sec: </span><span class="sc">{</span>result<span class="sc">.</span>ops_per_sec<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb110-2895"><a href="#cb110-2895" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average latency: </span><span class="sc">{</span>result<span class="sc">.</span>avg_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb110-2896"><a href="#cb110-2896" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min/Max: </span><span class="sc">{</span>result<span class="sc">.</span>min_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms / </span><span class="sc">{</span>result<span class="sc">.</span>max_time <span class="op">*</span> <span class="dv">1000</span><span class="sc">:.2f}</span><span class="ss">ms"</span>)</span>
<span id="cb110-2897"><a href="#cb110-2897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2898"><a href="#cb110-2898" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare optimizations</span></span>
<span id="cb110-2899"><a href="#cb110-2899" aria-hidden="true" tabindex="-1"></a>original_result <span class="op">=</span> <span class="cf">await</span> bench.measure(original_processor.invoke)</span>
<span id="cb110-2900"><a href="#cb110-2900" aria-hidden="true" tabindex="-1"></a>optimized_result <span class="op">=</span> <span class="cf">await</span> bench.measure(optimized_processor.invoke)</span>
<span id="cb110-2901"><a href="#cb110-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2902"><a href="#cb110-2902" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> bench.compare(optimized_result)</span>
<span id="cb110-2903"><a href="#cb110-2903" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Speedup: </span><span class="sc">{</span>comparison[<span class="st">'speedup'</span>]<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb110-2904"><a href="#cb110-2904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2905"><a href="#cb110-2905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2906"><a href="#cb110-2906" aria-hidden="true" tabindex="-1"></a><span class="fu">### System Monitoring</span></span>
<span id="cb110-2907"><a href="#cb110-2907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2908"><a href="#cb110-2908" aria-hidden="true" tabindex="-1"></a>Monitor system resources:</span>
<span id="cb110-2909"><a href="#cb110-2909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2912"><a href="#cb110-2912" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2913"><a href="#cb110-2913" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2914"><a href="#cb110-2914" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2915"><a href="#cb110-2915" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2916"><a href="#cb110-2916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2917"><a href="#cb110-2917" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> get_system_metrics</span>
<span id="cb110-2918"><a href="#cb110-2918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2919"><a href="#cb110-2919" aria-hidden="true" tabindex="-1"></a><span class="co"># Get current system state</span></span>
<span id="cb110-2920"><a href="#cb110-2920" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> get_system_metrics()</span>
<span id="cb110-2921"><a href="#cb110-2921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2922"><a href="#cb110-2922" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"CPU Usage: </span><span class="sc">{</span>metrics[<span class="st">'cpu'</span>][<span class="st">'percent'</span>]<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb110-2923"><a href="#cb110-2923" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Memory: </span><span class="sc">{</span>metrics[<span class="st">'memory'</span>][<span class="st">'percent'</span>]<span class="sc">:.1f}</span><span class="ss">% used"</span>)</span>
<span id="cb110-2924"><a href="#cb110-2924" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Disk I/O: </span><span class="sc">{</span>metrics[<span class="st">'disk_io'</span>]<span class="sc">.</span>get(<span class="st">'read_bytes'</span>, <span class="dv">0</span>) <span class="op">/</span> <span class="fl">1e9</span><span class="sc">:.2f}</span><span class="ss"> GB read"</span>)</span>
<span id="cb110-2925"><a href="#cb110-2925" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Network: </span><span class="sc">{</span>metrics[<span class="st">'network_io'</span>]<span class="sc">.</span>get(<span class="st">'bytes_sent'</span>, <span class="dv">0</span>) <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.2f}</span><span class="ss"> MB sent"</span>)</span>
<span id="cb110-2926"><a href="#cb110-2926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2927"><a href="#cb110-2927" aria-hidden="true" tabindex="-1"></a><span class="co"># Use for adaptive behavior</span></span>
<span id="cb110-2928"><a href="#cb110-2928" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> metrics[<span class="st">'cpu'</span>][<span class="st">'percent'</span>] <span class="op">&gt;</span> <span class="dv">80</span>:</span>
<span id="cb110-2929"><a href="#cb110-2929" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Switch to low-resource mode</span></span>
<span id="cb110-2930"><a href="#cb110-2930" aria-hidden="true" tabindex="-1"></a>    processor.set_batch_size(<span class="dv">10</span>)</span>
<span id="cb110-2931"><a href="#cb110-2931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2932"><a href="#cb110-2932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2933"><a href="#cb110-2933" aria-hidden="true" tabindex="-1"></a><span class="fu">### All-in-One Optimization</span></span>
<span id="cb110-2934"><a href="#cb110-2934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2935"><a href="#cb110-2935" aria-hidden="true" tabindex="-1"></a>Apply multiple optimizations at once:</span>
<span id="cb110-2936"><a href="#cb110-2936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2939"><a href="#cb110-2939" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2940"><a href="#cb110-2940" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2941"><a href="#cb110-2941" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2942"><a href="#cb110-2942" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2943"><a href="#cb110-2943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2944"><a href="#cb110-2944" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.performance <span class="im">import</span> with_performance_optimizations</span>
<span id="cb110-2945"><a href="#cb110-2945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2946"><a href="#cb110-2946" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply all optimizations</span></span>
<span id="cb110-2947"><a href="#cb110-2947" aria-hidden="true" tabindex="-1"></a>optimized <span class="op">=</span> with_performance_optimizations(</span>
<span id="cb110-2948"><a href="#cb110-2948" aria-hidden="true" tabindex="-1"></a>    DataProcessor(),</span>
<span id="cb110-2949"><a href="#cb110-2949" aria-hidden="true" tabindex="-1"></a>    cache<span class="op">=</span><span class="va">True</span>,           <span class="co"># Enable caching</span></span>
<span id="cb110-2950"><a href="#cb110-2950" aria-hidden="true" tabindex="-1"></a>    cache_size<span class="op">=</span><span class="dv">1000</span>,      <span class="co"># Cache size</span></span>
<span id="cb110-2951"><a href="#cb110-2951" aria-hidden="true" tabindex="-1"></a>    cache_ttl<span class="op">=</span><span class="dv">300</span>,        <span class="co"># 5 minute TTL</span></span>
<span id="cb110-2952"><a href="#cb110-2952" aria-hidden="true" tabindex="-1"></a>    profile<span class="op">=</span><span class="va">True</span>,         <span class="co"># Enable profiling</span></span>
<span id="cb110-2953"><a href="#cb110-2953" aria-hidden="true" tabindex="-1"></a>    profile_trace<span class="op">=</span><span class="va">True</span>,   <span class="co"># Store traces</span></span>
<span id="cb110-2954"><a href="#cb110-2954" aria-hidden="true" tabindex="-1"></a>    log_slow_calls<span class="op">=</span><span class="fl">50.0</span>,  <span class="co"># Log &gt; 50ms calls</span></span>
<span id="cb110-2955"><a href="#cb110-2955" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-2956"><a href="#cb110-2956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2957"><a href="#cb110-2957" aria-hidden="true" tabindex="-1"></a><span class="co"># Use normally - optimizations are transparent</span></span>
<span id="cb110-2958"><a href="#cb110-2958" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="cf">await</span> optimized.invoke(data)</span>
<span id="cb110-2959"><a href="#cb110-2959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2960"><a href="#cb110-2960" aria-hidden="true" tabindex="-1"></a><span class="co"># Check performance</span></span>
<span id="cb110-2961"><a href="#cb110-2961" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> optimized.get_metrics()</span>
<span id="cb110-2962"><a href="#cb110-2962" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cache hit rate: </span><span class="sc">{</span>metrics<span class="sc">.</span>cache_hits <span class="op">/</span> metrics<span class="sc">.</span>total_calls<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb110-2963"><a href="#cb110-2963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-2964"><a href="#cb110-2964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2965"><a href="#cb110-2965" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coming Next</span></span>
<span id="cb110-2966"><a href="#cb110-2966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2967"><a href="#cb110-2967" aria-hidden="true" tabindex="-1"></a>✅ Configuration system (TOML) - DONE!  </span>
<span id="cb110-2968"><a href="#cb110-2968" aria-hidden="true" tabindex="-1"></a>✅ Skill framework - DONE!  </span>
<span id="cb110-2969"><a href="#cb110-2969" aria-hidden="true" tabindex="-1"></a>✅ First built-in skills (logging, API, CLI) - DONE!  </span>
<span id="cb110-2970"><a href="#cb110-2970" aria-hidden="true" tabindex="-1"></a>✅ Deployment skills (Docker, Kubernetes) - DONE!  </span>
<span id="cb110-2971"><a href="#cb110-2971" aria-hidden="true" tabindex="-1"></a>✅ Performance optimizations (caching, batching, fusion) - DONE!  </span>
<span id="cb110-2972"><a href="#cb110-2972" aria-hidden="true" tabindex="-1"></a>✅ Additional transformers (CSV, text, type conversion) - DONE!  </span>
<span id="cb110-2973"><a href="#cb110-2973" aria-hidden="true" tabindex="-1"></a>✅ Project scaffolding &amp; documentation generation - DONE!  </span>
<span id="cb110-2974"><a href="#cb110-2974" aria-hidden="true" tabindex="-1"></a>✅ Developer experience tools (debugger, visualizer, profiler) - DONE!  </span>
<span id="cb110-2975"><a href="#cb110-2975" aria-hidden="true" tabindex="-1"></a>✅ AI Integration (MCP, agents, adaptive behavior) - DONE!  </span>
<span id="cb110-2976"><a href="#cb110-2976" aria-hidden="true" tabindex="-1"></a>✅ Security features (sanitization, rate limiting, permissions, encryption) - DONE!  </span>
<span id="cb110-2977"><a href="#cb110-2977" aria-hidden="true" tabindex="-1"></a>✅ Production features (circuit breakers, bulkheads, health checks) - DONE!  </span>
<span id="cb110-2978"><a href="#cb110-2978" aria-hidden="true" tabindex="-1"></a>✅ Performance profiling and optimization - DONE!  </span>
<span id="cb110-2979"><a href="#cb110-2979" aria-hidden="true" tabindex="-1"></a>✅ Package registry and discovery - DONE!</span>
<span id="cb110-2980"><a href="#cb110-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2981"><a href="#cb110-2981" aria-hidden="true" tabindex="-1"></a><span class="fu">## Package Registry</span></span>
<span id="cb110-2982"><a href="#cb110-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2983"><a href="#cb110-2983" aria-hidden="true" tabindex="-1"></a>Share and discover nanobricks with the built-in package registry:</span>
<span id="cb110-2984"><a href="#cb110-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2985"><a href="#cb110-2985" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Packages</span></span>
<span id="cb110-2986"><a href="#cb110-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2987"><a href="#cb110-2987" aria-hidden="true" tabindex="-1"></a>Package your nanobricks for distribution:</span>
<span id="cb110-2988"><a href="#cb110-2988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2991"><a href="#cb110-2991" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-2992"><a href="#cb110-2992" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-2993"><a href="#cb110-2993" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-2994"><a href="#cb110-2994" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-2995"><a href="#cb110-2995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2996"><a href="#cb110-2996" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> create_package_from_brick</span>
<span id="cb110-2997"><a href="#cb110-2997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2998"><a href="#cb110-2998" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a package from your brick</span></span>
<span id="cb110-2999"><a href="#cb110-2999" aria-hidden="true" tabindex="-1"></a>processor <span class="op">=</span> TextProcessor()</span>
<span id="cb110-3000"><a href="#cb110-3000" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> create_package_from_brick(</span>
<span id="cb110-3001"><a href="#cb110-3001" aria-hidden="true" tabindex="-1"></a>    processor,</span>
<span id="cb110-3002"><a href="#cb110-3002" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"text-processor"</span>,</span>
<span id="cb110-3003"><a href="#cb110-3003" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb110-3004"><a href="#cb110-3004" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb110-3005"><a href="#cb110-3005" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Powerful text processing nanobrick"</span>,</span>
<span id="cb110-3006"><a href="#cb110-3006" aria-hidden="true" tabindex="-1"></a>    keywords<span class="op">=</span>[<span class="st">"text"</span>, <span class="st">"nlp"</span>, <span class="st">"processing"</span>],</span>
<span id="cb110-3007"><a href="#cb110-3007" aria-hidden="true" tabindex="-1"></a>    homepage<span class="op">=</span><span class="st">"https://github.com/yourname/text-processor"</span>,</span>
<span id="cb110-3008"><a href="#cb110-3008" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-3009"><a href="#cb110-3009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3010"><a href="#cb110-3010" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as archive</span></span>
<span id="cb110-3011"><a href="#cb110-3011" aria-hidden="true" tabindex="-1"></a>archive <span class="op">=</span> package.to_archive()</span>
<span id="cb110-3012"><a href="#cb110-3012" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text-processor-1.0.0.nbp"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb110-3013"><a href="#cb110-3013" aria-hidden="true" tabindex="-1"></a>    f.write(archive)</span>
<span id="cb110-3014"><a href="#cb110-3014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3015"><a href="#cb110-3015" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Package created: </span><span class="sc">{</span><span class="bu">len</span>(archive) <span class="op">/</span> <span class="dv">1024</span><span class="sc">:.2f}</span><span class="ss"> KB"</span>)</span>
<span id="cb110-3016"><a href="#cb110-3016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3017"><a href="#cb110-3017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3018"><a href="#cb110-3018" aria-hidden="true" tabindex="-1"></a><span class="fu">### Publishing Packages</span></span>
<span id="cb110-3019"><a href="#cb110-3019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3020"><a href="#cb110-3020" aria-hidden="true" tabindex="-1"></a>Share your nanobricks with the community:</span>
<span id="cb110-3021"><a href="#cb110-3021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3024"><a href="#cb110-3024" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-3025"><a href="#cb110-3025" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-3026"><a href="#cb110-3026" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-3027"><a href="#cb110-3027" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-3028"><a href="#cb110-3028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3029"><a href="#cb110-3029" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks <span class="im">import</span> get_registry</span>
<span id="cb110-3030"><a href="#cb110-3030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3031"><a href="#cb110-3031" aria-hidden="true" tabindex="-1"></a><span class="co"># Get registry client</span></span>
<span id="cb110-3032"><a href="#cb110-3032" aria-hidden="true" tabindex="-1"></a>registry <span class="op">=</span> get_registry()</span>
<span id="cb110-3033"><a href="#cb110-3033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3034"><a href="#cb110-3034" aria-hidden="true" tabindex="-1"></a><span class="co"># Publish your package</span></span>
<span id="cb110-3035"><a href="#cb110-3035" aria-hidden="true" tabindex="-1"></a>success <span class="op">=</span> <span class="cf">await</span> registry.publish(package, api_key<span class="op">=</span><span class="st">"your-api-key"</span>)</span>
<span id="cb110-3036"><a href="#cb110-3036" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> success:</span>
<span id="cb110-3037"><a href="#cb110-3037" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Published </span><span class="sc">{</span>package<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>package<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3038"><a href="#cb110-3038" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3039"><a href="#cb110-3039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3040"><a href="#cb110-3040" aria-hidden="true" tabindex="-1"></a><span class="fu">### Searching Packages</span></span>
<span id="cb110-3041"><a href="#cb110-3041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3042"><a href="#cb110-3042" aria-hidden="true" tabindex="-1"></a>Find nanobricks for your needs:</span>
<span id="cb110-3043"><a href="#cb110-3043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3046"><a href="#cb110-3046" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-3047"><a href="#cb110-3047" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-3048"><a href="#cb110-3048" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-3049"><a href="#cb110-3049" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-3050"><a href="#cb110-3050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3051"><a href="#cb110-3051" aria-hidden="true" tabindex="-1"></a><span class="co"># Search by keyword</span></span>
<span id="cb110-3052"><a href="#cb110-3052" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> registry.search(<span class="st">"validation"</span>, limit<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb110-3053"><a href="#cb110-3053" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> results:</span>
<span id="cb110-3054"><a href="#cb110-3054" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>result<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>result<span class="sc">.</span>version<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>result<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3055"><a href="#cb110-3055" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Downloads: </span><span class="sc">{</span>result<span class="sc">.</span>downloads<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3056"><a href="#cb110-3056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3057"><a href="#cb110-3057" aria-hidden="true" tabindex="-1"></a><span class="co"># Search by author</span></span>
<span id="cb110-3058"><a href="#cb110-3058" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="cf">await</span> registry.search(<span class="st">""</span>, author<span class="op">=</span><span class="st">"Alice Developer"</span>)</span>
<span id="cb110-3059"><a href="#cb110-3059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3060"><a href="#cb110-3060" aria-hidden="true" tabindex="-1"></a><span class="co"># Get detailed info</span></span>
<span id="cb110-3061"><a href="#cb110-3061" aria-hidden="true" tabindex="-1"></a>info <span class="op">=</span> <span class="cf">await</span> registry.info(<span class="st">"data-validator"</span>)</span>
<span id="cb110-3062"><a href="#cb110-3062" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Latest version: </span><span class="sc">{</span>info<span class="sc">.</span>latest_version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3063"><a href="#cb110-3063" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total downloads: </span><span class="sc">{</span>info<span class="sc">.</span>total_downloads<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3064"><a href="#cb110-3064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3065"><a href="#cb110-3065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3066"><a href="#cb110-3066" aria-hidden="true" tabindex="-1"></a><span class="fu">### Installing Packages</span></span>
<span id="cb110-3067"><a href="#cb110-3067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3068"><a href="#cb110-3068" aria-hidden="true" tabindex="-1"></a>Install nanobricks with version management:</span>
<span id="cb110-3069"><a href="#cb110-3069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3072"><a href="#cb110-3072" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-3073"><a href="#cb110-3073" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-3074"><a href="#cb110-3074" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-3075"><a href="#cb110-3075" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-3076"><a href="#cb110-3076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3077"><a href="#cb110-3077" aria-hidden="true" tabindex="-1"></a><span class="co"># Install latest stable version</span></span>
<span id="cb110-3078"><a href="#cb110-3078" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(<span class="st">"data-validator"</span>)</span>
<span id="cb110-3079"><a href="#cb110-3079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3080"><a href="#cb110-3080" aria-hidden="true" tabindex="-1"></a><span class="co"># Install specific version</span></span>
<span id="cb110-3081"><a href="#cb110-3081" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(<span class="st">"data-validator"</span>, version_spec<span class="op">=</span><span class="st">"==2.1.0"</span>)</span>
<span id="cb110-3082"><a href="#cb110-3082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3083"><a href="#cb110-3083" aria-hidden="true" tabindex="-1"></a><span class="co"># Install with version constraints</span></span>
<span id="cb110-3084"><a href="#cb110-3084" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> <span class="cf">await</span> registry.install(</span>
<span id="cb110-3085"><a href="#cb110-3085" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data-validator"</span>,</span>
<span id="cb110-3086"><a href="#cb110-3086" aria-hidden="true" tabindex="-1"></a>    version_spec<span class="op">=</span><span class="st">"^2.0.0"</span>,  <span class="co"># Compatible with 2.x.x</span></span>
<span id="cb110-3087"><a href="#cb110-3087" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-3088"><a href="#cb110-3088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3089"><a href="#cb110-3089" aria-hidden="true" tabindex="-1"></a><span class="co"># List installed packages</span></span>
<span id="cb110-3090"><a href="#cb110-3090" aria-hidden="true" tabindex="-1"></a>installed <span class="op">=</span> <span class="cf">await</span> registry.list_installed()</span>
<span id="cb110-3091"><a href="#cb110-3091" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pkg <span class="kw">in</span> installed:</span>
<span id="cb110-3092"><a href="#cb110-3092" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>pkg<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>pkg<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb110-3093"><a href="#cb110-3093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3094"><a href="#cb110-3094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3095"><a href="#cb110-3095" aria-hidden="true" tabindex="-1"></a><span class="fu">### Version Management</span></span>
<span id="cb110-3096"><a href="#cb110-3096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3097"><a href="#cb110-3097" aria-hidden="true" tabindex="-1"></a>Semantic versioning with constraints:</span>
<span id="cb110-3098"><a href="#cb110-3098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3101"><a href="#cb110-3101" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-3102"><a href="#cb110-3102" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-3103"><a href="#cb110-3103" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-3104"><a href="#cb110-3104" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-3105"><a href="#cb110-3105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3106"><a href="#cb110-3106" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> Version, VersionRange</span>
<span id="cb110-3107"><a href="#cb110-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3108"><a href="#cb110-3108" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse versions</span></span>
<span id="cb110-3109"><a href="#cb110-3109" aria-hidden="true" tabindex="-1"></a>v1 <span class="op">=</span> Version.parse(<span class="st">"1.2.3"</span>)</span>
<span id="cb110-3110"><a href="#cb110-3110" aria-hidden="true" tabindex="-1"></a>v2 <span class="op">=</span> Version.parse(<span class="st">"2.0.0-beta.1"</span>)</span>
<span id="cb110-3111"><a href="#cb110-3111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3112"><a href="#cb110-3112" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare versions</span></span>
<span id="cb110-3113"><a href="#cb110-3113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v1 <span class="op">&lt;</span> v2)  <span class="co"># True</span></span>
<span id="cb110-3114"><a href="#cb110-3114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3115"><a href="#cb110-3115" aria-hidden="true" tabindex="-1"></a><span class="co"># Version ranges</span></span>
<span id="cb110-3116"><a href="#cb110-3116" aria-hidden="true" tabindex="-1"></a><span class="bu">range</span> <span class="op">=</span> VersionRange.parse(<span class="st">"^1.0.0"</span>)  <span class="co"># Compatible with 1.x.x</span></span>
<span id="cb110-3117"><a href="#cb110-3117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">range</span>.contains(v1))  <span class="co"># True</span></span>
<span id="cb110-3118"><a href="#cb110-3118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3119"><a href="#cb110-3119" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve dependencies</span></span>
<span id="cb110-3120"><a href="#cb110-3120" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> resolve_dependencies</span>
<span id="cb110-3121"><a href="#cb110-3121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3122"><a href="#cb110-3122" aria-hidden="true" tabindex="-1"></a>dependencies <span class="op">=</span> {</span>
<span id="cb110-3123"><a href="#cb110-3123" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-core"</span>: <span class="st">"^1.0.0"</span>,</span>
<span id="cb110-3124"><a href="#cb110-3124" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-utils"</span>: <span class="st">"&gt;=1.0.0,&lt;2.0.0"</span>,</span>
<span id="cb110-3125"><a href="#cb110-3125" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-types"</span>: <span class="st">"~1.2.0"</span>,  <span class="co"># ~1.2.x</span></span>
<span id="cb110-3126"><a href="#cb110-3126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-3127"><a href="#cb110-3127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3128"><a href="#cb110-3128" aria-hidden="true" tabindex="-1"></a>available <span class="op">=</span> {</span>
<span id="cb110-3129"><a href="#cb110-3129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-core"</span>: [Version.parse(<span class="st">"1.0.0"</span>), Version.parse(<span class="st">"1.5.0"</span>)],</span>
<span id="cb110-3130"><a href="#cb110-3130" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-utils"</span>: [Version.parse(<span class="st">"1.2.0"</span>), Version.parse(<span class="st">"2.0.0"</span>)],</span>
<span id="cb110-3131"><a href="#cb110-3131" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nanobrick-types"</span>: [Version.parse(<span class="st">"1.2.3"</span>), Version.parse(<span class="st">"1.3.0"</span>)],</span>
<span id="cb110-3132"><a href="#cb110-3132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-3133"><a href="#cb110-3133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3134"><a href="#cb110-3134" aria-hidden="true" tabindex="-1"></a>resolved <span class="op">=</span> resolve_dependencies(dependencies, available)</span>
<span id="cb110-3135"><a href="#cb110-3135" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: core=1.5.0, utils=1.2.0, types=1.2.3</span></span>
<span id="cb110-3136"><a href="#cb110-3136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3137"><a href="#cb110-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3138"><a href="#cb110-3138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Package Metadata</span></span>
<span id="cb110-3139"><a href="#cb110-3139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3140"><a href="#cb110-3140" aria-hidden="true" tabindex="-1"></a>Rich metadata for discoverability:</span>
<span id="cb110-3141"><a href="#cb110-3141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3144"><a href="#cb110-3144" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb110-3145"><a href="#cb110-3145" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb110-3146"><a href="#cb110-3146" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb110-3147"><a href="#cb110-3147" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb110-3148"><a href="#cb110-3148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3149"><a href="#cb110-3149" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nanobricks.registry <span class="im">import</span> PackageMetadata</span>
<span id="cb110-3150"><a href="#cb110-3150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3151"><a href="#cb110-3151" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> PackageMetadata(</span>
<span id="cb110-3152"><a href="#cb110-3152" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"my-nanobrick"</span>,</span>
<span id="cb110-3153"><a href="#cb110-3153" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb110-3154"><a href="#cb110-3154" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Does amazing things"</span>,</span>
<span id="cb110-3155"><a href="#cb110-3155" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb110-3156"><a href="#cb110-3156" aria-hidden="true" tabindex="-1"></a>    email<span class="op">=</span><span class="st">"you@example.com"</span>,</span>
<span id="cb110-3157"><a href="#cb110-3157" aria-hidden="true" tabindex="-1"></a>    license<span class="op">=</span><span class="st">"MIT"</span>,</span>
<span id="cb110-3158"><a href="#cb110-3158" aria-hidden="true" tabindex="-1"></a>    homepage<span class="op">=</span><span class="st">"https://github.com/you/my-nanobrick"</span>,</span>
<span id="cb110-3159"><a href="#cb110-3159" aria-hidden="true" tabindex="-1"></a>    keywords<span class="op">=</span>[<span class="st">"awesome"</span>, <span class="st">"nanobrick"</span>],</span>
<span id="cb110-3160"><a href="#cb110-3160" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>{</span>
<span id="cb110-3161"><a href="#cb110-3161" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nanobricks"</span>: <span class="st">"&gt;=1.0.0"</span>,</span>
<span id="cb110-3162"><a href="#cb110-3162" aria-hidden="true" tabindex="-1"></a>        <span class="st">"requests"</span>: <span class="st">"^2.0.0"</span>,</span>
<span id="cb110-3163"><a href="#cb110-3163" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb110-3164"><a href="#cb110-3164" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nanobrick-specific metadata</span></span>
<span id="cb110-3165"><a href="#cb110-3165" aria-hidden="true" tabindex="-1"></a>    skills<span class="op">=</span>[<span class="st">"api"</span>, <span class="st">"cli"</span>],</span>
<span id="cb110-3166"><a href="#cb110-3166" aria-hidden="true" tabindex="-1"></a>    input_type<span class="op">=</span><span class="st">"dict[str, Any]"</span>,</span>
<span id="cb110-3167"><a href="#cb110-3167" aria-hidden="true" tabindex="-1"></a>    output_type<span class="op">=</span><span class="st">"ProcessedData"</span>,</span>
<span id="cb110-3168"><a href="#cb110-3168" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-3169"><a href="#cb110-3169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb110-3170"><a href="#cb110-3170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3171"><a href="#cb110-3171" aria-hidden="true" tabindex="-1"></a>🔜 Community marketplace and visual builder</span>
<span id="cb110-3172"><a href="#cb110-3172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3173"><a href="#cb110-3173" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb110-3174"><a href="#cb110-3174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3175"><a href="#cb110-3175" aria-hidden="true" tabindex="-1"></a>*Last Updated: Registry Ready - Share and Discover Amazing Nanobricks!*</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>